<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ç¼–è¾‘äº§å“ - ç‰©è”ç½‘å¹³å°</title>
    <link rel="stylesheet" href="common-style.css">
    <style>
        .breadcrumb {
            display: flex;
            align-items: center;
            gap: 8px;
            margin-bottom: 20px;
            font-size: 14px;
            color: #86868b;
        }
        .breadcrumb a {
            color: #0071e3;
            text-decoration: none;
        }
        .breadcrumb-separator {
            color: #d2d2d7;
        }
        
        .form-container {
            background: white;
            border-radius: 12px;
            border: 0.5px solid rgba(0,0,0,0.08);
            padding: 32px;
            max-width: 800px;
        }
        
        .form-actions {
            display: flex;
            justify-content: flex-end;
            gap: 12px;
            margin-top: 32px;
            padding-top: 24px;
            border-top: 0.5px solid rgba(0,0,0,0.08);
        }
        
        .input-hint {
            font-size: 12px;
            color: #86868b;
            margin-top: 4px;
        }
        
        .required { color: #ff3b30; }
        
        .content-wrapper {
            display: grid;
            grid-template-columns: 1fr 300px;
            gap: 24px;
        }
        .content-sidebar {
            position: sticky;
            top: 76px;
            height: fit-content;
        }
    </style>
</head>
<body>
    <div class="header">
        <div class="logo">ç‰©è”ç½‘å¹³å°</div>
        <div class="user-info"><span>ğŸ‘¤ admin</span><a href="login.html">é€€å‡º</a></div>
    </div>

    <div class="container">
        <div class="sidebar">
            <a href="dashboard.html" class="menu-item"><span class="icon">ğŸ“Š</span> æ•°æ®ç›‘æ§</a>
            <a href="device-group.html" class="menu-item"><span class="icon">ğŸ—‚ï¸</span> è®¾å¤‡åˆ†ç»„</a>
            <a href="device-list.html" class="menu-item"><span class="icon">ğŸ“±</span> è®¾å¤‡ç®¡ç†</a>
            <a href="product-manage.html" class="menu-item active"><span class="icon">ğŸ“¦</span> äº§å“ç®¡ç†</a>
            <a href="data-query.html" class="menu-item"><span class="icon">ğŸ”</span> æ•°æ®æŸ¥è¯¢</a>
            <div class="menu-divider"></div>
            <a href="user-manage.html" class="menu-item"><span class="icon">ğŸ‘¥</span> ç”¨æˆ·ç®¡ç†</a>
            <a href="role-manage.html" class="menu-item"><span class="icon">ğŸ­</span> è§’è‰²ç®¡ç†</a>
            <div class="menu-divider"></div>
            <a href="index.html" class="menu-item"><span class="icon">ğŸ </span> è¿”å›å¯¼èˆª</a>
        </div>

        <div class="main-content">
            <div class="breadcrumb">
                <a href="product-manage.html">äº§å“ç®¡ç†</a>
                <span class="breadcrumb-separator">â€º</span>
                <a href="#" onclick="goBack(); return false;" id="productLink">äº§å“è¯¦æƒ…</a>
                <span class="breadcrumb-separator">â€º</span>
                <span>ç¼–è¾‘äº§å“</span>
            </div>

            <div class="content-wrapper">
                <div>
                    <h1 class="page-title">ç¼–è¾‘äº§å“</h1>

                    <div class="form-container">
                        <div class="form-group">
                            <label>äº§å“åç§° <span class="required">*</span></label>
                            <input type="text" id="productName" placeholder="å¦‚ï¼šæ™ºèƒ½æ°´è¡¨ã€ç©ºæ°”ç›‘æµ‹ä»ª">
                            <div class="input-hint">ğŸ’¡ ä¿®æ”¹åçš„äº§å“åç§°</div>
                        </div>

                        <div class="form-group">
                            <label>äº§å“å‹å· <span class="required">*</span></label>
                            <input type="text" id="productModel" disabled style="background: #f5f5f7; cursor: not-allowed;">
                            <div class="input-hint">ğŸ’¡ äº§å“å‹å·åˆ›å»ºåä¸å¯ä¿®æ”¹</div>
                        </div>

                        <div class="form-group">
                            <label>åè®®ç±»å‹ <span class="required">*</span></label>
                            <select id="productProtocol">
                                <option value="MQTT">MQTTï¼ˆæ¨èï¼Œè½»é‡çº§ç‰©è”ç½‘åè®®ï¼‰</option>
                                <option value="HTTP">HTTPï¼ˆé€‚åˆè¯·æ±‚-å“åº”åœºæ™¯ï¼‰</option>
                                <option value="CoAP">CoAPï¼ˆé€‚åˆèµ„æºå—é™è®¾å¤‡ï¼‰</option>
                                <option value="Modbus">Modbusï¼ˆå·¥ä¸šè®¾å¤‡å¸¸ç”¨ï¼‰</option>
                            </select>
                            <div class="input-hint">ğŸ’¡ ä¿®æ”¹åè®®ç±»å‹å¯èƒ½å½±å“å·²æ¥å…¥è®¾å¤‡</div>
                        </div>

                        <div class="form-group">
                            <label>äº§å“æè¿°</label>
                            <textarea id="productDesc" rows="4" placeholder="æè¿°äº§å“çš„åŠŸèƒ½ã€ç”¨é€”ã€é€‚ç”¨åœºæ™¯ç­‰..."></textarea>
                            <div class="input-hint">ğŸ’¡ è¯¦ç»†æè¿°æœ‰åŠ©äºå›¢é˜Ÿæˆå‘˜ç†è§£äº§å“å®šä½</div>
                        </div>

                        <div class="form-actions">
                            <button class="btn btn-default" onclick="goBack()">å–æ¶ˆ</button>
                            <button class="btn btn-primary" onclick="saveProduct()">ä¿å­˜ä¿®æ”¹</button>
                        </div>
                    </div>
                </div>

                <div class="content-sidebar">
                    <div class="prototype-note">
                        <strong>ğŸ“Œ ç¼–è¾‘è¯´æ˜</strong><br><br>
                        ä¿®æ”¹äº§å“åŸºæœ¬ä¿¡æ¯ï¼Œä¿å­˜åç«‹å³ç”Ÿæ•ˆ<br>
                        <br>
                        <strong>âš ï¸ æ³¨æ„äº‹é¡¹ï¼š</strong><br>
                        â€¢ äº§å“å‹å·åˆ›å»ºåä¸å¯ä¿®æ”¹<br>
                        â€¢ ä¿®æ”¹åè®®ç±»å‹ä¼šå½±å“å·²æ¥å…¥è®¾å¤‡<br>
                        â€¢ å±æ€§å’Œå‘½ä»¤åœ¨è¯¦æƒ…é¡µå•ç‹¬ç®¡ç†<br>
                        <br>
                        <strong>ğŸ’¡ æ“ä½œæç¤ºï¼š</strong><br>
                        â€¢ ç‚¹å‡»"ä¿å­˜ä¿®æ”¹"æäº¤è¡¨å•<br>
                        â€¢ ç‚¹å‡»"å–æ¶ˆ"æ”¾å¼ƒä¿®æ”¹<br>
                        â€¢ ä¿å­˜åè‡ªåŠ¨è¿”å›è¯¦æƒ…é¡µ
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script>
        let currentProduct = null;

        window.onload = function() {
            const params = new URLSearchParams(window.location.search);
            const productId = parseInt(params.get('id'));
            
            if (!productId) {
                alert('âŒ äº§å“IDä¸å­˜åœ¨');
                window.location.href = 'product-manage.html';
                return;
            }
            
            loadProduct(productId);
        };

        function loadProduct(id) {
            const data = localStorage.getItem('iot_products');
            if (!data) {
                alert('âŒ æœªæ‰¾åˆ°äº§å“æ•°æ®');
                window.location.href = 'product-manage.html';
                return;
            }
            
            const products = JSON.parse(data);
            currentProduct = products.find(p => p.id === id);
            
            if (!currentProduct) {
                alert('âŒ äº§å“ä¸å­˜åœ¨');
                window.location.href = 'product-manage.html';
                return;
            }
            
            renderForm();
        }

        function renderForm() {
            document.getElementById('productName').value = currentProduct.name;
            document.getElementById('productModel').value = currentProduct.model;
            document.getElementById('productProtocol').value = currentProduct.protocol;
            document.getElementById('productDesc').value = currentProduct.desc || '';
            document.getElementById('productLink').textContent = currentProduct.name;
        }

        function saveProduct() {
            const name = document.getElementById('productName').value.trim();
            const protocol = document.getElementById('productProtocol').value;
            const desc = document.getElementById('productDesc').value.trim();

            if (!name) {
                alert('âŒ è¯·è¾“å…¥äº§å“åç§°');
                return;
            }

            if (!protocol) {
                alert('âŒ è¯·é€‰æ‹©åè®®ç±»å‹');
                return;
            }

            currentProduct.name = name;
            currentProduct.protocol = protocol;
            currentProduct.desc = desc;

            const data = localStorage.getItem('iot_products');
            const products = JSON.parse(data);
            const index = products.findIndex(p => p.id === currentProduct.id);
            products[index] = currentProduct;
            localStorage.setItem('iot_products', JSON.stringify(products));

            alert('âœ… äº§å“ä¿¡æ¯å·²æ›´æ–°');
            window.location.href = `product-detail.html?id=${currentProduct.id}`;
        }

        function goBack() {
            if (currentProduct) {
                window.location.href = `product-detail.html?id=${currentProduct.id}`;
            } else {
                window.location.href = 'product-manage.html';
            }
        }
    </script>
</body>
</html>
