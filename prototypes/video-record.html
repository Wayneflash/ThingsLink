<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>å†å²å½•åƒ - è§†é¢‘è®¾å¤‡è¯¦æƒ…</title>
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/element-plus@2.3.14/dist/index.css">
  <script src="https://cdn.jsdelivr.net/npm/vue@3.3.4/dist/vue.global.prod.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/element-plus@2.3.14/dist/index.full.min.js"></script>
  <style>
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }

    body {
      font-family: -apple-system, BlinkMacSystemFont, 'SF Pro Display', 'Segoe UI', 'Microsoft YaHei', sans-serif;
      background: #f5f5f7;
      color: #1d1d1f;
    }

    .video-record-page {
      height: 100vh;
      display: flex;
      flex-direction: column;
      background: #f5f5f7;
    }

    /* é¡µé¢å¤´éƒ¨ */
    .page-header {
      padding: 16px 20px;
      background: white;
      border-bottom: 1px solid #e5e5e7;
      display: flex;
      align-items: center;
      gap: 16px;
    }

    .back-btn {
      border: none;
      background: transparent;
      cursor: pointer;
      padding: 8px;
      color: #007aff;
      font-size: 14px;
      display: flex;
      align-items: center;
      gap: 4px;
    }

    .back-btn:hover {
      background: #f5f5f7;
      border-radius: 6px;
    }

    .page-title {
      font-size: 18px;
      font-weight: 600;
      color: #1d1d1f;
    }

    /* ä¸»å†…å®¹åŒºåŸŸ */
    .main-content {
      flex: 1;
      display: flex;
      overflow: hidden;
      padding: 16px;
      gap: 16px;
    }

    /* å·¦ä¾§ï¼šå½•åƒç‰‡æ®µåˆ—è¡¨ */
    .record-list-panel {
      width: 320px;
      background: white;
      border-radius: 10px;
      display: flex;
      flex-direction: column;
      box-shadow: 0 2px 8px rgba(0,0,0,0.08);
    }

    .record-list-header {
      padding: 16px;
      border-bottom: 1px solid #e5e5e7;
    }

    .date-picker-wrapper {
      margin-bottom: 16px;
    }

    .record-list-title {
      font-size: 14px;
      font-weight: 600;
      color: #1d1d1f;
      margin-bottom: 12px;
    }

    .record-list-body {
      flex: 1;
      overflow-y: auto;
      padding: 8px;
    }

    .record-item {
      padding: 12px;
      margin-bottom: 8px;
      border-radius: 8px;
      cursor: pointer;
      transition: all 0.2s;
      display: flex;
      align-items: center;
      justify-content: space-between;
      border: 1px solid transparent;
    }

    .record-item:hover {
      background: #f5f5f7;
      border-color: #e5e5e7;
    }

    .record-item.active {
      background: #e8f4ff;
      border-color: #007aff;
    }

    .record-time {
      font-size: 13px;
      color: #1d1d1f;
      font-weight: 500;
    }

    .record-duration {
      font-size: 12px;
      color: #86868b;
      margin-top: 4px;
    }

    .record-action {
      color: #007aff;
      cursor: pointer;
      padding: 4px;
    }

    .record-action:hover {
      color: #0051d5;
    }

    .empty-record {
      text-align: center;
      padding: 40px 20px;
      color: #86868b;
      font-size: 14px;
    }

    /* å³ä¾§ï¼šè§†é¢‘æ’­æ”¾åŒºåŸŸ */
    .video-player-panel {
      flex: 1;
      background: white;
      border-radius: 10px;
      display: flex;
      flex-direction: column;
      box-shadow: 0 2px 8px rgba(0,0,0,0.08);
      overflow: hidden;
    }

    .video-container {
      flex: 1;
      background: #000;
      display: flex;
      align-items: center;
      justify-content: center;
      position: relative;
      min-height: 0;
    }

    .video-element {
      width: 100%;
      height: 100%;
      object-fit: contain;
    }

    .video-placeholder {
      color: #86868b;
      text-align: center;
    }

    .video-placeholder-icon {
      font-size: 64px;
      margin-bottom: 16px;
      opacity: 0.5;
    }

    /* æ’­æ”¾æ§åˆ¶æ  */
    .player-controls {
      padding: 12px 16px;
      background: #fafafa;
      border-top: 1px solid #e5e5e7;
    }

    .player-controls-top {
      display: flex;
      align-items: center;
      gap: 12px;
      margin-bottom: 12px;
    }

    .control-btn {
      width: 36px;
      height: 36px;
      border-radius: 6px;
      border: none;
      background: white;
      cursor: pointer;
      display: flex;
      align-items: center;
      justify-content: center;
      color: #1d1d1f;
      box-shadow: 0 1px 3px rgba(0,0,0,0.1);
      transition: all 0.2s;
    }

    .control-btn:hover {
      background: #f5f5f7;
      box-shadow: 0 2px 6px rgba(0,0,0,0.15);
    }

    .control-btn:active {
      transform: scale(0.95);
    }

    .control-info {
      flex: 1;
      font-size: 12px;
      color: #86868b;
      text-align: center;
    }

    /* æ—¶é—´è½´ */
    .timeline-container {
      margin-bottom: 12px;
    }

    .timeline-label {
      display: flex;
      justify-content: space-between;
      font-size: 11px;
      color: #86868b;
      margin-bottom: 4px;
      padding: 0 4px;
    }

    .timeline-bar {
      height: 40px;
      background: #e5e5e7;
      border-radius: 6px;
      position: relative;
      overflow: hidden;
    }

    .timeline-segment {
      position: absolute;
      height: 100%;
      background: #007aff;
      border-radius: 4px;
      cursor: pointer;
      transition: all 0.2s;
    }

    .timeline-segment:hover {
      background: #0051d5;
      box-shadow: 0 0 8px rgba(0, 122, 255, 0.4);
    }

    .timeline-cursor {
      position: absolute;
      top: 0;
      width: 2px;
      height: 100%;
      background: #ff3b30;
      z-index: 10;
      pointer-events: none;
    }

    .timeline-cursor::before {
      content: '';
      position: absolute;
      top: -4px;
      left: -4px;
      width: 10px;
      height: 10px;
      background: #ff3b30;
      border-radius: 50%;
    }

    /* æ—¶é—´æ§åˆ¶ */
    .time-controls {
      display: flex;
      align-items: center;
      gap: 12px;
      flex-wrap: wrap;
    }

    .time-input-group {
      display: flex;
      align-items: center;
      gap: 8px;
      background: white;
      padding: 8px 12px;
      border-radius: 6px;
      box-shadow: 0 1px 3px rgba(0,0,0,0.1);
    }

    .time-label {
      font-size: 13px;
      color: #1d1d1f;
      white-space: nowrap;
    }

    .time-input {
      width: 100px;
      padding: 6px 8px;
      border: 1px solid #e5e5e7;
      border-radius: 4px;
      font-size: 13px;
      font-family: 'SF Mono', 'Monaco', monospace;
    }

    .time-input:focus {
      outline: none;
      border-color: #007aff;
    }

    .time-separator {
      color: #86868b;
      font-size: 13px;
    }

    .play-btn {
      background: #007aff;
      color: white;
      border: none;
      padding: 8px 20px;
      border-radius: 6px;
      cursor: pointer;
      font-size: 14px;
      font-weight: 500;
      transition: all 0.2s;
      box-shadow: 0 2px 4px rgba(0, 122, 255, 0.3);
    }

    .play-btn:hover {
      background: #0051d5;
      box-shadow: 0 4px 8px rgba(0, 122, 255, 0.4);
    }

    .play-btn:active {
      transform: scale(0.98);
    }

    .speed-select {
      width: 80px;
    }

    .loading {
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      color: #86868b;
    }

    .loading-spinner {
      width: 40px;
      height: 40px;
      border: 3px solid #e5e5e7;
      border-top-color: #007aff;
      border-radius: 50%;
      animation: spin 1s linear infinite;
      margin-bottom: 12px;
    }

    @keyframes spin {
      to { transform: rotate(360deg); }
    }
  </style>
</head>
<body>
  <div id="app">
    <div class="video-record-page">
      <!-- é¡µé¢å¤´éƒ¨ -->
      <div class="page-header">
        <button class="back-btn" @click="goBack">
          <span>â†</span> è¿”å›
        </button>
        <h1 class="page-title">å†å²å½•åƒ</h1>
      </div>

      <!-- ä¸»å†…å®¹åŒºåŸŸ -->
      <div class="main-content">
        <!-- å·¦ä¾§ï¼šå½•åƒç‰‡æ®µåˆ—è¡¨ -->
        <div class="record-list-panel">
          <div class="record-list-header">
            <div class="date-picker-wrapper">
              <el-date-picker
                v-model="selectedDate"
                type="date"
                placeholder="é€‰æ‹©æ—¥æœŸ"
                format="YYYY-MM-DD"
                value-format="YYYY-MM-DD"
                @change="onDateChange"
                style="width: 100%;"
              />
            </div>
            <div class="record-list-title">å½•åƒç‰‡æ®µåˆ—è¡¨</div>
          </div>
          <div class="record-list-body">
            <div v-if="recordList.length === 0 && !loading" class="empty-record">
              æš‚æ— å½•åƒæ•°æ®
            </div>
            <div v-else-if="loading" class="loading" style="padding: 40px;">
              <div class="loading-spinner"></div>
              <div>åŠ è½½ä¸­...</div>
            </div>
            <div
              v-for="(record, index) in recordList"
              :key="index"
              class="record-item"
              :class="{ active: selectedRecordIndex === index }"
              @click="selectRecord(index)"
            >
              <div>
                <div class="record-time">{{ record.startTime }} - {{ record.endTime }}</div>
                <div class="record-duration">æ—¶é•¿: {{ record.duration }}</div>
              </div>
              <span class="record-action" @click.stop="playRecord(record)">
                â–¶
              </span>
            </div>
          </div>
        </div>

        <!-- å³ä¾§ï¼šè§†é¢‘æ’­æ”¾åŒºåŸŸ -->
        <div class="video-player-panel">
          <div class="video-container">
            <video
              v-if="playing && videoUrl"
              ref="videoRef"
              class="video-element"
              controls
              :src="videoUrl"
            ></video>
            <div v-else-if="playLoading" class="loading">
              <div class="loading-spinner"></div>
              <div>æ­£åœ¨åŠ è½½è§†é¢‘...</div>
            </div>
            <div v-else class="video-placeholder">
              <div class="video-placeholder-icon">ğŸ“¹</div>
              <div>è¯·é€‰æ‹©å½•åƒç‰‡æ®µæ’­æ”¾</div>
            </div>
          </div>

          <!-- æ’­æ”¾æ§åˆ¶æ  -->
          <div class="player-controls">
            <!-- æ’­æ”¾æ§åˆ¶æŒ‰é’® -->
            <div class="player-controls-top">
              <button class="control-btn" @click="togglePlay">
                {{ playing ? 'â¸' : 'â–¶' }}
              </button>
              <button class="control-btn" @click="stopPlay">â¹</button>
              <button class="control-btn" @click="toggleMute">
                {{ muted ? 'ğŸ”‡' : 'ğŸ”Š' }}
              </button>
              <div class="control-info">{{ bitrate }}</div>
              <button class="control-btn" @click="refreshVideo">ğŸ”„</button>
              <button class="control-btn" @click="toggleFullscreen">â›¶</button>
            </div>

            <!-- æ—¶é—´è½´ -->
            <div class="timeline-container">
              <div class="timeline-label">
                <span>00:00</span>
                <span>24:00</span>
              </div>
              <div class="timeline-bar" @click="onTimelineClick" ref="timelineRef">
                <div
                  v-for="(segment, index) in timelineSegments"
                  :key="index"
                  class="timeline-segment"
                  :style="{
                    left: segment.leftPercent + '%',
                    width: segment.widthPercent + '%'
                  }"
                  @click.stop="selectTimelineSegment(segment)"
                ></div>
                <div
                  v-if="currentTimePercent > 0"
                  class="timeline-cursor"
                  :style="{ left: currentTimePercent + '%' }"
                ></div>
              </div>
            </div>

            <!-- æ—¶é—´æ§åˆ¶ -->
            <div class="time-controls">
              <div class="time-input-group">
                <span class="time-label">å¼€å§‹æ—¶é—´</span>
                <input
                  v-model="startTime"
                  type="text"
                  class="time-input"
                  placeholder="00:00:00"
                />
              </div>
              <span class="time-separator">è‡³</span>
              <div class="time-input-group">
                <span class="time-label">ç»“æŸæ—¶é—´</span>
                <input
                  v-model="endTime"
                  type="text"
                  class="time-input"
                  placeholder="23:59:59"
                />
              </div>
              <button class="play-btn" @click="playByTimeRange">æ’­æ”¾</button>
              <button class="control-btn" @click="downloadRecord">â¬‡</button>
              <el-select v-model="playbackSpeed" class="speed-select" size="small">
                <el-option label="0.5x" value="0.5" />
                <el-option label="1x" value="1" />
                <el-option label="1.5x" value="1.5" />
                <el-option label="2x" value="2" />
              </el-select>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>

  <script>
    const { createApp, ref, computed, onMounted, watch } = Vue;

    createApp({
      setup() {
        // è·¯ç”±å‚æ•°ï¼ˆæ¨¡æ‹Ÿï¼‰
        const deviceId = ref('43000000801218000197');
        const channelId = ref('43000000801320004237');

        // æ—¥æœŸé€‰æ‹©
        const selectedDate = ref(new Date().toISOString().split('T')[0]);
        
        // å½•åƒåˆ—è¡¨
        const recordList = ref([]);
        const loading = ref(false);
        const selectedRecordIndex = ref(-1);

        // è§†é¢‘æ’­æ”¾
        const videoRef = ref(null);
        const playing = ref(false);
        const playLoading = ref(false);
        const videoUrl = ref('');
        const muted = ref(false);
        const bitrate = ref('0 kb/s');
        const currentTimePercent = ref(0);

        // æ—¶é—´æ§åˆ¶
        const startTime = ref('00:00:00');
        const endTime = ref('23:59:59');
        const playbackSpeed = ref('1');

        // æ—¶é—´è½´æ•°æ®
        const timelineRef = ref(null);
        const timelineSegments = ref([]);

        // è¿”å›
        const goBack = () => {
          console.log('è¿”å›');
        };

        // æ—¥æœŸå˜åŒ–
        const onDateChange = () => {
          loadRecordList();
        };

        // åŠ è½½å½•åƒåˆ—è¡¨
        const loadRecordList = async () => {
          loading.value = true;
          try {
            // æ¨¡æ‹ŸAPIè°ƒç”¨
            await new Promise(resolve => setTimeout(resolve, 500));
            
            // æ¨¡æ‹Ÿæ•°æ®
            recordList.value = [
              {
                startTime: '07:49:57',
                endTime: '07:51:10',
                duration: '1åˆ†13ç§’',
                startTimeFull: `${selectedDate.value} 07:49:57`,
                endTimeFull: `${selectedDate.value} 07:51:10`
              },
              {
                startTime: '07:51:10',
                endTime: '16:03:58',
                duration: '8å°æ—¶12åˆ†48ç§’',
                startTimeFull: `${selectedDate.value} 07:51:10`,
                endTimeFull: `${selectedDate.value} 16:03:58`
              },
              {
                startTime: '16:03:58',
                endTime: '16:19:56',
                duration: '15åˆ†58ç§’',
                startTimeFull: `${selectedDate.value} 16:03:58`,
                endTimeFull: `${selectedDate.value} 16:19:56`
              },
              {
                startTime: '16:45:56',
                endTime: '17:09:57',
                duration: '24åˆ†1ç§’',
                startTimeFull: `${selectedDate.value} 16:45:56`,
                endTimeFull: `${selectedDate.value} 17:09:57`
              }
            ];

            // ç”Ÿæˆæ—¶é—´è½´æ•°æ®
            generateTimelineSegments();
          } catch (error) {
            console.error('åŠ è½½å½•åƒåˆ—è¡¨å¤±è´¥:', error);
          } finally {
            loading.value = false;
          }
        };

        // ç”Ÿæˆæ—¶é—´è½´æ•°æ®
        const generateTimelineSegments = () => {
          const segments = [];
          recordList.value.forEach(record => {
            const start = timeToMinutes(record.startTime);
            const end = timeToMinutes(record.endTime);
            segments.push({
              start,
              end,
              leftPercent: (start / 1440) * 100,
              widthPercent: ((end - start) / 1440) * 100,
              record
            });
          });
          timelineSegments.value = segments;
        };

        // æ—¶é—´è½¬åˆ†é’Ÿæ•°ï¼ˆ0-1440ï¼‰
        const timeToMinutes = (timeStr) => {
          const [h, m, s] = timeStr.split(':').map(Number);
          return h * 60 + m + s / 60;
        };

        // é€‰æ‹©å½•åƒç‰‡æ®µ
        const selectRecord = (index) => {
          selectedRecordIndex.value = index;
          const record = recordList.value[index];
          startTime.value = record.startTime;
          endTime.value = record.endTime;
        };

        // æ’­æ”¾å½•åƒ
        const playRecord = async (record) => {
          selectedRecordIndex.value = recordList.value.findIndex(r => r === record);
          startTime.value = record.startTime;
          endTime.value = record.endTime;
          
          playLoading.value = true;
          try {
            // æ¨¡æ‹ŸAPIè°ƒç”¨è·å–æ’­æ”¾åœ°å€
            await new Promise(resolve => setTimeout(resolve, 1000));
            videoUrl.value = 'https://example.com/video.m3u8';
            playing.value = true;
          } catch (error) {
            console.error('æ’­æ”¾å¤±è´¥:', error);
          } finally {
            playLoading.value = false;
          }
        };

        // æ’­æ”¾/æš‚åœ
        const togglePlay = () => {
          if (!videoRef.value) return;
          if (playing.value) {
            videoRef.value.pause();
            playing.value = false;
          } else {
            videoRef.value.play();
            playing.value = true;
          }
        };

        // åœæ­¢æ’­æ”¾
        const stopPlay = () => {
          if (videoRef.value) {
            videoRef.value.pause();
            videoRef.value.currentTime = 0;
          }
          playing.value = false;
          videoUrl.value = '';
        };

        // é™éŸ³/å–æ¶ˆé™éŸ³
        const toggleMute = () => {
          if (videoRef.value) {
            videoRef.value.muted = !muted.value;
            muted.value = !muted.value;
          }
        };

        // åˆ·æ–°è§†é¢‘
        const refreshVideo = () => {
          if (videoRef.value) {
            videoRef.value.load();
          }
        };

        // å…¨å±
        const toggleFullscreen = () => {
          if (!document.fullscreenElement) {
            videoRef.value?.requestFullscreen();
          } else {
            document.exitFullscreen();
          }
        };

        // æ—¶é—´è½´ç‚¹å‡»
        const onTimelineClick = (event) => {
          if (!timelineRef.value) return;
          const rect = timelineRef.value.getBoundingClientRect();
          const clickX = event.clientX - rect.left;
          const percent = (clickX / rect.width) * 100;
          const minutes = (percent / 100) * 1440;
          const timeStr = minutesToTime(minutes);
          startTime.value = timeStr;
        };

        // åˆ†é’Ÿæ•°è½¬æ—¶é—´å­—ç¬¦ä¸²
        const minutesToTime = (minutes) => {
          const h = Math.floor(minutes / 60);
          const m = Math.floor(minutes % 60);
          const s = Math.floor((minutes % 1) * 60);
          return `${String(h).padStart(2, '0')}:${String(m).padStart(2, '0')}:${String(s).padStart(2, '0')}`;
        };

        // é€‰æ‹©æ—¶é—´è½´ç‰‡æ®µ
        const selectTimelineSegment = (segment) => {
          const record = segment.record;
          selectRecord(recordList.value.findIndex(r => r === record));
        };

        // æŒ‰æ—¶é—´èŒƒå›´æ’­æ”¾
        const playByTimeRange = async () => {
          playLoading.value = true;
          try {
            // æ¨¡æ‹ŸAPIè°ƒç”¨
            await new Promise(resolve => setTimeout(resolve, 1000));
            videoUrl.value = 'https://example.com/video.m3u8';
            playing.value = true;
          } catch (error) {
            console.error('æ’­æ”¾å¤±è´¥:', error);
          } finally {
            playLoading.value = false;
          }
        };

        // ä¸‹è½½å½•åƒ
        const downloadRecord = () => {
          console.log('ä¸‹è½½å½•åƒ');
        };

        // åˆå§‹åŒ–
        onMounted(() => {
          loadRecordList();
        });

        return {
          deviceId,
          channelId,
          selectedDate,
          recordList,
          loading,
          selectedRecordIndex,
          videoRef,
          playing,
          playLoading,
          videoUrl,
          muted,
          bitrate,
          currentTimePercent,
          startTime,
          endTime,
          playbackSpeed,
          timelineRef,
          timelineSegments,
          goBack,
          onDateChange,
          selectRecord,
          playRecord,
          togglePlay,
          stopPlay,
          toggleMute,
          refreshVideo,
          toggleFullscreen,
          onTimelineClick,
          selectTimelineSegment,
          playByTimeRange,
          downloadRecord
        };
      }
    }).use(ElementPlus).mount('#app');
  </script>
</body>
</html>
