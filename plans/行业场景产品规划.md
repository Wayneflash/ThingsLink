# 能源管理场景 - MVP版本产品规划

## 一、项目背景

**项目目标**：基于现有IoT平台，开发能源管理场景的MVP版本，提供企业能耗监控、统计和分析能力。

**核心价值**：
- 帮助企业实时监控能耗数据
- 提供能耗统计和趋势分析
- 支持能耗报表导出
- 为企业降本增效提供数据支撑

**市场需求**：
- 双碳政策推动，企业能耗管理需求强烈
- 工业用电成本高，企业有降本增效动力
- 政府对高耗能企业有强制能耗监测要求

---

## 五、产品形态确认

### 5.1 产品形态设计

经过讨论，确认采用以下产品形态：

**统一入口 + 角色权限管理**

- ✅ 统一登录入口，登录后根据用户权限显示对应菜单
- ✅ 通过角色管理来配置菜单权限（行业特定菜单和公用菜单使用同一套逻辑）
- ✅ 公用菜单（设备管理、产品管理、报警管理等）可复用
- ✅ 行业特定菜单（能源统计等）通过角色权限动态展示

### 5.2 菜单结构设计

```
┌─────────────────────────────────────────┐
│              主菜单                       │
├─────────────────────────────────────────┤
│  数据监控（Dashboard）                   │
│    ├─ 通用概览 Tab                        │
│    └─ 能源统计 Tab                        │
├─────────────────────────────────────────┤
│  设备管理                                │
│    ├─ 设备列表                           │
│    └─ 设备分组                           │
├─────────────────────────────────────────┤
│  产品管理                                │
│    └─ 产品列表（含预置产品）              │
├─────────────────────────────────────────┤
│  能源统计（新增）                        │
│    ├─ 能耗统计                           │
│    ├─ 能耗趋势                           │
│    └─ 能耗报表                           │
├─────────────────────────────────────────┤
│  报警管理（新增）                        │
│    ├─ 报警统计                           │
│    └─ 报警配置                           │
├─────────────────────────────────────────┤
│  日志管理                                │
│  用户管理                                │
│  角色管理                                │
│  系统管理                                │
└─────────────────────────────────────────┘
```

---

## 六、MVP版本详细规划 - 能源管理场景

### 6.1 预置产品（3个）

#### 6.1.1 智能电表

**产品信息**
- 产品名称：智能电表
- 产品型号：SMART_METER_ELEC
- 协议类型：Modbus / DL/T645

**物模型属性**
| 属性标识符 | 属性名称 | 数据类型 | 单位 | 说明 |
|-----------|---------|---------|------|------|
| voltage | 电压 | float | V | 实时电压 |
| current | 电流 | float | A | 实时电流 |
| active_power | 有功功率 | float | kW | 实时有功功率 |
| reactive_power | 无功功率 | float | kvar | 实时无功功率 |
| power_factor | 功率因数 | float | - | 功率因数（0-1） |
| total_energy | 总有功电能 | float | kWh | 表底示数（累计值） |

**注意事项**
- `total_energy` 为表底示数，是累计值
- 能耗统计计算：周期能耗 = 当前 total_energy - 上一次 total_energy
- 物模型固定，用户不可修改

#### 6.1.2 智能水表

**产品信息**
- 产品名称：智能水表
- 产品型号：SMART_METER_WATER
- 协议类型：Modbus / CJ/T188

**物模型属性**
| 属性标识符 | 属性名称 | 数据类型 | 单位 | 说明 |
|-----------|---------|---------|------|------|
| total_flow | 总流量 | float | m³ | 表底示数（累计值） |
| instantaneous_flow | 瞬时流量 | float | m³/h | 实时流量 |
| water_pressure | 水压 | float | MPa | 实时水压 |
| valve_status | 阀门状态 | int | - | 0-关闭，1-打开 |

**注意事项**
- `total_flow` 为表底示数，是累计值
- 能耗统计计算：周期用水量 = 当前 total_flow - 上一次 total_flow
- 1吨水 ≈ 1立方米（m³）
- 物模型固定，用户不可修改

#### 6.1.3 智能气表

**产品信息**
- 产品名称：智能气表
- 产品型号：SMART_METER_GAS
- 协议类型：Modbus / CJ/T188

**物模型属性**
| 属性标识符 | 属性名称 | 数据类型 | 单位 | 说明 |
|-----------|---------|---------|------|------|
| total_gas | 总用气量 | float | m³ | 表底示数（累计值） |
| instantaneous_flow | 瞬时流量 | float | m³/h | 实时流量 |
| gas_pressure | 气压 | float | kPa | 实时气压 |
| gas_temperature | 气体温度 | float | ℃ | 实时温度 |

**注意事项**
- `total_gas` 为表底示数，是累计值
- 能耗统计计算：周期用气量 = 当前 total_gas - 上一次 total_gas
- 物模型固定，用户不可修改

### 6.2 数据概览（Dashboard）

#### 6.2.1 通用概览 Tab

**功能内容**
- 设备总数、在线数、离线数
- 今日报警数、未处理报警数
- 设备分组统计（按分组统计设备数量）
- 最新设备数据（最近上报的设备数据列表）

#### 6.2.2 能源统计 Tab

**功能内容**
- **电力统计**：
  - 今日/本月/本年用电量（kWh）
  - 实时功率曲线（kW）
  - 电压/电流监测
  - 用电Top10设备

- **水耗统计**：
  - 今日/本月/本年用水量（m³）
  - 实时流量监测（m³/h）
  - 水压监测
  - 用水Top10设备

- **气耗统计**：
  - 今日/本月/本年用气量（m³）
  - 实时流量监测（m³/h）
  - 气压监测
  - 用气Top10设备

**设计原则**：
1. 每种能源类型单独Tab展示，避免单位混淆
2. 相同维度的统计保持一致的展示形式（如Top10设备）
3. 关键指标（总量、实时值、Top设备）保持相同位置

### 6.3 报警管理模块（一级菜单）

**设计原则**：
- 完全复用现有报警管理功能
- 能源设备的报警自动归类到现有系统中
- MVP阶段不开发能源专用报警配置
- 后续迭代可增加能源专用报警规则

---

### 6.4 能源统计模块（一级菜单）

#### 6.4.1 能耗统计

**功能内容**
- **电力统计**：
  - 日/月/年用电量统计
  - 按设备/分组/区域统计
  - 用电对比（同比、环比）

- **水耗统计**：
  - 日/月/年用水量统计
  - 按设备/分组/区域统计
  - 用水对比（同比、环比）

- **气耗统计**：
  - 日/月/年用气量统计
  - 按设备/分组/区域统计
  - 用气对比（同比、环比）

**设计原则**：
1. 每种能源类型使用独立的统计页面
2. 相同维度的统计保持一致的交互和展示
3. 对比分析支持同类型能源的对比（如不同设备的用电对比）

#### 6.4.2 能耗趋势

**功能内容**
- **电力趋势**：
  - 用电量趋势图（折线图）
  - 多电表对比趋势
  - 用电预测（可选）

- **水耗趋势**：
  - 用水量趋势图（折线图）
  - 多水表对比趋势
  - 用水预测（可选）

- **气耗趋势**：
  - 用气量趋势图（折线图）
  - 多气表对比趋势
  - 用气预测（可选）

**设计原则**：
1. 趋势分析按能源类型分开
2. 相同类型的设备可以对比（如电表vs电表）
3. 不同类型的能源不直接对比（避免单位不一致）

#### 6.4.3 能耗报表

**功能内容**
- **电力报表**：
  - 日报表/月报表/年报表
  - 导出Excel/PDF
  - 模板管理（可选）

- **水耗报表**：
  - 日报表/月报表/年报表
  - 导出Excel/PDF
  - 模板管理（可选）

- **气耗报表**：
  - 日报表/月报表/年报表
  - 导出Excel/PDF
  - 模板管理（可选）

**设计原则**：
1. 报表按能源类型分开生成
2. 相同维度的报表保持一致的格式
3. 支持批量导出（如同时导出电、水、气报表）

### 6.5 高级功能（后续迭代）

#### 6.5.1 峰谷分析

**功能内容**
- 峰谷电价分析
- 峰谷时段能耗统计
- 峰谷成本分析

**实现方式**
- 在系统配置中设置峰谷时段
- 根据设备上报时间自动归类到峰谷时段
- 分别统计峰谷时段的能耗和成本

#### 6.5.2 节能建议

**功能内容**
- 基于AI分析的节能建议
- 节能效果评估
- 节能方案推荐

#### 6.5.3 能耗告警

**功能内容**
- 能耗超限告警
- 异常用电告警
- 能耗趋势异常告警

---

## 七、技术架构设计

### 7.1 整体架构

```
┌─────────────────────────────────────────────────────────┐
│              统一系统入口                                │
│         单一登录 + 角色权限管理                          │
└─────────────────────────────────────────────────────────┘
                    ↓
        ┌───────────────────────┐
        │    角色权限管理层      │
        │  - 菜单权限配置         │
        │  - 行业特定菜单         │
        │  - 公用菜单权限         │
        └───────────────────────┘
                    ↓
        ┌───────────────────────┐
        │    动态菜单引擎        │
        │  - 根据角色加载菜单     │
        │  - 根据权限动态展示    │
        └───────────────────────┘
                    ↓
        ┌───────────────────────┐
        │    通用功能层          │
        │  - 设备管理            │
        │  - 产品管理            │
        │  - 报警管理            │
        │  - 日志管理            │
        └───────────────────────┘
                    ↓
        ┌───────────────────────┐
        │    行业功能层          │
        │  - 能源统计            │
        │  - 能耗趋势            │
        │  - 能耗报表            │
        └───────────────────────┘
                    ↓
        ┌───────────────────────┐
        │    数据分析引擎        │
        │  - 能耗统计计算        │
        │  - 趋势分析            │
        │  - 报表生成            │
        └───────────────────────┘
```

### 7.2 核心设计理念

**1. 统一入口 + 动态配置**
- 单一登录入口，简化用户体验
- 通过系统配置动态管理菜单
- 公用功能完全复用，减少重复开发

**2. 预置产品 + 固定物模型**
- 系统初始化时自动创建预置产品
- 物模型固定，用户不可修改
- 保证数据分析的一致性和准确性

**3. 表底示数 + 差值计算**
- 设备上报表底示数（累计值）
- 周期能耗 = 当前表底示数 - 上一次表底示数
- 简单可靠，避免累计误差

**4. 分阶段实施**
- MVP版本：核心功能（能耗统计、趋势、报表）
- 后续迭代：高级功能（峰谷分析、节能建议、能耗告警）

---

## 八、实施计划

### 8.1 第一阶段：MVP版本（能源管理）

**目标**：实现能源管理场景的核心功能

**功能清单**
- ✅ 预置3个产品（电表、水表、气表）
- ✅ 数据概览（通用概览 + 能源统计）
- ✅ 能源统计模块（能耗统计、能耗趋势、能耗报表）

**技术清单**
- ✅ 数据库表设计（预置产品）
- ✅ 后端API开发（能耗统计、趋势分析、报表生成）
- ✅ 前端页面开发（Dashboard、能源统计模块）

**复用功能**：
- 设备管理（完全复用）
- 报警管理（完全复用）
- 角色权限（完全复用）

### 8.2 第二阶段：功能完善

**目标**：完善能源管理功能，提升用户体验

**功能清单**
- ⭐ 能耗告警（超限告警、异常告警）
- ⭐ 报表模板管理
- ⭐ 报表定时发送
- ⭐ 能耗预测

### 8.3 第三阶段：高级功能

**目标**：实现高级分析功能，提升产品竞争力

**功能清单**
- ⭐ 峰谷分析（峰谷电价分析、成本分析）
- ⭐ 节能建议（基于AI分析）
- ⭐ 多维度对比分析
- ⭐ 能效评估

---

## 八、下一步行动

1. **确认MVP规划**：是否同意上述MVP版本的功能规划？

2. **技术方案确认**：是否需要详细的技术方案设计（数据库、API、前端）？

3. **开发优先级**：MVP版本的开发优先级如何安排？

4. **时间计划**：MVP版本的预计开发周期？
