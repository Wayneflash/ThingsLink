# 002-修改密码功能

## 功能描述
在侧边栏菜单中新增"系统配置"父菜单，其下包含"修改密码"子菜单项。用户点击后进入修改密码页面，可以修改自己的登录密码。

## 涉及的文件清单

### 后端文件
1. **backend/src/main/java/com/iot/platform/service/UserService.java**
   - 在 `getUserMenus()` 方法中新增"系统配置"菜单
   - 添加"修改密码"子菜单项

### 前端文件
1. **frontend/src/views/ChangePassword.vue**（新建）
   - 创建修改密码页面组件
   - 包含表单：旧密码、新密码、确认新密码
   - 表单验证和提交逻辑

2. **frontend/src/router/index.js**
   - 新增路由：`/system-config/change-password`

3. **docs/API.md**
   - 无需修改（修改密码接口文档已存在）

## 修改内容说明

### 1. 后端菜单生成（UserService.java）

在 `getUserMenus()` 方法中，在菜单列表末尾添加：

```java
// 8. 系统配置（所有登录用户都可以访问）
List<Map<String, Object>> systemConfigChildren = new ArrayList<>();
systemConfigChildren.add(createMenu("change-password", "修改密码", "/system-config/change-password", null, null, 1));
menus.add(createMenu("system-config", "系统配置", "/system-config", "Tools", systemConfigChildren, sort++));
```

**权限说明**：
- 所有登录用户都可以看到"系统配置"菜单和"修改密码"子菜单
- 不需要额外的权限检查（因为修改的是自己的密码）

### 2. 前端路由（router/index.js）

在 `children` 数组中添加：

```javascript
{
  path: 'system-config',
  redirect: '/system-config/change-password',
  meta: { title: '系统配置' }
},
{
  path: 'system-config/change-password',
  name: 'ChangePassword',
  component: () => import('../views/ChangePassword.vue'),
  meta: { title: '修改密码' }
}
```

### 3. 前端页面（ChangePassword.vue）

创建新页面，包含：
- 页面标题："修改密码"
- 表单字段：
  - 旧密码（必填，密码类型）
  - 新密码（必填，密码类型，最少6位）
  - 确认新密码（必填，必须与新密码一致）
- 表单验证规则
- "保存"和"重置"按钮
- 调用 `changePassword` API 提交修改
- Apple风格设计，与现有页面保持一致

## 影响范围分析

### 后端影响
- ✅ 仅修改菜单生成逻辑，不影响现有功能
- ✅ 新增菜单项，所有登录用户可见
- ✅ 不涉及数据库变更

### 前端影响
- ✅ 新增页面和路由，不影响现有页面
- ✅ 菜单自动从后端获取，无需手动修改菜单配置
- ✅ 使用现有API接口，无需新增接口

### 用户体验影响
- ✅ 所有登录用户都可以在侧边栏看到"系统配置"菜单
- ✅ 点击后展开显示"修改密码"子菜单
- ✅ 点击"修改密码"进入修改密码页面

## 开发步骤

1. 修改后端 `UserService.java`，添加"系统配置"菜单
2. 创建前端 `ChangePassword.vue` 页面
3. 添加前端路由配置
4. 测试功能：登录后查看菜单、修改密码流程

## 注意事项

1. 菜单路径使用 `/system-config` 作为父路径
2. 修改密码页面需要验证旧密码正确性（后端已实现）
3. 新密码需要满足最小长度要求（后端已实现）
4. 修改成功后可以提示用户重新登录（可选）
