# IoT Platform è½»é‡çº§ç‰©è”ç½‘å¹³å°

> åŸºäº Spring Boot + Vue 3 çš„è½»é‡çº§ç‰©è”ç½‘ç®¡ç†å¹³å°ï¼Œæ”¯æŒè®¾å¤‡æ¥å…¥ã€æ•°æ®é‡‡é›†ã€å‘Šè­¦ç›‘æ§ã€æƒé™ç®¡ç†ç­‰åŠŸèƒ½ã€‚

## é¡¹ç›®ç®€ä»‹

IoT Platform æ˜¯ä¸€ä¸ªåŠŸèƒ½å®Œå–„çš„ç‰©è”ç½‘è®¾å¤‡ç®¡ç†å¹³å°ï¼Œé‡‡ç”¨å‰åç«¯åˆ†ç¦»æ¶æ„ï¼Œæ”¯æŒ MQTT åè®®è®¾å¤‡æ¥å…¥ï¼Œæä¾›è®¾å¤‡ç®¡ç†ã€äº§å“ç®¡ç†ã€å‘Šè­¦é…ç½®ã€ç”¨æˆ·æƒé™ç­‰æ ¸å¿ƒåŠŸèƒ½ã€‚

### ä¸»è¦ç‰¹æ€§

- ğŸš€ **è®¾å¤‡ç®¡ç†** - è®¾å¤‡æ³¨å†Œã€çŠ¶æ€ç›‘æ§ã€åœ¨çº¿/ç¦»çº¿æ£€æµ‹
- ğŸ“¦ **äº§å“ç®¡ç†** - äº§å“å®šä¹‰ã€å±æ€§é…ç½®ã€å‘½ä»¤ä¸‹å‘
- ğŸŒ³ **åˆ†ç»„ç®¡ç†** - æ ‘å½¢è®¾å¤‡åˆ†ç»„ï¼Œæ”¯æŒå¤šçº§åˆ†ç»„
- ğŸ‘¥ **æƒé™ç®¡ç†** - åŸºäºè§’è‰²çš„è®¿é—®æ§åˆ¶ (RBAC)ï¼Œæ”¯æŒæ•°æ®æƒé™è¿‡æ»¤
- ğŸ“Š **æ•°æ®é‡‡é›†** - MQTT åè®®æ•°æ®æ¥æ”¶ä¸å­˜å‚¨
- ğŸ”” **å‘Šè­¦ç³»ç»Ÿ** - å‘Šè­¦è§„åˆ™é…ç½®ã€å‘Šè­¦æ—¥å¿—ã€æ¶ˆæ¯é€šçŸ¥
- ğŸ“ˆ **æ•°æ®æŸ¥è¯¢** - è®¾å¤‡å†å²æ•°æ®æŸ¥è¯¢ä¸ç»Ÿè®¡
- ğŸ¨ **ç°ä»£åŒ–ç•Œé¢** - åŸºäº Element Plus + Tailwind CSS

## æŠ€æœ¯æ ˆ

### åç«¯

| æŠ€æœ¯ | ç‰ˆæœ¬ | è¯´æ˜ |
|------|------|------|
| Java | 11 | å¼€å‘è¯­è¨€ |
| Spring Boot | 2.7.18 | åº”ç”¨æ¡†æ¶ |
| MyBatis Plus | 3.5.3.1 | ORM æ¡†æ¶ |
| MySQL | 8.0 | å…³ç³»æ•°æ®åº“ |
| Redis | 6.2 | ç¼“å­˜æ•°æ®åº“ |
| MQTT | Eclipse Paho 1.2.5 | æ¶ˆæ¯é˜Ÿåˆ—åè®® |
| Hutool | 5.8.25 | Java å·¥å…·ç±»åº“ |
| FastJSON | 2.0.43 | JSON å¤„ç† |

### å‰ç«¯

| æŠ€æœ¯ | ç‰ˆæœ¬ | è¯´æ˜ |
|------|------|------|
| Vue | 3.3.4 | å‰ç«¯æ¡†æ¶ |
| Vue Router | 4.2.4 | è·¯ç”±ç®¡ç† |
| Element Plus | 2.3.14 | UI ç»„ä»¶åº“ |
| Axios | 1.5.0 | HTTP å®¢æˆ·ç«¯ |
| ECharts | 5.4.3 | æ•°æ®å¯è§†åŒ– |
| Tailwind CSS | 4.1.18 | CSS æ¡†æ¶ |
| Vite | 4.4.9 | æ„å»ºå·¥å…· |

### åŸºç¡€è®¾æ–½

| ç»„ä»¶ | ç‰ˆæœ¬ | è¯´æ˜ |
|------|------|------|
| EMQX | 5.3 | MQTT Broker |
| Nginx | - | åå‘ä»£ç† |

## é¡¹ç›®ç»“æ„

```
IOT/
â”œâ”€â”€ backend/                    # åç«¯é¡¹ç›®
â”‚   â”œâ”€â”€ src/main/java/com/iot/platform/
â”‚   â”‚   â”œâ”€â”€ IotPlatformApplication.java    # å¯åŠ¨ç±»
â”‚   â”‚   â”œâ”€â”€ common/            # å…¬å…±ç±»
â”‚   â”‚   â”‚   â””â”€â”€ Result.java    # ç»Ÿä¸€å“åº”ç»“æœ
â”‚   â”‚   â”œâ”€â”€ config/            # é…ç½®ç±»
â”‚   â”‚   â”‚   â”œâ”€â”€ MybatisPlusConfig.java
â”‚   â”‚   â”‚   â””â”€â”€ WebMvcConfig.java
â”‚   â”‚   â”œâ”€â”€ controller/        # æ§åˆ¶å™¨
â”‚   â”‚   â”‚   â”œâ”€â”€ DeviceController.java
â”‚   â”‚   â”‚   â”œâ”€â”€ ProductController.java
â”‚   â”‚   â”‚   â”œâ”€â”€ UserController.java
â”‚   â”‚   â”‚   â”œâ”€â”€ NotificationController.java
â”‚   â”‚   â”‚   â””â”€â”€ ...
â”‚   â”‚   â”œâ”€â”€ dto/               # æ•°æ®ä¼ è¾“å¯¹è±¡
â”‚   â”‚   â”œâ”€â”€ entity/            # å®ä½“ç±»
â”‚   â”‚   â”‚   â”œâ”€â”€ Device.java
â”‚   â”‚   â”‚   â”œâ”€â”€ Product.java
â”‚   â”‚   â”‚   â”œâ”€â”€ DeviceData.java
â”‚   â”‚   â”‚   â”œâ”€â”€ Notification.java
â”‚   â”‚   â”‚   â””â”€â”€ ...
â”‚   â”‚   â”œâ”€â”€ mapper/            # MyBatis Mapper
â”‚   â”‚   â”œâ”€â”€ mqtt/              # MQTT ç›¸å…³
â”‚   â”‚   â”‚   â”œâ”€â”€ MqttConfig.java
â”‚   â”‚   â”‚   â”œâ”€â”€ MqttMessageHandler.java
â”‚   â”‚   â”‚   â””â”€â”€ MqttPublisher.java
â”‚   â”‚   â”œâ”€â”€ service/           # ä¸šåŠ¡é€»è¾‘å±‚
â”‚   â”‚   â”œâ”€â”€ task/              # å®šæ—¶ä»»åŠ¡
â”‚   â”‚   â”‚   â””â”€â”€ DeviceStatusCheckTask.java
â”‚   â”‚   â””â”€â”€ util/              # å·¥å…·ç±»
â”‚   â”œâ”€â”€ src/main/resources/
â”‚   â”‚   â”œâ”€â”€ application.yml    # åº”ç”¨é…ç½®
â”‚   â”‚   â””â”€â”€ db/migration/      # æ•°æ®åº“è¿ç§»è„šæœ¬
â”‚   â”œâ”€â”€ Dockerfile             # åç«¯ Docker é•œåƒ
â”‚   â””â”€â”€ pom.xml                # Maven é…ç½®
â”œâ”€â”€ frontend/                  # å‰ç«¯é¡¹ç›®
â”‚   â”œâ”€â”€ src/
â”‚   â”‚   â”œâ”€â”€ api/               # API æ¥å£
â”‚   â”‚   â”œâ”€â”€ components/        # å…¬å…±ç»„ä»¶
â”‚   â”‚   â”œâ”€â”€ layouts/           # å¸ƒå±€ç»„ä»¶
â”‚   â”‚   â”œâ”€â”€ router/            # è·¯ç”±é…ç½®
â”‚   â”‚   â”œâ”€â”€ styles/            # æ ·å¼æ–‡ä»¶
â”‚   â”‚   â”œâ”€â”€ utils/             # å·¥å…·å‡½æ•°
â”‚   â”‚   â”œâ”€â”€ views/             # é¡µé¢ç»„ä»¶
â”‚   â”‚   â”‚   â”œâ”€â”€ Login.vue
â”‚   â”‚   â”‚   â”œâ”€â”€ Dashboard.vue
â”‚   â”‚   â”‚   â”œâ”€â”€ DeviceManagement.vue
â”‚   â”‚   â”‚   â”œâ”€â”€ AlarmLog.vue
â”‚   â”‚   â”‚   â””â”€â”€ ...
â”‚   â”‚   â”œâ”€â”€ App.vue            # æ ¹ç»„ä»¶
â”‚   â”‚   â””â”€â”€ main.js            # å…¥å£æ–‡ä»¶
â”‚   â”œâ”€â”€ Dockerfile             # å‰ç«¯ Docker é•œåƒ
â”‚   â”œâ”€â”€ package.json           # ä¾èµ–é…ç½®
â”‚   â””â”€â”€ vite.config.js         # Vite é…ç½®
â”œâ”€â”€ docker-compose.yml         # Docker Compose ç¼–æ’
â”œâ”€â”€ init.sql                   # æ•°æ®åº“åˆå§‹åŒ–è„šæœ¬
â””â”€â”€ README.md                  # é¡¹ç›®è¯´æ˜æ–‡æ¡£
```

## æ ¸å¿ƒåŠŸèƒ½æ¨¡å—

### 1. è®¾å¤‡ç®¡ç†

- è®¾å¤‡æ³¨å†Œä¸é…ç½®
- è®¾å¤‡çŠ¶æ€ç›‘æ§ï¼ˆåœ¨çº¿/ç¦»çº¿ï¼‰
- è®¾å¤‡åˆ†ç»„ç®¡ç†
- è®¾å¤‡æ•°æ®æŸ¥è¯¢
- è®¾å¤‡ç»Ÿè®¡æ•°æ®

### 2. äº§å“ç®¡ç†

- äº§å“å®šä¹‰ä¸æ¨¡å‹é…ç½®
- äº§å“å±æ€§å®šä¹‰ï¼ˆæ¸©åº¦ã€æ¹¿åº¦ç­‰ï¼‰
- äº§å“å‘½ä»¤é…ç½®ï¼ˆå¼€å…³ã€æ§åˆ¶ç­‰ï¼‰
- äº§å“å¯ç”¨/ç¦ç”¨

### 3. å‘Šè­¦ç³»ç»Ÿ

- å‘Šè­¦è§„åˆ™é…ç½®ï¼ˆé˜ˆå€¼å‘Šè­¦ï¼‰
- å‘Šè­¦çº§åˆ«åˆ†ç±»ï¼ˆä¸¥é‡/è­¦å‘Š/æç¤ºï¼‰
- å‘Šè­¦æ—¥å¿—è®°å½•
- æ¶ˆæ¯é€šçŸ¥æ¨é€
- å‘Šè­¦å¤„ç†ä¸æ¢å¤

### 4. æƒé™ç®¡ç†

- ç”¨æˆ·ç®¡ç†
- è§’è‰²ç®¡ç†
- èœå•æƒé™æ§åˆ¶
- æ•°æ®æƒé™è¿‡æ»¤ï¼ˆåˆ†ç»„çº§åˆ«ï¼‰

### 5. æ•°æ®é‡‡é›†

- MQTT æ¶ˆæ¯æ¥æ”¶
- è®¾å¤‡æ•°æ®ä¸ŠæŠ¥å¤„ç†
- å†å²æ•°æ®å­˜å‚¨
- æ•°æ®åˆ†åŒºç®¡ç†

## æ•°æ®åº“è®¾è®¡

### æ ¸å¿ƒè¡¨ç»“æ„

| è¡¨å | è¯´æ˜ |
|------|------|
| `tb_user` | ç”¨æˆ·è¡¨ |
| `tb_role` | è§’è‰²è¡¨ |
| `tb_menu` | èœå•è¡¨ |
| `tb_device_group` | è®¾å¤‡åˆ†ç»„è¡¨ |
| `tb_product` | äº§å“è¡¨ |
| `tb_attribute` | äº§å“å±æ€§è¡¨ |
| `tb_command` | äº§å“å‘½ä»¤è¡¨ |
| `tb_device` | è®¾å¤‡è¡¨ |
| `tb_device_data` | è®¾å¤‡æ•°æ®è¡¨ |
| `tb_command_log` | å‘½ä»¤ä¸‹å‘è®°å½•è¡¨ |
| `tb_notification` | æ¶ˆæ¯é€šçŸ¥è¡¨ |
| `tb_alarm_log` | å‘Šè­¦æ—¥å¿—è¡¨ |

## å¿«é€Ÿå¼€å§‹

### ç¯å¢ƒè¦æ±‚

- JDK 11+
- Node.js 16+
- Maven 3.6+
- Docker & Docker Composeï¼ˆå¯é€‰ï¼‰

### ä½¿ç”¨ Docker Compose å¯åŠ¨ï¼ˆæ¨èï¼‰

```bash
# å¯åŠ¨æ‰€æœ‰æœåŠ¡ï¼ˆMySQLã€Redisã€EMQXï¼‰
docker-compose up -d

# æŸ¥çœ‹æœåŠ¡çŠ¶æ€
docker-compose ps
```

### åç«¯å¯åŠ¨

```bash
# è¿›å…¥åç«¯ç›®å½•
cd backend

# ç¼–è¯‘æ‰“åŒ…
mvn clean package

# è¿è¡Œåº”ç”¨
java -jar target/iot-platform.jar

# æˆ–ä½¿ç”¨ Maven è¿è¡Œ
mvn spring-boot:run
```

### å‰ç«¯å¯åŠ¨

```bash
# è¿›å…¥å‰ç«¯ç›®å½•
cd frontend

# å®‰è£…ä¾èµ–
npm install

# å¯åŠ¨å¼€å‘æœåŠ¡å™¨
npm run dev

# æ„å»ºç”Ÿäº§ç‰ˆæœ¬
npm run build
```

### é»˜è®¤è´¦å·

| ç”¨æˆ·å | å¯†ç  | è§’è‰² |
|--------|------|------|
| admin | admin123456 | è¶…çº§ç®¡ç†å‘˜ |

## é…ç½®è¯´æ˜

### åç«¯é…ç½® (application.yml)

```yaml
server:
  port: 8080  # æœåŠ¡ç«¯å£

spring:
  datasource:
    url: jdbc:mysql://localhost:3306/iot_platform
    username: root
    password: root123456
  
  redis:
    host: localhost
    port: 16379
    password: redis123456

mqtt:
  broker-url: tcp://localhost:1883
  client-id: iot-platform-backend
  username: admin
  password: admin123.
```

### MQTT ä¸»é¢˜é…ç½®

| ä¸»é¢˜ | æ–¹å‘ | è¯´æ˜ |
|------|------|------|
| `ssc/+/report` | è®¾å¤‡ â†’ å¹³å° | è®¾å¤‡æ•°æ®ä¸ŠæŠ¥ |
| `ssc/{deviceCode}/command` | å¹³å° â†’ è®¾å¤‡ | å‘½ä»¤ä¸‹å‘ |

## API æ–‡æ¡£

### è®¾å¤‡ç›¸å…³æ¥å£

| æ¥å£ | æ–¹æ³• | è¯´æ˜ |
|------|------|------|
| `/devices` | POST | åˆ›å»ºè®¾å¤‡ |
| `/devices/list` | POST | åˆ†é¡µæŸ¥è¯¢è®¾å¤‡åˆ—è¡¨ |
| `/devices/detail` | POST | è·å–è®¾å¤‡è¯¦æƒ… |
| `/devices/update` | POST | æ›´æ–°è®¾å¤‡ |
| `/devices/delete` | POST | åˆ é™¤è®¾å¤‡ |
| `/devices/{deviceCode}` | GET | æ ¹æ®è®¾å¤‡ç¼–ç è·å–è®¾å¤‡ |
| `/devices/latest-data` | POST | è·å–è®¾å¤‡æœ€æ–°æ•°æ® |
| `/devices/statistics` | POST | è·å–è®¾å¤‡ç»Ÿè®¡æ•°æ® |

### äº§å“ç›¸å…³æ¥å£

| æ¥å£ | æ–¹æ³• | è¯´æ˜ |
|------|------|------|
| `/products` | POST | åˆ›å»ºäº§å“ |
| `/products/list` | GET | è·å–äº§å“åˆ—è¡¨ |
| `/products/{id}` | GET | è·å–äº§å“è¯¦æƒ… |
| `/products/update` | POST | æ›´æ–°äº§å“ |
| `/products/delete` | POST | åˆ é™¤äº§å“ |

### ç”¨æˆ·ç›¸å…³æ¥å£

| æ¥å£ | æ–¹æ³• | è¯´æ˜ |
|------|------|------|
| `/auth/login` | POST | ç”¨æˆ·ç™»å½• |
| `/auth/logout` | POST | ç”¨æˆ·ç™»å‡º |
| `/users` | POST | åˆ›å»ºç”¨æˆ· |
| `/users/list` | GET | è·å–ç”¨æˆ·åˆ—è¡¨ |

## éƒ¨ç½²è¯´æ˜

### Docker éƒ¨ç½²

```bash
# æ„å»ºåç«¯é•œåƒ
cd backend
docker build -t iot-platform-backend .

# æ„å»ºå‰ç«¯é•œåƒ
cd frontend
docker build -t iot-platform-frontend .

# å¯åŠ¨æ‰€æœ‰æœåŠ¡
docker-compose up -d
```

### Nginx é…ç½®

```nginx
server {
    listen 80;
    server_name localhost;

    # å‰ç«¯é™æ€èµ„æº
    location / {
        root /usr/share/nginx/html;
        try_files $uri $uri/ /index.html;
    }

    # åç«¯ API ä»£ç†
    location /api {
        proxy_pass http://backend:8080;
        proxy_set_header Host $host;
        proxy_set_header X-Real-IP $remote_addr;
    }

    # MQTT WebSocket ä»£ç†
    location /mqtt {
        proxy_pass http://emqx:8083;
        proxy_http_version 1.1;
        proxy_set_header Upgrade $http_upgrade;
        proxy_set_header Connection "upgrade";
    }
}
```

## å¼€å‘æŒ‡å—

### æ·»åŠ æ–°çš„è®¾å¤‡ç±»å‹

1. åœ¨ `tb_product` è¡¨ä¸­åˆ›å»ºäº§å“å®šä¹‰
2. åœ¨ `tb_attribute` è¡¨ä¸­é…ç½®äº§å“å±æ€§
3. åœ¨ `tb_command` è¡¨ä¸­é…ç½®äº§å“å‘½ä»¤
4. è®¾å¤‡æŒ‰ç…§ MQTT åè®®æ ¼å¼ä¸ŠæŠ¥æ•°æ®

### æ·»åŠ æ–°çš„å‘Šè­¦è§„åˆ™

1. åœ¨è®¾å¤‡é…ç½®ä¸­è®¾ç½®å‘Šè­¦å‚æ•°
2. å‘Šè­¦è§„åˆ™å­˜å‚¨åœ¨ `tb_device.alarm_config` å­—æ®µï¼ˆJSON æ ¼å¼ï¼‰
3. ç³»ç»Ÿè‡ªåŠ¨æ£€æµ‹å¹¶è§¦å‘å‘Šè­¦

### è‡ªå®šä¹‰æƒé™

1. åœ¨ `tb_role` è¡¨ä¸­å®šä¹‰è§’è‰²
2. åœ¨ `tb_menu` è¡¨ä¸­é…ç½®èœå•æƒé™
3. å°†è§’è‰²åˆ†é…ç»™ç”¨æˆ·

## å¸¸è§é—®é¢˜

### 1. è®¾å¤‡ç¦»çº¿æ£€æµ‹

ç³»ç»Ÿé»˜è®¤æ¯ 5 åˆ†é’Ÿæ£€æŸ¥ä¸€æ¬¡è®¾å¤‡åœ¨çº¿çŠ¶æ€ï¼Œè¶…æ—¶æ—¶é—´å¯åœ¨ `tb_device.offline_timeout` å­—æ®µé…ç½®ã€‚

### 2. æ•°æ®åˆ†åŒºç®¡ç†

è®¾å¤‡æ•°æ®è¡¨æŒ‰æœˆåˆ†åŒºï¼Œéœ€è¦å®šæœŸåˆ›å»ºæ–°çš„åˆ†åŒºï¼Œå‚è€ƒ `init.sql` ä¸­çš„åˆ†åŒºå®šä¹‰ã€‚

### 3. å‘Šè­¦é€šçŸ¥

å‘Šè­¦é€šçŸ¥é€šè¿‡ `tb_notification` è¡¨è®°å½•ï¼Œå‰ç«¯è½®è¯¢è·å–æœªè¯»é€šçŸ¥ã€‚

## è®¸å¯è¯

MIT License

## è´¡çŒ®

æ¬¢è¿æäº¤ Issue å’Œ Pull Requestï¼

## è”ç³»æ–¹å¼

å¦‚æœ‰é—®é¢˜ï¼Œè¯·æäº¤ Issue æˆ–è”ç³»é¡¹ç›®ç»´æŠ¤è€…ã€‚
