# IoT Platform è½»é‡çº§ç‰©è”ç½‘å¹³å°

> åŸºäº Spring Boot + Vue 3 çš„è½»é‡çº§ç‰©è”ç½‘ç®¡ç†å¹³å°ï¼Œæ”¯æŒè®¾å¤‡æ¥å…¥ã€æ•°æ®é‡‡é›†ã€å‘Šè­¦ç›‘æ§ã€æƒé™ç®¡ç†ç­‰åŠŸèƒ½ã€‚

## é¡¹ç›®ç®€ä»‹

IoT Platform æ˜¯ä¸€ä¸ªåŠŸèƒ½å®Œå–„çš„ç‰©è”ç½‘è®¾å¤‡ç®¡ç†å¹³å°ï¼Œé‡‡ç”¨å‰åç«¯åˆ†ç¦»æ¶æ„ï¼Œæ”¯æŒ MQTT åè®®è®¾å¤‡æ¥å…¥ï¼Œæä¾›è®¾å¤‡ç®¡ç†ã€äº§å“ç®¡ç†ã€å‘Šè­¦é…ç½®ã€ç”¨æˆ·æƒé™ç­‰æ ¸å¿ƒåŠŸèƒ½ã€‚

### ä¸»è¦ç‰¹æ€§

- ğŸš€ **è®¾å¤‡ç®¡ç†** - è®¾å¤‡æ³¨å†Œã€çŠ¶æ€ç›‘æ§ã€åœ¨çº¿/ç¦»çº¿æ£€æµ‹
- ğŸ“¦ **äº§å“ç®¡ç†** - äº§å“å®šä¹‰ã€å±æ€§é…ç½®ã€å‘½ä»¤ä¸‹å‘
- ğŸŒ³ **åˆ†ç»„ç®¡ç†** - æ ‘å½¢è®¾å¤‡åˆ†ç»„ï¼Œæ”¯æŒå¤šçº§åˆ†ç»„
- ğŸ‘¥ **æƒé™ç®¡ç†** - åŸºäºè§’è‰²çš„è®¿é—®æ§åˆ¶ (RBAC)ï¼Œæ”¯æŒæ•°æ®æƒé™è¿‡æ»¤
- ğŸ“Š **æ•°æ®é‡‡é›†** - MQTT åè®®æ•°æ®æ¥æ”¶ä¸å­˜å‚¨
- ğŸ”” **å‘Šè­¦ç³»ç»Ÿ** - å‘Šè­¦è§„åˆ™é…ç½®ã€å‘Šè­¦ç»Ÿè®¡ã€æ¶ˆæ¯é€šçŸ¥
- ğŸ“ˆ **æ•°æ®æ¦‚è§ˆ** - è®¾å¤‡ç»Ÿè®¡ã€å›¾è¡¨å±•ç¤º
- ğŸ¨ **ç°ä»£åŒ–ç•Œé¢** - åŸºäº Element Plus + Tailwind CSS

## æŠ€æœ¯æ ˆ

### åç«¯

| æŠ€æœ¯ | ç‰ˆæœ¬ | è¯´æ˜ |
|------|------|------|
| Java | 11+ | å¼€å‘è¯­è¨€ |
| Spring Boot | 2.7.18 | åº”ç”¨æ¡†æ¶ |
| MyBatis Plus | 3.5.3.1 | ORM æ¡†æ¶ |
| MySQL | 8.0 | å…³ç³»æ•°æ®åº“ |
| Redis | 6.2 | ç¼“å­˜æ•°æ®åº“ |
| MQTT | Eclipse Paho 1.2.5 | æ¶ˆæ¯é˜Ÿåˆ—åè®® |
| Hutool | 5.8.25 | Java å·¥å…·ç±»åº“ |
| FastJSON | 2.0.43 | JSON å¤„ç† |

### å‰ç«¯

| æŠ€æœ¯ | ç‰ˆæœ¬ | è¯´æ˜ |
|------|------|------|
| Vue | 3.3.4 | å‰ç«¯æ¡†æ¶ |
| Vue Router | 4.2.4 | è·¯ç”±ç®¡ç† |
| Element Plus | 2.3.14 | UI ç»„ä»¶åº“ |
| Axios | 1.5.0 | HTTP å®¢æˆ·ç«¯ |
| ECharts | 5.4.3 | æ•°æ®å¯è§†åŒ– |
| Tailwind CSS | 4.1.18 | CSS æ¡†æ¶ |
| Vite | 4.4.9 | æ„å»ºå·¥å…· |

### åŸºç¡€è®¾æ–½

| ç»„ä»¶ | ç‰ˆæœ¬ | è¯´æ˜ |
|------|------|------|
| EMQX | 5.3 | MQTT Broker |
| Nginx | - | åå‘ä»£ç† |
| Docker | - | å®¹å™¨åŒ–éƒ¨ç½² |

## é¡¹ç›®ç»“æ„

```
IOT/
â”œâ”€â”€ backend/                    # åç«¯é¡¹ç›®
â”‚   â”œâ”€â”€ src/main/java/com/iot/platform/
â”‚   â”‚   â”œâ”€â”€ IotPlatformApplication.java
â”‚   â”‚   â”œâ”€â”€ common/             # å…¬å…±ç±»
â”‚   â”‚   â”œâ”€â”€ config/             # é…ç½®ç±»
â”‚   â”‚   â”œâ”€â”€ controller/         # æ§åˆ¶å™¨
â”‚   â”‚   â”œâ”€â”€ dto/                # æ•°æ®ä¼ è¾“å¯¹è±¡
â”‚   â”‚   â”œâ”€â”€ entity/             # å®ä½“ç±»
â”‚   â”‚   â”œâ”€â”€ mapper/             # MyBatis Mapper
â”‚   â”‚   â”œâ”€â”€ mqtt/               # MQTT ç›¸å…³
â”‚   â”‚   â”œâ”€â”€ service/            # ä¸šåŠ¡é€»è¾‘å±‚
â”‚   â”‚   â”œâ”€â”€ task/               # å®šæ—¶ä»»åŠ¡
â”‚   â”‚   â””â”€â”€ util/               # å·¥å…·ç±»
â”‚   â”œâ”€â”€ src/main/resources/
â”‚   â”‚   â””â”€â”€ application.yml     # åº”ç”¨é…ç½®
â”‚   â””â”€â”€ pom.xml
â”‚
â”œâ”€â”€ frontend/                   # å‰ç«¯é¡¹ç›®
â”‚   â”œâ”€â”€ src/
â”‚   â”‚   â”œâ”€â”€ api/                # API æ¥å£
â”‚   â”‚   â”œâ”€â”€ components/         # å…¬å…±ç»„ä»¶
â”‚   â”‚   â”‚   â”œâ”€â”€ GroupSelector.vue   # åˆ†ç»„é€‰æ‹©å™¨
â”‚   â”‚   â”‚   â”œâ”€â”€ GroupTree.vue       # åˆ†ç»„æ ‘
â”‚   â”‚   â”‚   â””â”€â”€ NotificationPanel.vue
â”‚   â”‚   â”œâ”€â”€ layouts/            # å¸ƒå±€ç»„ä»¶
â”‚   â”‚   â”‚   â””â”€â”€ MainLayout.vue  # ä¸»å¸ƒå±€
â”‚   â”‚   â”œâ”€â”€ router/             # è·¯ç”±é…ç½®
â”‚   â”‚   â”œâ”€â”€ views/              # é¡µé¢ç»„ä»¶
â”‚   â”‚   â”‚   â”œâ”€â”€ Overview.vue        # æ•°æ®æ¦‚è§ˆ
â”‚   â”‚   â”‚   â”œâ”€â”€ DeviceManagement.vue # è®¾å¤‡ç®¡ç†
â”‚   â”‚   â”‚   â”œâ”€â”€ DeviceDetail.vue    # è®¾å¤‡è¯¦æƒ…
â”‚   â”‚   â”‚   â”œâ”€â”€ DeviceGroups.vue    # è®¾å¤‡åˆ†ç»„
â”‚   â”‚   â”‚   â”œâ”€â”€ ProductList.vue     # äº§å“åˆ—è¡¨
â”‚   â”‚   â”‚   â”œâ”€â”€ ProductDetail.vue   # äº§å“è¯¦æƒ…
â”‚   â”‚   â”‚   â”œâ”€â”€ AlarmLog.vue        # æŠ¥è­¦ç»Ÿè®¡
â”‚   â”‚   â”‚   â”œâ”€â”€ AlarmThresholdConfig.vue # æŠ¥è­¦é…ç½®
â”‚   â”‚   â”‚   â”œâ”€â”€ UserManagement.vue  # ç”¨æˆ·ç®¡ç†
â”‚   â”‚   â”‚   â”œâ”€â”€ RoleManagement.vue  # è§’è‰²ç®¡ç†
â”‚   â”‚   â”‚   â””â”€â”€ ...
â”‚   â”‚   â”œâ”€â”€ App.vue
â”‚   â”‚   â””â”€â”€ main.js
â”‚   â”œâ”€â”€ package.json
â”‚   â””â”€â”€ vite.config.js
â”‚
â”œâ”€â”€ scripts/                    # è¿ç»´è„šæœ¬
â”‚   â”œâ”€â”€ build-frontend.bat      # å‰ç«¯ç¼–è¯‘
â”‚   â”œâ”€â”€ build-backend.bat       # åç«¯ç¼–è¯‘
â”‚   â”œâ”€â”€ deploy-frontend.bat     # å‰ç«¯éƒ¨ç½²
â”‚   â”œâ”€â”€ deploy-backend.bat      # åç«¯éƒ¨ç½²
â”‚   â”œâ”€â”€ pull-code.bat           # æ‹‰å–ä»£ç 
â”‚   â”œâ”€â”€ push-code.bat           # æ¨é€ä»£ç 
â”‚   â”œâ”€â”€ sync-db.bat             # æ•°æ®åº“åŒæ­¥
â”‚   â”œâ”€â”€ start-dev.bat           # å¯åŠ¨å¼€å‘ç¯å¢ƒ
â”‚   â””â”€â”€ deploy-config.template.txt  # éƒ¨ç½²é…ç½®æ¨¡æ¿
â”‚
â”œâ”€â”€ sql/                        # æ•°æ®åº“è„šæœ¬
â”‚   â””â”€â”€ migrations/             # è¿ç§»è„šæœ¬
â”‚       â”œâ”€â”€ 001_create_migration_history.sql
â”‚       â””â”€â”€ 002_add_alarm_log_fields.sql
â”‚
â”œâ”€â”€ docker-compose.yml          # Docker Compose ç¼–æ’
â”œâ”€â”€ init.sql                    # æ•°æ®åº“åˆå§‹åŒ–è„šæœ¬
â”œâ”€â”€ .cursorrules                # é¡¹ç›®å¼€å‘è§„èŒƒ
â””â”€â”€ README.md
```

## æ ¸å¿ƒåŠŸèƒ½æ¨¡å—

### 1. æ•°æ®æ¦‚è§ˆ (`/overview`)
- è®¾å¤‡åœ¨çº¿/ç¦»çº¿ç»Ÿè®¡
- ä»Šæ—¥å‘Šè­¦æ•°é‡ç»Ÿè®¡
- è®¾å¤‡çŠ¶æ€åˆ†å¸ƒå›¾è¡¨
- æœ€è¿‘å‘Šè­¦åˆ—è¡¨

### 2. è®¾å¤‡ç®¡ç† (`/devices`)
- è®¾å¤‡åˆ—è¡¨ï¼ˆåœ¨çº¿ä¼˜å…ˆæ’åºï¼‰
- è®¾å¤‡æ–°å¢/ç¼–è¾‘/åˆ é™¤
- è®¾å¤‡çŠ¶æ€ç›‘æ§
- è®¾å¤‡è¯¦æƒ…æŸ¥çœ‹
- è®¾å¤‡æ•°æ®æŸ¥è¯¢

### 3. è®¾å¤‡åˆ†ç»„ (`/groups`)
- æ ‘å½¢åˆ†ç»„ç»“æ„
- åˆ†ç»„æ–°å¢/ç¼–è¾‘/åˆ é™¤
- åˆ†ç»„è®¾å¤‡æ•°é‡ç»Ÿè®¡

### 4. äº§å“ç®¡ç† (`/products`)
- äº§å“åˆ—è¡¨
- äº§å“å±æ€§é…ç½®
- äº§å“å‘½ä»¤é…ç½®
- äº§å“å¯ç”¨/ç¦ç”¨

### 5. æŠ¥è­¦ç»Ÿè®¡ (`/alarms`)
- å‘Šè­¦æ—¥å¿—åˆ—è¡¨
- å‘Šè­¦å¤„ç†
- å‘Šè­¦æ¢å¤
- å‘Šè­¦ç»Ÿè®¡åˆ†æ

### 6. æŠ¥è­¦é…ç½® (`/alarm-threshold`)
- è®¾å¤‡å‘Šè­¦è§„åˆ™é…ç½®
- é˜ˆå€¼è®¾ç½®
- é€šçŸ¥äººå‘˜é…ç½®

### 7. ç”¨æˆ·ç®¡ç† (`/users`)
- ç”¨æˆ·åˆ—è¡¨
- ç”¨æˆ·æ–°å¢/ç¼–è¾‘/åˆ é™¤
- ç”¨æˆ·åˆ†ç»„åˆ†é…

### 8. è§’è‰²ç®¡ç† (`/roles`)
- è§’è‰²åˆ—è¡¨
- è§’è‰²æƒé™é…ç½®
- èœå•æƒé™åˆ†é…

## æ•°æ®åº“è®¾è®¡

### æ ¸å¿ƒè¡¨ç»“æ„

| è¡¨å | è¯´æ˜ |
|------|------|
| `tb_user` | ç”¨æˆ·è¡¨ |
| `tb_role` | è§’è‰²è¡¨ |
| `tb_menu` | èœå•è¡¨ |
| `tb_device_group` | è®¾å¤‡åˆ†ç»„è¡¨ |
| `tb_product` | äº§å“è¡¨ |
| `tb_attribute` | äº§å“å±æ€§è¡¨ |
| `tb_command` | äº§å“å‘½ä»¤è¡¨ |
| `tb_device` | è®¾å¤‡è¡¨ |
| `tb_device_data` | è®¾å¤‡æ•°æ®è¡¨ |
| `tb_device_log` | è®¾å¤‡æ—¥å¿—è¡¨ |
| `tb_command_log` | å‘½ä»¤ä¸‹å‘è®°å½•è¡¨ |
| `tb_notification` | æ¶ˆæ¯é€šçŸ¥è¡¨ |
| `tb_alarm_log` | å‘Šè­¦æ—¥å¿—è¡¨ |
| `tb_migration_history` | æ•°æ®åº“è¿ç§»è®°å½•è¡¨ |
| `system_config` | ç³»ç»Ÿé…ç½®è¡¨ |

### æ•°æ®åº“è¿ç§»

é¡¹ç›®ä½¿ç”¨è¿ç§»è„šæœ¬ç®¡ç†æ•°æ®åº“ç»“æ„å˜æ›´ï¼š

```bash
# è¿ç§»è„šæœ¬ä½ç½®
sql/migrations/

# åŒæ­¥æ•°æ®åº“
åŒå‡» scripts/sync-db.bat
```

## å¿«é€Ÿå¼€å§‹

### ç¯å¢ƒè¦æ±‚

- JDK 11+
- Node.js 16+
- Maven 3.6+
- Docker & Docker Compose

### 1. å¯åŠ¨åŸºç¡€æœåŠ¡

```bash
# å¯åŠ¨ MySQLã€Redisã€EMQX
docker-compose up -d

# æŸ¥çœ‹æœåŠ¡çŠ¶æ€
docker-compose ps
```

### 2. ç¼–è¯‘é¡¹ç›®

```bash
# æ–¹å¼ä¸€ï¼šä½¿ç”¨è„šæœ¬ï¼ˆæ¨èï¼‰
åŒå‡» scripts/build-backend.bat   # ç¼–è¯‘åç«¯
åŒå‡» scripts/build-frontend.bat  # ç¼–è¯‘å‰ç«¯

# æ–¹å¼äºŒï¼šå‘½ä»¤è¡Œ
cd backend && mvn clean package -DskipTests
cd frontend && npm install && npm run build
```

### 3. å¯åŠ¨å¼€å‘ç¯å¢ƒ

```bash
# æ–¹å¼ä¸€ï¼šä½¿ç”¨è„šæœ¬
åŒå‡» scripts/start-dev.bat

# æ–¹å¼äºŒï¼šåˆ†åˆ«å¯åŠ¨
# åç«¯
cd backend && mvn spring-boot:run

# å‰ç«¯ï¼ˆæ–°ç»ˆç«¯ï¼‰
cd frontend && npm run dev
```

### 4. è®¿é—®ç³»ç»Ÿ

- å‰ç«¯å¼€å‘ï¼šhttp://localhost:5173
- åç«¯æ¥å£ï¼šhttp://localhost:8080
- EMQX æ§åˆ¶å°ï¼šhttp://localhost:18083

### é»˜è®¤è´¦å·

| ç”¨æˆ·å | å¯†ç  | è§’è‰² |
|--------|------|------|
| admin | admin123456 | è¶…çº§ç®¡ç†å‘˜ |

## å¸¸ç”¨è„šæœ¬

| è„šæœ¬ | è¯´æ˜ |
|------|------|
| `scripts/build-frontend.bat` | ç¼–è¯‘å‰ç«¯ (`npm run build`) |
| `scripts/build-backend.bat` | ç¼–è¯‘åç«¯ (`mvn clean package`) |
| `scripts/deploy-frontend.bat` | éƒ¨ç½²å‰ç«¯åˆ°æœåŠ¡å™¨ |
| `scripts/deploy-backend.bat` | éƒ¨ç½²åç«¯åˆ°æœåŠ¡å™¨ |
| `scripts/pull-code.bat` | ä»è¿œç¨‹æ‹‰å–ä»£ç ï¼ˆä¼šè¦†ç›–æœ¬åœ°ï¼‰ |
| `scripts/push-code.bat` | æäº¤å¹¶æ¨é€ä»£ç åˆ°è¿œç¨‹ |
| `scripts/sync-db.bat` | åŒæ­¥æ•°æ®åº“è¿ç§»è„šæœ¬ |
| `scripts/start-dev.bat` | å¯åŠ¨æœ¬åœ°å¼€å‘ç¯å¢ƒ |

### éƒ¨ç½²é…ç½®

é¦–æ¬¡éƒ¨ç½²éœ€è¦é…ç½®æœåŠ¡å™¨ä¿¡æ¯ï¼š

```bash
# 1. å¤åˆ¶é…ç½®æ¨¡æ¿
copy scripts/deploy-config.template.txt scripts/deploy-config.txt

# 2. ç¼–è¾‘é…ç½®æ–‡ä»¶
REMOTE_HOST=your-server-ip
REMOTE_PORT=22
REMOTE_USER=root
REMOTE_BACKEND_PATH=/opt/iot-platform/backend
REMOTE_FRONTEND_PATH=/opt/iot-platform/frontend
REMOTE_BACKEND_SERVICE=iot-platform
```

## é…ç½®è¯´æ˜

### åç«¯é…ç½® (application.yml)

```yaml
server:
  port: 8080

spring:
  datasource:
    url: jdbc:mysql://localhost:3306/iot_platform
    username: root
    password: root123456
  
  redis:
    host: localhost
    port: 16379
    password: redis123456

mqtt:
  broker-url: tcp://localhost:1883
  client-id: iot-platform-backend
  username: admin
  password: admin123.
```

### MQTT ä¸»é¢˜é…ç½®

| ä¸»é¢˜ | æ–¹å‘ | è¯´æ˜ |
|------|------|------|
| `ssc/+/report` | è®¾å¤‡ â†’ å¹³å° | è®¾å¤‡æ•°æ®ä¸ŠæŠ¥ |
| `ssc/{deviceCode}/command` | å¹³å° â†’ è®¾å¤‡ | å‘½ä»¤ä¸‹å‘ |

## API æ¥å£

### è®¾å¤‡æ¥å£

| æ¥å£ | æ–¹æ³• | è¯´æ˜ |
|------|------|------|
| `/devices` | POST | åˆ›å»ºè®¾å¤‡ |
| `/devices/list` | POST | åˆ†é¡µæŸ¥è¯¢è®¾å¤‡åˆ—è¡¨ |
| `/devices/detail` | POST | è·å–è®¾å¤‡è¯¦æƒ… |
| `/devices/update` | POST | æ›´æ–°è®¾å¤‡ |
| `/devices/delete` | POST | åˆ é™¤è®¾å¤‡ |
| `/devices/statistics` | POST | è·å–è®¾å¤‡ç»Ÿè®¡æ•°æ® |

### å‘Šè­¦æ¥å£

| æ¥å£ | æ–¹æ³• | è¯´æ˜ |
|------|------|------|
| `/alarm-logs/list` | POST | æŸ¥è¯¢å‘Šè­¦åˆ—è¡¨ |
| `/alarm-logs/handle` | POST | å¤„ç†å‘Šè­¦ |
| `/alarm-logs/statistics` | POST | å‘Šè­¦ç»Ÿè®¡ |

### ç”¨æˆ·æ¥å£

| æ¥å£ | æ–¹æ³• | è¯´æ˜ |
|------|------|------|
| `/auth/login` | POST | ç”¨æˆ·ç™»å½• |
| `/auth/logout` | POST | ç”¨æˆ·ç™»å‡º |
| `/users/list` | POST | è·å–ç”¨æˆ·åˆ—è¡¨ |

## å¼€å‘è§„èŒƒ

é¡¹ç›®éµå¾ª `.cursorrules` ä¸­å®šä¹‰çš„å¼€å‘è§„èŒƒï¼š

1. **ä¿®æ”¹ä¼˜å…ˆçº§**ï¼šä¼˜å…ˆä¿®æ”¹å‰ç«¯ï¼Œåç«¯ä¿®æ”¹éœ€ç¡®è®¤
2. **æ•°æ®æƒé™**ï¼šè¶…çº§ç®¡ç†å‘˜æŸ¥çœ‹æ‰€æœ‰ï¼Œæ™®é€šç”¨æˆ·æŒ‰åˆ†ç»„è¿‡æ»¤
3. **API è§„èŒƒ**ï¼šç»Ÿä¸€ POST æ–¹æ³•ï¼ŒJSON æ ¼å¼
4. **åˆ†ç»„ç»„ä»¶**ï¼šç»Ÿä¸€ä½¿ç”¨ `GroupSelector` å’Œ `GroupTree`
5. **æ—¶é—´æ ¼å¼**ï¼š`yyyy-MM-dd HH:mm:ss`
6. **æ•°æ®åº“è¿ç§»**ï¼šé€šè¿‡ `sql/migrations/` ç®¡ç†ï¼Œç¦æ­¢ç›´æ¥ä¿®æ”¹è¡¨ç»“æ„

## å¸¸è§é—®é¢˜

### 1. è®¾å¤‡ç¦»çº¿æ£€æµ‹

ç³»ç»Ÿé»˜è®¤æ¯ 5 åˆ†é’Ÿæ£€æŸ¥ä¸€æ¬¡è®¾å¤‡åœ¨çº¿çŠ¶æ€ï¼Œè¶…æ—¶æ—¶é—´å¯åœ¨è®¾å¤‡é…ç½®ä¸­è®¾ç½®ã€‚

### 2. æ•°æ®åº“å­—æ®µç¼ºå¤±

å¦‚æœå‡ºç°å­—æ®µä¸å­˜åœ¨é”™è¯¯ï¼Œè¿è¡Œæ•°æ®åº“åŒæ­¥è„šæœ¬ï¼š
```bash
åŒå‡» scripts/sync-db.bat
```

### 3. ç¼–è¯‘å¤±è´¥

ç¡®ä¿ç¯å¢ƒå˜é‡æ­£ç¡®é…ç½®ï¼š
- `JAVA_HOME` æŒ‡å‘ JDK 11+
- Maven åœ¨ PATH ä¸­
- Node.js 16+ å·²å®‰è£…

## è®¸å¯è¯

MIT License

## è´¡çŒ®

æ¬¢è¿æäº¤ Issue å’Œ Pull Requestï¼
