import{_ as h,u as z,b as f,v as O,d,o as M,e as C,f as s,g as o,w as t,E as m,q as u,t as k,F as A,I as H,A as J,Q as K}from"./index-f4aa5fa2.js";import{p as V}from"./index-9293a099.js";const W={class:"toolbar"},j={class:"input-hint"},G={__name:"ProductList",setup(X){const T=z(),i=f([]),w=f(""),c=f(!1),n=f(!1),N=f(null),a=f({id:null,productName:"",productModel:"",protocol:"MQTT",description:""}),E={productName:[{required:!0,message:"请输入产品名称",trigger:"blur"}],productModel:[{required:!0,message:"请输入产品型号",trigger:"blur"}],protocol:[{required:!0,message:"请选择协议类型",trigger:"change"}]},_=async()=>{try{console.log("开始加载产品列表...");const l=await V.getProductList();if(console.log("产品列表响应:",JSON.stringify(l,null,2)),!l){console.error("响应为空"),m.error("服务器无响应");return}l.list&&Array.isArray(l.list)?(console.log("使用 res.list，长度:",l.list.length),i.value=l.list):Array.isArray(l)?(console.log("使用 res，长度:",l.length),i.value=l):(console.warn("数据格式不正确:",typeof l),i.value=[]),console.log("最终 products.value:",i.value),console.log("产品数量:",i.value.length)}catch(l){console.error("加载产品列表失败:",l),console.error("错误堆栈:",l.stack),m.error("加载产品列表失败: "+l.message)}},R=()=>{const l=w.value.toLowerCase().trim();if(!l){_();return}i.value=i.value.filter(e=>e.productName&&e.productName.toLowerCase().includes(l)||e.productModel&&e.productModel.toLowerCase().includes(l))},B=()=>{n.value=!1,a.value={id:null,productName:"",productModel:"",protocol:"MQTT",description:""},c.value=!0},L=l=>{n.value=!0,a.value={id:l.id,productName:l.productName,productModel:l.productModel,protocol:l.protocol,description:l.description||""},c.value=!0},$=async()=>{if(N.value)try{if(await N.value.validate(),n.value){const l=await V.updateProduct({id:a.value.id,productName:a.value.productName,productModel:a.value.productModel,protocol:a.value.protocol,description:a.value.description});m.success("产品信息已更新"),c.value=!1,_()}else{const l=await V.createProduct({name:a.value.productName,code:a.value.productModel,protocol:a.value.protocol,description:a.value.description});m.success("✅ 产品创建成功！"),c.value=!1,l&&l.id?T.push(`/products/${l.id}`):_()}}catch(l){l!==!1&&(console.error("提交失败:",l),m.error(n.value?"更新产品失败":"创建产品失败"))}},D=l=>{T.push(`/products/${l.id}`)},U=async l=>{try{await K.confirm(`确定要删除产品"${l.productName}"吗？

删除后该产品的所有属性和命令也将被删除，此操作不可恢复！`,"删除确认",{confirmButtonText:"确定删除",cancelButtonText:"取消",type:"warning"}),await V.deleteProduct(l.id),m.success("产品已删除"),_()}catch(e){e!=="cancel"&&(console.error("删除产品失败:",e),m.error("删除产品失败"))}};return O(()=>{_()}),(l,e)=>{const b=d("el-input"),v=d("el-button"),P=d("el-card"),p=d("el-table-column"),F=d("el-table"),g=d("el-form-item"),y=d("el-option"),I=d("el-select"),Q=d("el-form"),S=d("el-alert"),q=d("el-dialog");return M(),C("div",null,[e[16]||(e[16]=s("h1",{class:"page-title"},"产品管理",-1)),o(P,{class:"toolbar-card"},{default:t(()=>[s("div",W,[o(b,{modelValue:w.value,"onUpdate:modelValue":e[0]||(e[0]=r=>w.value=r),placeholder:"🔍 搜索产品名称或型号...",clearable:"",style:{width:"300px"},onInput:R},null,8,["modelValue"]),o(v,{type:"primary",onClick:B},{default:t(()=>[...e[7]||(e[7]=[u("+ 创建产品",-1)])]),_:1})])]),_:1}),o(P,null,{default:t(()=>[o(F,{data:i.value,border:"",stripe:""},{default:t(()=>[o(p,{prop:"id",label:"产品ID",width:"80"}),o(p,{prop:"productName",label:"产品名称"}),o(p,{prop:"productModel",label:"产品型号"}),o(p,{prop:"protocol",label:"协议类型"}),o(p,{label:"属性数量",width:"100",align:"center"},{default:t(({row:r})=>[u(k(r.attrCount||0)+" 个 ",1)]),_:1}),o(p,{label:"命令数量",width:"100",align:"center"},{default:t(({row:r})=>[u(k(r.cmdCount||0)+" 个 ",1)]),_:1}),o(p,{prop:"createTime",label:"创建时间",width:"180"}),o(p,{label:"操作",width:"280"},{default:t(({row:r})=>[o(v,{size:"small",type:"primary",onClick:x=>D(r)},{default:t(()=>[...e[8]||(e[8]=[u("查看详情",-1)])]),_:1},8,["onClick"]),o(v,{size:"small",onClick:x=>L(r)},{default:t(()=>[...e[9]||(e[9]=[u("编辑",-1)])]),_:1},8,["onClick"]),o(v,{size:"small",type:"danger",onClick:x=>U(r)},{default:t(()=>[...e[10]||(e[10]=[u("删除",-1)])]),_:1},8,["onClick"])]),_:1})]),_:1},8,["data"])]),_:1}),o(q,{modelValue:c.value,"onUpdate:modelValue":e[6]||(e[6]=r=>c.value=r),title:n.value?"编辑产品":"创建产品",width:"600px"},{footer:t(()=>[o(v,{onClick:e[5]||(e[5]=r=>c.value=!1)},{default:t(()=>[...e[15]||(e[15]=[u("取消",-1)])]),_:1}),o(v,{type:"primary",onClick:$},{default:t(()=>[u(k(n.value?"保存修改":"确定创建"),1)]),_:1})]),default:t(()=>[o(Q,{model:a.value,"label-width":"120px",rules:E,ref_key:"productFormRef",ref:N},{default:t(()=>[o(g,{label:"产品名称",prop:"productName"},{default:t(()=>[o(b,{modelValue:a.value.productName,"onUpdate:modelValue":e[1]||(e[1]=r=>a.value.productName=r),placeholder:"如：智能水表、空气监测仪、温湿度传感器"},null,8,["modelValue"]),e[11]||(e[11]=s("div",{class:"input-hint"},"💡 给产品起一个清晰易懂的名称，方便后续管理",-1))]),_:1}),o(g,{label:"产品型号",prop:"productModel"},{default:t(()=>[o(b,{modelValue:a.value.productModel,"onUpdate:modelValue":e[2]||(e[2]=r=>a.value.productModel=r),placeholder:"如：WATER-PRO、AIR-01、TEM-SENSOR",disabled:n.value},null,8,["modelValue","disabled"]),s("div",j,[n.value?(M(),C(A,{key:1},[u("💡 产品型号创建后不可修改")],64)):(M(),C(A,{key:0},[u("💡 产品型号是唯一标识，建议使用英文+数字组合，创建后不可修改")],64))])]),_:1}),o(g,{label:"协议类型",prop:"protocol"},{default:t(()=>[o(I,{modelValue:a.value.protocol,"onUpdate:modelValue":e[3]||(e[3]=r=>a.value.protocol=r),placeholder:"请选择协议类型",style:{width:"100%"}},{default:t(()=>[o(y,{label:"MQTT（推荐，轻量级物联网协议）",value:"MQTT"}),o(y,{label:"HTTP（适合请求-响应场景）",value:"HTTP"}),o(y,{label:"CoAP（适合资源受限设备）",value:"CoAP"}),o(y,{label:"Modbus（工业设备常用）",value:"Modbus"})]),_:1},8,["modelValue"]),e[12]||(e[12]=s("div",{class:"input-hint"},"💡 选择设备使用的通信协议，影响设备接入方式",-1))]),_:1}),o(g,{label:"产品描述",prop:"description"},{default:t(()=>[o(b,{modelValue:a.value.description,"onUpdate:modelValue":e[4]||(e[4]=r=>a.value.description=r),type:"textarea",rows:4,placeholder:"描述产品的功能、用途、适用场景等..."},null,8,["modelValue"]),e[13]||(e[13]=s("div",{class:"input-hint"},"💡 详细描述有助于团队成员理解产品定位",-1))]),_:1})]),_:1},8,["model"]),n.value?J("",!0):(M(),H(S,{key:0,title:"📋 下一步操作",type:"info",closable:!1,style:{"margin-bottom":"20px"}},{default:t(()=>[...e[14]||(e[14]=[u(' 创建产品后，点击"查看详情"跳转到详情页，添加"属性"和"命令"来完整定义设备的物模型：',-1),s("br",null,null,-1),u(" • ",-1),s("strong",null,"属性",-1),u("：设备上报的数据字段（如温度、湿度、电量）",-1),s("br",null,null,-1),u(" • ",-1),s("strong",null,"命令",-1),u("：平台下发给设备的控制指令（如开关、设置参数） ",-1)])]),_:1}))]),_:1},8,["modelValue","title"])])}}},ee=h(G,[["__scopeId","data-v-26b7a9dd"]]);export{ee as default};
