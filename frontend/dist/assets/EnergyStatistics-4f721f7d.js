import{_ as ie,a7 as de,Z as ce,$ as ue,r as d,a0 as pe,o as w,c as k,b as s,e as t,w as o,a1 as T,k as fe,g as y,E,a3 as q,B as L,i as c,ab as me,T as ve,M as ge,q as M,D as _e,af as ye,t as f,a4 as Y,v as G,s as X,y as W,h as he}from"./index-d915c72b.js";import{i as B}from"./index-18acf776.js";import{g as be}from"./energy-4a4b428c.js";import{f as xe,G as we}from"./GroupTree-540811fa.js";import{g as Ce}from"./group-02a76718.js";const Se={class:"energy-statistics-page min-h-screen bg-gray-50"},De={class:"energy-container"},ze={class:"btn-left"},ke={class:"tree-hint"},Te={class:"content-panel"},Le={key:0,class:"statistics-cards mb-6"},Ne={class:"stat-content"},Ie={class:"stat-header"},Re={class:"stat-icon-wrapper stat-icon-total"},$e={class:"stat-value text-3xl font-bold text-gray-900 mb-1"},Ve={class:"stat-unit text-sm text-gray-500"},Ee={class:"stat-content"},Me={class:"stat-header"},Ye={class:"stat-icon-wrapper stat-icon-avg"},Ge={class:"stat-value text-3xl font-bold text-gray-900 mb-1"},We={class:"stat-unit text-sm text-gray-500"},Be={class:"stat-content"},He={class:"stat-header"},Ae={class:"stat-icon-wrapper stat-icon-yoy"},Oe={class:"stat-content"},Fe={class:"stat-header"},je={class:"stat-icon-wrapper stat-icon-mom"},Pe={key:1,class:"charts-row"},Qe={class:"flex items-center justify-between"},Ue={class:"flex items-center gap-2"},qe={class:"top10-table-wrapper"},Xe={class:"flex items-center gap-1.5"},Ze={class:"text-sm"},Je={class:"flex items-center justify-end gap-1"},Ke={class:"font-semibold text-gray-900 text-sm"},et={class:"text-xs text-gray-500"},tt={class:"flex items-center gap-2"},st={key:2,class:"charts-row mb-6"},ot={class:"flex items-center gap-2"},at={class:"flex items-center gap-2"},lt={__name:"EnergyStatistics",setup(nt){const C=y(!1),N=y(!1),H=y(!1),I=y(null),R=y(null),$=y(null);let v=null,g=null,_=null;const u=he({energyType:"electric",groupId:null}),h=y([]),A=y([]),Z=a=>{u.groupId=a,S()},J=()=>{u.groupId=null,S()},K=async()=>{try{const a=await Ce();a.tree&&(A.value=xe(a.tree))}catch(a){console.error("加载分组列表失败:",a)}},l=y({totalConsumption:void 0,unit:"",avgConsumption:void 0,yoy:0,mom:0,top10Devices:[]}),S=async()=>{if(!u.energyType){E.warning("请选择能源类型");return}if(!h.value||h.value.length!==2){E.warning("请选择时间范围");return}C.value=!0,H.value=!0;try{const a={energyType:u.energyType,startTime:h.value[0],endTime:h.value[1],groupId:u.groupId||null},e=await be(a);l.value={totalConsumption:e.totalConsumption||0,unit:e.unit||"",avgConsumption:e.avgConsumption||0,yoy:e.yoy||0,mom:e.mom||0,top10Devices:e.top10Devices||[]},await q(),O(),F(),j()}catch(a){console.error("查询能耗统计失败:",a),E.error(a.message||"查询失败，请稍后重试"),l.value={totalConsumption:void 0,unit:"",avgConsumption:void 0,yoy:0,mom:0,top10Devices:[]}}finally{C.value=!1}},ee=()=>{u.energyType="electric",u.groupId=null,h.value=[],l.value={totalConsumption:void 0,unit:"",avgConsumption:void 0,yoy:0,mom:0,top10Devices:[]}},b=a=>a==null||isNaN(a)?"0.00":Number(a).toFixed(2),te=a=>a===0?"rank-tag rank-tag-gold":a===1?"rank-tag rank-tag-silver":a===2?"rank-tag rank-tag-bronze":"rank-tag rank-tag-normal",O=()=>{if(!I.value||!l.value.top10Devices||l.value.top10Devices.length===0)return;v&&(v.dispose(),v=null),v=B(I.value);const a=l.value.top10Devices.map(i=>i.deviceName).slice(0,10),e=l.value.top10Devices.map(i=>i.totalConsumption).slice(0,10),n=l.value.unit||"",r={tooltip:{trigger:"axis",axisPointer:{type:"shadow"},backgroundColor:"rgba(50, 50, 50, 0.9)",borderColor:"transparent",borderWidth:0,padding:[12,16],textStyle:{color:"#fff",fontSize:13},formatter:i=>{const p=i[0];return`${p.name}<br/>能耗: ${Number(p.value).toFixed(2)} ${n}`}},grid:{left:"3%",right:"4%",bottom:"15%",top:"10%",containLabel:!0},xAxis:{type:"category",data:a,axisLine:{lineStyle:{color:"#e0e0e0"}},axisLabel:{color:"#6b7280",fontSize:12,rotate:45,interval:0},splitLine:{show:!1}},yAxis:{type:"value",name:`能耗 (${n})`,nameTextStyle:{color:"#6b7280",fontSize:12},axisLine:{show:!1},axisTick:{show:!1},axisLabel:{color:"#6b7280",fontSize:12},splitLine:{lineStyle:{color:"#f0f0f0",type:"dashed"}}},series:[{name:"能耗",type:"bar",data:e,itemStyle:{color:{type:"linear",x:0,y:0,x2:0,y2:1,colorStops:[{offset:0,color:"#667eea"},{offset:1,color:"#764ba2"}]},borderRadius:[4,4,0,0]},emphasis:{itemStyle:{color:{type:"linear",x:0,y:0,x2:0,y2:1,colorStops:[{offset:0,color:"#764ba2"},{offset:1,color:"#667eea"}]}}}}]};v.setOption(r,!0)},F=()=>{if(!R.value||!l.value.top10Devices||l.value.top10Devices.length===0)return;g&&(g.dispose(),g=null),g=B(R.value);const a=l.value.top10Devices.slice(0,5),e=["#667eea","#764ba2","#f093fb","#f5576c","#4facfe"],n=a.map((i,p)=>({value:i.totalConsumption,name:i.deviceName,itemStyle:{color:e[p%e.length],borderRadius:8,borderColor:"#fff",borderWidth:2}})),r={tooltip:{trigger:"item",backgroundColor:"rgba(50, 50, 50, 0.9)",borderColor:"transparent",borderWidth:0,padding:[12,16],textStyle:{color:"#fff",fontSize:13},formatter:"{b}<br/>{c} {a}<br/>({d}%)"},legend:{orient:"vertical",right:20,top:"center",textStyle:{color:"#6b7280",fontSize:12},itemGap:12},series:[{name:"能耗",type:"pie",radius:["45%","75%"],center:["35%","50%"],avoidLabelOverlap:!0,itemStyle:{borderRadius:8,borderColor:"#fff",borderWidth:2},label:{show:!0,formatter:`{b}
{d}%`,fontSize:11,fontWeight:500},emphasis:{label:{show:!0,fontSize:13,fontWeight:"bold"},itemStyle:{shadowBlur:10,shadowOffsetX:0,shadowColor:"rgba(0, 0, 0, 0.3)"}},data:n}]};g.setOption(r,!0)},j=()=>{if(!$.value||!l.value.top10Devices||l.value.top10Devices.length===0)return;_&&(_.dispose(),_=null),_=B($.value);const a=l.value.top10Devices.slice(0,5),e=a.map(p=>p.deviceName),n=a.map(p=>p.totalConsumption),r=l.value.unit||"",i={tooltip:{trigger:"axis",backgroundColor:"rgba(50, 50, 50, 0.9)",borderColor:"transparent",borderWidth:0,padding:[12,16],textStyle:{color:"#fff",fontSize:13},axisPointer:{type:"cross",label:{backgroundColor:"#667eea"}}},grid:{left:"3%",right:"4%",bottom:"10%",top:"10%",containLabel:!0},xAxis:{type:"category",boundaryGap:!1,data:e,axisLine:{lineStyle:{color:"#e0e0e0"}},axisLabel:{color:"#6b7280",fontSize:12,rotate:30},splitLine:{show:!1}},yAxis:{type:"value",name:`能耗 (${r})`,nameTextStyle:{color:"#6b7280",fontSize:12},axisLine:{show:!1},axisTick:{show:!1},axisLabel:{color:"#6b7280",fontSize:12},splitLine:{lineStyle:{color:"#f0f0f0",type:"dashed"}}},series:[{name:"能耗",type:"line",smooth:!0,data:n,areaStyle:{color:{type:"linear",x:0,y:0,x2:0,y2:1,colorStops:[{offset:0,color:"rgba(102, 126, 234, 0.3)"},{offset:1,color:"rgba(102, 126, 234, 0.05)"}]}},lineStyle:{color:"#667eea",width:3},itemStyle:{color:"#667eea"},symbol:"circle",symbolSize:8,emphasis:{focus:"series",itemStyle:{color:"#667eea",borderColor:"#fff",borderWidth:2}}}]};_.setOption(i,!0)},P=()=>{v&&v.resize(),g&&g.resize(),_&&_.resize()};de(()=>l.value.top10Devices,()=>{l.value.top10Devices&&l.value.top10Devices.length>0&&q(()=>{O(),F(),j()})},{deep:!0});const Q=a=>{const e=a.getFullYear(),n=String(a.getMonth()+1).padStart(2,"0"),r=String(a.getDate()).padStart(2,"0"),i=String(a.getHours()).padStart(2,"0"),p=String(a.getMinutes()).padStart(2,"0"),x=String(a.getSeconds()).padStart(2,"0");return`${e}-${n}-${r} ${i}:${p}:${x}`};return ce(async()=>{const a=new Date,e=new Date;e.setDate(e.getDate()-30),e.setHours(0,0,0,0),a.setHours(23,59,59,999),h.value=[Q(e),Q(a)],await K(),await S(),window.addEventListener("resize",P)}),ue(()=>{v&&(v.dispose(),v=null),g&&(g.dispose(),g=null),_&&(_.dispose(),_=null),window.removeEventListener("resize",P)}),(a,e)=>{const n=d("el-icon"),r=d("el-card"),i=d("el-option"),p=d("el-select"),x=d("el-form-item"),se=d("el-date-picker"),U=d("el-button"),oe=d("el-form"),D=d("el-col"),ae=d("el-row"),le=d("el-tag"),z=d("el-table-column"),ne=d("el-table"),re=d("el-empty"),V=pe("loading");return w(),k("div",Se,[e[17]||(e[17]=s("div",{class:"page-header bg-white shadow-sm mb-6 px-6 py-4"},[s("h1",{class:"text-2xl font-semibold text-gray-900 mb-2"},"能耗统计"),s("p",{class:"text-sm text-gray-600"},"支持电、水、气三种能源类型的能耗统计分析")],-1)),s("div",De,[t(r,{class:"tree-panel",shadow:"hover"},{header:o(()=>[...e[2]||(e[2]=[s("div",{style:{display:"flex","justify-content":"space-between","align-items":"center"}},[s("strong",{style:{"font-size":"15px"}},"设备分组")],-1)])]),default:o(()=>[s("div",{class:L(["all-groups-btn",{active:u.groupId===null}]),onClick:J},[s("div",ze,[t(n,null,{default:o(()=>[t(c(me))]),_:1}),e[3]||(e[3]=s("span",null,"全部分组",-1))])],2),t(we,{groups:A.value,"current-group-id":u.groupId,"show-actions":!1,"show-count":!1,onSelect:Z},null,8,["groups","current-group-id"]),s("div",ke,[t(n,{size:14,class:"hint-icon"},{default:o(()=>[t(c(ve))]),_:1}),e[4]||(e[4]=s("span",null,"点击分组查看该分组下的能耗数据",-1))])]),_:1}),s("div",Te,[t(r,{class:"filter-card mb-6 shadow-sm",shadow:"hover"},{default:o(()=>[t(oe,{model:u,inline:"",class:"filter-form"},{default:o(()=>[t(x,{label:"能源类型"},{default:o(()=>[t(p,{modelValue:u.energyType,"onUpdate:modelValue":e[0]||(e[0]=m=>u.energyType=m),placeholder:"能源类型",class:"filter-select",clearable:""},{default:o(()=>[t(i,{label:"电力",value:"electric"}),t(i,{label:"水耗",value:"water"}),t(i,{label:"气耗",value:"gas"})]),_:1},8,["modelValue"])]),_:1}),t(x,{label:"时间范围"},{default:o(()=>[t(se,{modelValue:h.value,"onUpdate:modelValue":e[1]||(e[1]=m=>h.value=m),type:"datetimerange","range-separator":"至","start-placeholder":"开始","end-placeholder":"结束",format:"YYYY-MM-DD HH:mm:ss","value-format":"YYYY-MM-DD HH:mm:ss",class:"filter-datepicker"},null,8,["modelValue"])]),_:1}),t(x,{class:"filter-buttons"},{default:o(()=>[t(U,{type:"primary",onClick:S,icon:c(ge),loading:C.value,size:"default"},{default:o(()=>[...e[5]||(e[5]=[M(" 查询 ",-1)])]),_:1},8,["icon","loading"]),t(U,{onClick:ee,icon:c(_e),size:"default"},{default:o(()=>[...e[6]||(e[6]=[M(" 重置 ",-1)])]),_:1},8,["icon"])]),_:1})]),_:1},8,["model"])]),_:1}),l.value.totalConsumption!==void 0?(w(),k("div",Le,[t(ae,{gutter:20},{default:o(()=>[t(D,{xs:24,sm:12,md:6},{default:o(()=>[t(r,{class:"stat-card stat-card-total hover:shadow-lg transition-all duration-300 cursor-pointer",shadow:"hover"},{default:o(()=>[s("div",Ne,[s("div",Ie,[s("div",Re,[t(n,{size:24},{default:o(()=>[t(c(ye))]),_:1})]),e[7]||(e[7]=s("div",{class:"stat-label text-sm text-gray-600"},"总能耗",-1))]),s("div",$e,f(b(l.value.totalConsumption)),1),s("div",Ve,f(l.value.unit),1)])]),_:1})]),_:1}),t(D,{xs:24,sm:12,md:6},{default:o(()=>[t(r,{class:"stat-card stat-card-avg hover:shadow-lg transition-all duration-300 cursor-pointer",shadow:"hover"},{default:o(()=>[s("div",Ee,[s("div",Me,[s("div",Ye,[t(n,{size:24},{default:o(()=>[t(c(Y))]),_:1})]),e[8]||(e[8]=s("div",{class:"stat-label text-sm text-gray-600"},"平均能耗",-1))]),s("div",Ge,f(b(l.value.avgConsumption)),1),s("div",We,f(l.value.unit)+"/天",1)])]),_:1})]),_:1}),t(D,{xs:24,sm:12,md:6},{default:o(()=>[t(r,{class:"stat-card stat-card-yoy hover:shadow-lg transition-all duration-300 cursor-pointer",shadow:"hover"},{default:o(()=>[s("div",Be,[s("div",He,[s("div",Ae,[t(n,{size:24},{default:o(()=>[t(c(G))]),_:1})]),e[9]||(e[9]=s("div",{class:"stat-label text-sm text-gray-600"},"同比增长",-1))]),s("div",{class:L(["stat-value text-3xl font-bold mb-1",l.value.yoy>=0?"text-red-600":"text-green-600"])},f(l.value.yoy>=0?"+":"")+f(b(l.value.yoy))+"% ",3),e[10]||(e[10]=s("div",{class:"stat-unit text-sm text-gray-500"},"相比去年同期",-1))])]),_:1})]),_:1}),t(D,{xs:24,sm:12,md:6},{default:o(()=>[t(r,{class:"stat-card stat-card-mom hover:shadow-lg transition-all duration-300 cursor-pointer",shadow:"hover"},{default:o(()=>[s("div",Oe,[s("div",Fe,[s("div",je,[t(n,{size:24},{default:o(()=>[t(c(G))]),_:1})]),e[11]||(e[11]=s("div",{class:"stat-label text-sm text-gray-600"},"环比增长",-1))]),s("div",{class:L(["stat-value text-3xl font-bold mb-1",l.value.mom>=0?"text-red-600":"text-green-600"])},f(l.value.mom>=0?"+":"")+f(b(l.value.mom))+"% ",3),e[12]||(e[12]=s("div",{class:"stat-unit text-sm text-gray-500"},"相比上期",-1))])]),_:1})]),_:1})]),_:1})])):T("",!0),l.value.top10Devices&&l.value.top10Devices.length>0?(w(),k("div",Pe,[t(r,{class:"top10-card shadow-sm flex-1",shadow:"hover"},{header:o(()=>[s("div",Qe,[s("div",Ue,[t(n,{size:20,class:"text-blue-500"},{default:o(()=>[t(c(X))]),_:1}),e[13]||(e[13]=s("span",{class:"text-lg font-semibold text-gray-900"},"能耗Top10设备",-1))])])]),default:o(()=>[s("div",qe,[t(ne,{data:l.value.top10Devices,stripe:"",class:"top10-table","default-sort":{prop:"totalConsumption",order:"descending"},size:"small"},{default:o(()=>[t(z,{type:"index",label:"排名",width:"70",align:"center"},{default:o(({$index:m})=>[t(le,{class:L([te(m),"rank-tag"]),effect:"plain",size:"small"},{default:o(()=>[M(f(m+1),1)]),_:2},1032,["class"])]),_:1}),t(z,{prop:"deviceName",label:"设备名称","min-width":"140","show-overflow-tooltip":""},{default:o(({row:m})=>[s("div",Xe,[t(n,{class:"text-gray-400",size:16},{default:o(()=>[t(c(X))]),_:1}),s("span",Ze,f(m.deviceName),1)])]),_:1}),t(z,{prop:"deviceCode",label:"设备编码","min-width":"120","show-overflow-tooltip":""}),t(z,{prop:"totalConsumption",label:"总能耗",width:"140",sortable:"",align:"right"},{default:o(({row:m})=>[s("div",Je,[s("span",Ke,f(b(m.totalConsumption)),1),s("span",et,f(m.unit),1)])]),_:1})]),_:1},8,["data"])])]),_:1}),t(r,{class:"chart-card shadow-sm flex-1",shadow:"hover"},{header:o(()=>[s("div",tt,[t(n,{size:20,class:"text-purple-500"},{default:o(()=>[t(c(G))]),_:1}),e[14]||(e[14]=s("span",{class:"text-lg font-semibold text-gray-900"},"设备能耗分布",-1))])]),default:o(()=>[W(s("div",{ref_key:"top10ChartRef",ref:I,class:"chart-container"},null,512),[[V,N.value]])]),_:1})])):T("",!0),l.value.top10Devices&&l.value.top10Devices.length>0?(w(),k("div",st,[t(r,{class:"chart-card shadow-sm flex-1",shadow:"hover"},{header:o(()=>[s("div",ot,[t(n,{size:20,class:"text-pink-500"},{default:o(()=>[t(c(Y))]),_:1}),e[15]||(e[15]=s("span",{class:"text-lg font-semibold text-gray-900"},"能耗占比分析",-1))])]),default:o(()=>[W(s("div",{ref_key:"pieChartRef",ref:R,class:"chart-container"},null,512),[[V,N.value]])]),_:1}),t(r,{class:"chart-card shadow-sm flex-1",shadow:"hover"},{header:o(()=>[s("div",at,[t(n,{size:20,class:"text-green-500"},{default:o(()=>[t(c(Y))]),_:1}),e[16]||(e[16]=s("span",{class:"text-lg font-semibold text-gray-900"},"能耗趋势分析",-1))])]),default:o(()=>[W(s("div",{ref_key:"lineChartRef",ref:$,class:"chart-container"},null,512),[[V,N.value]])]),_:1})])):T("",!0),!C.value&&H.value&&l.value.totalConsumption===void 0?(w(),fe(re,{key:3,description:"暂无数据","image-size":120})):T("",!0)])])])}}},pt=ie(lt,[["__scopeId","data-v-5d12fd32"]]);export{pt as default};
