import{_ as ce,r as y,b as ue,O as pe,z as fe,A as me,c as u,B as ve,o as b,d as S,e as s,g as t,w as o,D as T,k as X,E,I as K,C as G,i as f,S as ge,T as _e,F as ye,f as he,U as be,q as L,V as xe,a0 as we,t as m,J as Y,v as M,s as Z,G as W}from"./index-84c82c57.js";import{i as B}from"./index-18acf776.js";import{g as Ce}from"./energy-b6378c29.js";import{g as Se}from"./device-1b039595.js";import{f as De,G as ze}from"./GroupTree-6fc1dd10.js";import{g as ke}from"./group-bdbfd9b3.js";const Te={class:"energy-statistics-page min-h-screen bg-gray-50"},Le={class:"energy-container"},Ie={class:"btn-left"},Ne={class:"tree-hint"},Ve={class:"content-panel"},Re={key:0,class:"statistics-cards mb-6"},$e={class:"stat-content"},Ee={class:"stat-header"},Ge={class:"stat-icon-wrapper stat-icon-total"},Ye={class:"stat-value text-3xl font-bold text-gray-900 mb-1"},Me={class:"stat-unit text-sm text-gray-500"},We={class:"stat-content"},Be={class:"stat-header"},He={class:"stat-icon-wrapper stat-icon-avg"},Ae={class:"stat-value text-3xl font-bold text-gray-900 mb-1"},Fe={class:"stat-unit text-sm text-gray-500"},Oe={class:"stat-content"},Ue={class:"stat-header"},Pe={class:"stat-icon-wrapper stat-icon-yoy"},Qe={class:"stat-content"},je={class:"stat-header"},qe={class:"stat-icon-wrapper stat-icon-mom"},Je={key:1,class:"charts-row"},Xe={class:"flex items-center justify-between"},Ke={class:"flex items-center gap-2"},Ze={class:"flex items-center"},et={class:"font-semibold text-gray-900"},tt={class:"ml-1 text-sm text-gray-500"},st={class:"flex items-center gap-2"},ot={key:2,class:"charts-row mb-6"},at={class:"flex items-center gap-2"},lt={class:"flex items-center gap-2"},nt={__name:"EnergyStatistics",setup(it){const D=y(!1),I=y(!1),H=y(!1),N=y(null),V=y(null),R=y(null);let v=null,g=null,_=null;const c=ue({energyType:"electric",deviceId:null,groupId:null}),h=y([]),A=y([]),F=y([]),ee=a=>{c.groupId=a,z()},te=()=>{c.groupId=null,z()},se=async()=>{try{const a=await ke();a.tree&&(F.value=De(a.tree))}catch(a){console.error("加载分组列表失败:",a)}},l=y({totalConsumption:void 0,unit:"",avgConsumption:void 0,yoy:0,mom:0,top10Devices:[]}),oe=async()=>{try{const a=await Se({page:1,pageSize:1e3});a&&a.list&&(A.value=a.list)}catch(a){console.error("加载设备列表失败:",a)}},z=async()=>{if(!c.energyType){E.warning("请选择能源类型");return}if(!h.value||h.value.length!==2){E.warning("请选择时间范围");return}D.value=!0,H.value=!0;try{const a={energyType:c.energyType,startTime:h.value[0],endTime:h.value[1],deviceId:c.deviceId||null,groupId:c.groupId||null},e=await Ce(a);l.value={totalConsumption:e.totalConsumption||0,unit:e.unit||"",avgConsumption:e.avgConsumption||0,yoy:e.yoy||0,mom:e.mom||0,top10Devices:e.top10Devices||[]},await K(),O(),U(),P()}catch(a){console.error("查询能耗统计失败:",a),E.error(a.message||"查询失败，请稍后重试"),l.value={totalConsumption:void 0,unit:"",avgConsumption:void 0,yoy:0,mom:0,top10Devices:[]}}finally{D.value=!1}},ae=()=>{c.energyType="electric",c.deviceId=null,c.groupId=null,h.value=[],l.value={totalConsumption:void 0,unit:"",avgConsumption:void 0,yoy:0,mom:0,top10Devices:[]}},w=a=>a==null||isNaN(a)?"0.00":Number(a).toFixed(2),O=()=>{if(!N.value||!l.value.top10Devices||l.value.top10Devices.length===0)return;v&&(v.dispose(),v=null),v=B(N.value);const a=l.value.top10Devices.map(d=>d.deviceName).slice(0,10),e=l.value.top10Devices.map(d=>d.totalConsumption).slice(0,10),n=l.value.unit||"",r={tooltip:{trigger:"axis",axisPointer:{type:"shadow"},backgroundColor:"rgba(50, 50, 50, 0.9)",borderColor:"transparent",borderWidth:0,padding:[12,16],textStyle:{color:"#fff",fontSize:13},formatter:d=>{const p=d[0];return`${p.name}<br/>能耗: ${Number(p.value).toFixed(2)} ${n}`}},grid:{left:"3%",right:"4%",bottom:"15%",top:"10%",containLabel:!0},xAxis:{type:"category",data:a,axisLine:{lineStyle:{color:"#e0e0e0"}},axisLabel:{color:"#6b7280",fontSize:12,rotate:45,interval:0},splitLine:{show:!1}},yAxis:{type:"value",name:`能耗 (${n})`,nameTextStyle:{color:"#6b7280",fontSize:12},axisLine:{show:!1},axisTick:{show:!1},axisLabel:{color:"#6b7280",fontSize:12},splitLine:{lineStyle:{color:"#f0f0f0",type:"dashed"}}},series:[{name:"能耗",type:"bar",data:e,itemStyle:{color:{type:"linear",x:0,y:0,x2:0,y2:1,colorStops:[{offset:0,color:"#667eea"},{offset:1,color:"#764ba2"}]},borderRadius:[4,4,0,0]},emphasis:{itemStyle:{color:{type:"linear",x:0,y:0,x2:0,y2:1,colorStops:[{offset:0,color:"#764ba2"},{offset:1,color:"#667eea"}]}}}}]};v.setOption(r,!0)},U=()=>{if(!V.value||!l.value.top10Devices||l.value.top10Devices.length===0)return;g&&(g.dispose(),g=null),g=B(V.value);const a=l.value.top10Devices.slice(0,5),e=["#667eea","#764ba2","#f093fb","#f5576c","#4facfe"],n=a.map((d,p)=>({value:d.totalConsumption,name:d.deviceName,itemStyle:{color:e[p%e.length],borderRadius:8,borderColor:"#fff",borderWidth:2}})),r={tooltip:{trigger:"item",backgroundColor:"rgba(50, 50, 50, 0.9)",borderColor:"transparent",borderWidth:0,padding:[12,16],textStyle:{color:"#fff",fontSize:13},formatter:"{b}<br/>{c} {a}<br/>({d}%)"},legend:{orient:"vertical",right:20,top:"center",textStyle:{color:"#6b7280",fontSize:12},itemGap:12},series:[{name:"能耗",type:"pie",radius:["45%","75%"],center:["35%","50%"],avoidLabelOverlap:!0,itemStyle:{borderRadius:8,borderColor:"#fff",borderWidth:2},label:{show:!0,formatter:`{b}
{d}%`,fontSize:11,fontWeight:500},emphasis:{label:{show:!0,fontSize:13,fontWeight:"bold"},itemStyle:{shadowBlur:10,shadowOffsetX:0,shadowColor:"rgba(0, 0, 0, 0.3)"}},data:n}]};g.setOption(r,!0)},P=()=>{if(!R.value||!l.value.top10Devices||l.value.top10Devices.length===0)return;_&&(_.dispose(),_=null),_=B(R.value);const a=l.value.top10Devices.slice(0,5),e=a.map(p=>p.deviceName),n=a.map(p=>p.totalConsumption),r=l.value.unit||"",d={tooltip:{trigger:"axis",backgroundColor:"rgba(50, 50, 50, 0.9)",borderColor:"transparent",borderWidth:0,padding:[12,16],textStyle:{color:"#fff",fontSize:13},axisPointer:{type:"cross",label:{backgroundColor:"#667eea"}}},grid:{left:"3%",right:"4%",bottom:"10%",top:"10%",containLabel:!0},xAxis:{type:"category",boundaryGap:!1,data:e,axisLine:{lineStyle:{color:"#e0e0e0"}},axisLabel:{color:"#6b7280",fontSize:12,rotate:30},splitLine:{show:!1}},yAxis:{type:"value",name:`能耗 (${r})`,nameTextStyle:{color:"#6b7280",fontSize:12},axisLine:{show:!1},axisTick:{show:!1},axisLabel:{color:"#6b7280",fontSize:12},splitLine:{lineStyle:{color:"#f0f0f0",type:"dashed"}}},series:[{name:"能耗",type:"line",smooth:!0,data:n,areaStyle:{color:{type:"linear",x:0,y:0,x2:0,y2:1,colorStops:[{offset:0,color:"rgba(102, 126, 234, 0.3)"},{offset:1,color:"rgba(102, 126, 234, 0.05)"}]}},lineStyle:{color:"#667eea",width:3},itemStyle:{color:"#667eea"},symbol:"circle",symbolSize:8,emphasis:{focus:"series",itemStyle:{color:"#667eea",borderColor:"#fff",borderWidth:2}}}]};_.setOption(d,!0)},Q=()=>{v&&v.resize(),g&&g.resize(),_&&_.resize()};pe(()=>l.value.top10Devices,()=>{l.value.top10Devices&&l.value.top10Devices.length>0&&K(()=>{O(),U(),P()})},{deep:!0});const j=a=>{const e=a.getFullYear(),n=String(a.getMonth()+1).padStart(2,"0"),r=String(a.getDate()).padStart(2,"0"),d=String(a.getHours()).padStart(2,"0"),p=String(a.getMinutes()).padStart(2,"0"),x=String(a.getSeconds()).padStart(2,"0");return`${e}-${n}-${r} ${d}:${p}:${x}`};return fe(async()=>{const a=new Date,e=new Date;e.setDate(e.getDate()-30),e.setHours(0,0,0,0),a.setHours(23,59,59,999),h.value=[j(e),j(a)],await Promise.all([oe(),se()]),await z(),window.addEventListener("resize",Q)}),me(()=>{v&&(v.dispose(),v=null),g&&(g.dispose(),g=null),_&&(_.dispose(),_=null),window.removeEventListener("resize",Q)}),(a,e)=>{const n=u("el-icon"),r=u("el-card"),d=u("el-option"),p=u("el-select"),x=u("el-form-item"),le=u("el-date-picker"),q=u("el-button"),ne=u("el-form"),k=u("el-col"),ie=u("el-row"),J=u("el-tag"),C=u("el-table-column"),re=u("el-table"),de=u("el-empty"),$=ve("loading");return b(),S("div",Te,[e[18]||(e[18]=s("div",{class:"page-header bg-white shadow-sm mb-6 px-6 py-4"},[s("h1",{class:"text-2xl font-semibold text-gray-900 mb-2"},"能耗统计"),s("p",{class:"text-sm text-gray-600"},"支持电、水、气三种能源类型的能耗统计分析")],-1)),s("div",Le,[t(r,{class:"tree-panel",shadow:"hover"},{header:o(()=>[...e[3]||(e[3]=[s("div",{style:{display:"flex","justify-content":"space-between","align-items":"center"}},[s("strong",{style:{"font-size":"15px"}},"设备分组")],-1)])]),default:o(()=>[s("div",{class:G(["all-groups-btn",{active:c.groupId===null}]),onClick:te},[s("div",Ie,[t(n,null,{default:o(()=>[t(f(ge))]),_:1}),e[4]||(e[4]=s("span",null,"全部分组",-1))])],2),t(ze,{groups:F.value,"current-group-id":c.groupId,"show-actions":!1,"show-count":!1,onSelect:ee},null,8,["groups","current-group-id"]),s("div",Ne,[t(n,{size:14,class:"hint-icon"},{default:o(()=>[t(f(_e))]),_:1}),e[5]||(e[5]=s("span",null,"点击分组查看该分组下的能耗数据",-1))])]),_:1}),s("div",Ve,[t(r,{class:"filter-card mb-6 shadow-sm",shadow:"hover"},{default:o(()=>[t(ne,{model:c,inline:"",class:"filter-form"},{default:o(()=>[t(x,{label:"能源类型"},{default:o(()=>[t(p,{modelValue:c.energyType,"onUpdate:modelValue":e[0]||(e[0]=i=>c.energyType=i),placeholder:"能源类型",class:"filter-select",clearable:""},{default:o(()=>[t(d,{label:"电力",value:"electric"}),t(d,{label:"水耗",value:"water"}),t(d,{label:"气耗",value:"gas"})]),_:1},8,["modelValue"])]),_:1}),t(x,{label:"时间范围"},{default:o(()=>[t(le,{modelValue:h.value,"onUpdate:modelValue":e[1]||(e[1]=i=>h.value=i),type:"datetimerange","range-separator":"至","start-placeholder":"开始","end-placeholder":"结束",format:"YYYY-MM-DD HH:mm:ss","value-format":"YYYY-MM-DD HH:mm:ss",class:"filter-datepicker"},null,8,["modelValue"])]),_:1}),t(x,{label:"设备"},{default:o(()=>[t(p,{modelValue:c.deviceId,"onUpdate:modelValue":e[2]||(e[2]=i=>c.deviceId=i),placeholder:"全部设备",filterable:"",clearable:"",class:"filter-select"},{default:o(()=>[(b(!0),S(ye,null,he(A.value,i=>(b(),X(d,{key:i.id,label:i.deviceName,value:i.id},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1}),t(x,{class:"filter-buttons"},{default:o(()=>[t(q,{type:"primary",onClick:z,icon:f(be),loading:D.value,size:"default"},{default:o(()=>[...e[6]||(e[6]=[L(" 查询 ",-1)])]),_:1},8,["icon","loading"]),t(q,{onClick:ae,icon:f(xe),size:"default"},{default:o(()=>[...e[7]||(e[7]=[L(" 重置 ",-1)])]),_:1},8,["icon"])]),_:1})]),_:1},8,["model"])]),_:1}),l.value.totalConsumption!==void 0?(b(),S("div",Re,[t(ie,{gutter:20},{default:o(()=>[t(k,{xs:24,sm:12,md:6},{default:o(()=>[t(r,{class:"stat-card stat-card-total hover:shadow-lg transition-all duration-300 cursor-pointer",shadow:"hover"},{default:o(()=>[s("div",$e,[s("div",Ee,[s("div",Ge,[t(n,{size:24},{default:o(()=>[t(f(we))]),_:1})]),e[8]||(e[8]=s("div",{class:"stat-label text-sm text-gray-600"},"总能耗",-1))]),s("div",Ye,m(w(l.value.totalConsumption)),1),s("div",Me,m(l.value.unit),1)])]),_:1})]),_:1}),t(k,{xs:24,sm:12,md:6},{default:o(()=>[t(r,{class:"stat-card stat-card-avg hover:shadow-lg transition-all duration-300 cursor-pointer",shadow:"hover"},{default:o(()=>[s("div",We,[s("div",Be,[s("div",He,[t(n,{size:24},{default:o(()=>[t(f(Y))]),_:1})]),e[9]||(e[9]=s("div",{class:"stat-label text-sm text-gray-600"},"平均能耗",-1))]),s("div",Ae,m(w(l.value.avgConsumption)),1),s("div",Fe,m(l.value.unit)+"/天",1)])]),_:1})]),_:1}),t(k,{xs:24,sm:12,md:6},{default:o(()=>[t(r,{class:"stat-card stat-card-yoy hover:shadow-lg transition-all duration-300 cursor-pointer",shadow:"hover"},{default:o(()=>[s("div",Oe,[s("div",Ue,[s("div",Pe,[t(n,{size:24},{default:o(()=>[t(f(M))]),_:1})]),e[10]||(e[10]=s("div",{class:"stat-label text-sm text-gray-600"},"同比增长",-1))]),s("div",{class:G(["stat-value text-3xl font-bold mb-1",l.value.yoy>=0?"text-red-600":"text-green-600"])},m(l.value.yoy>=0?"+":"")+m(w(l.value.yoy))+"% ",3),e[11]||(e[11]=s("div",{class:"stat-unit text-sm text-gray-500"},"相比去年同期",-1))])]),_:1})]),_:1}),t(k,{xs:24,sm:12,md:6},{default:o(()=>[t(r,{class:"stat-card stat-card-mom hover:shadow-lg transition-all duration-300 cursor-pointer",shadow:"hover"},{default:o(()=>[s("div",Qe,[s("div",je,[s("div",qe,[t(n,{size:24},{default:o(()=>[t(f(M))]),_:1})]),e[12]||(e[12]=s("div",{class:"stat-label text-sm text-gray-600"},"环比增长",-1))]),s("div",{class:G(["stat-value text-3xl font-bold mb-1",l.value.mom>=0?"text-red-600":"text-green-600"])},m(l.value.mom>=0?"+":"")+m(w(l.value.mom))+"% ",3),e[13]||(e[13]=s("div",{class:"stat-unit text-sm text-gray-500"},"相比上期",-1))])]),_:1})]),_:1})]),_:1})])):T("",!0),l.value.top10Devices&&l.value.top10Devices.length>0?(b(),S("div",Je,[t(r,{class:"top10-card shadow-sm flex-1",shadow:"hover"},{header:o(()=>[s("div",Xe,[s("div",Ke,[t(n,{size:20,class:"text-blue-500"},{default:o(()=>[t(f(Z))]),_:1}),e[14]||(e[14]=s("span",{class:"text-lg font-semibold text-gray-900"},"能耗Top10设备",-1))])])]),default:o(()=>[t(re,{data:l.value.top10Devices,stripe:"",class:"top10-table","default-sort":{prop:"totalConsumption",order:"descending"}},{default:o(()=>[t(C,{type:"index",label:"排名",width:"80",align:"center"},{default:o(({$index:i})=>[t(J,{type:i<3?"danger":"info",effect:"plain",size:"small"},{default:o(()=>[L(m(i+1),1)]),_:2},1032,["type"])]),_:1}),t(C,{prop:"deviceName",label:"设备名称","min-width":"180"},{default:o(({row:i})=>[s("div",Ze,[t(n,{class:"mr-2 text-gray-400"},{default:o(()=>[t(f(Z))]),_:1}),s("span",null,m(i.deviceName),1)])]),_:1}),t(C,{prop:"deviceCode",label:"设备编码","min-width":"150"}),t(C,{prop:"totalConsumption",label:"总能耗",width:"180",sortable:"",align:"right"},{default:o(({row:i})=>[s("span",et,m(w(i.totalConsumption)),1),s("span",tt,m(i.unit),1)]),_:1}),t(C,{prop:"recordCount",label:"记录数",width:"120",align:"center"},{default:o(({row:i})=>[t(J,{size:"small",type:"info",effect:"plain"},{default:o(()=>[L(m(i.recordCount),1)]),_:2},1024)]),_:1})]),_:1},8,["data"])]),_:1}),t(r,{class:"chart-card shadow-sm flex-1",shadow:"hover"},{header:o(()=>[s("div",st,[t(n,{size:20,class:"text-purple-500"},{default:o(()=>[t(f(M))]),_:1}),e[15]||(e[15]=s("span",{class:"text-lg font-semibold text-gray-900"},"设备能耗分布",-1))])]),default:o(()=>[W(s("div",{ref_key:"top10ChartRef",ref:N,class:"chart-container"},null,512),[[$,I.value]])]),_:1})])):T("",!0),l.value.top10Devices&&l.value.top10Devices.length>0?(b(),S("div",ot,[t(r,{class:"chart-card shadow-sm flex-1",shadow:"hover"},{header:o(()=>[s("div",at,[t(n,{size:20,class:"text-pink-500"},{default:o(()=>[t(f(Y))]),_:1}),e[16]||(e[16]=s("span",{class:"text-lg font-semibold text-gray-900"},"能耗占比分析",-1))])]),default:o(()=>[W(s("div",{ref_key:"pieChartRef",ref:V,class:"chart-container"},null,512),[[$,I.value]])]),_:1}),t(r,{class:"chart-card shadow-sm flex-1",shadow:"hover"},{header:o(()=>[s("div",lt,[t(n,{size:20,class:"text-green-500"},{default:o(()=>[t(f(Y))]),_:1}),e[17]||(e[17]=s("span",{class:"text-lg font-semibold text-gray-900"},"能耗趋势分析",-1))])]),default:o(()=>[W(s("div",{ref_key:"lineChartRef",ref:R,class:"chart-container"},null,512),[[$,I.value]])]),_:1})])):T("",!0),!D.value&&H.value&&l.value.totalConsumption===void 0?(b(),X(de,{key:3,description:"暂无数据","image-size":120})):T("",!0)])])])}}},mt=ce(nt,[["__scopeId","data-v-dd99ef9e"]]);export{mt as default};
