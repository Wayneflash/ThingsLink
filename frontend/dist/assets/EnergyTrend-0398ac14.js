import{_ as j,a7 as q,Z,$ as O,r as u,a0 as J,o as x,c as K,b as s,e as a,w as l,k as I,a1 as E,g,E as S,a3 as F,B as P,i as h,ab as X,T as ee,M as te,q as T,D as ae,t as M,y as oe,h as le}from"./index-d915c72b.js";import{a as se}from"./energy-4a4b428c.js";import{f as re,G as ne}from"./GroupTree-540811fa.js";import{g as ie}from"./group-02a76718.js";import{i as de}from"./index-18acf776.js";const ce={class:"energy-trend-page min-h-screen bg-gray-50"},ue={class:"energy-container"},pe={class:"btn-left"},me={class:"tree-hint"},fe={class:"content-panel"},ge={class:"flex items-center justify-between"},ye={class:"text-lg font-semibold text-gray-900"},_e={class:"flex items-center gap-2"},ve={__name:"EnergyTrend",setup(he){const v=g(!1),b=g(!1),C=g(!1),o=le({energyType:"electric",deviceId:null,groupId:null,dateFormat:"day"}),k=g([]),Y=t=>{o.groupId=t,y()},G=()=>{o.groupId=null,y()},H=async()=>{try{const t=await ie();t.tree&&(k.value=re(t.tree))}catch(t){console.error("加载分组列表失败:",t)}},p=g([]),n=g([]),w=g(null);let r=null;const N=t=>({electric:"电力",water:"水耗",gas:"气耗"})[t]||"能源",z=t=>({electric:"kWh",water:"m³",gas:"m³"})[t]||"",y=async()=>{if(!o.energyType){S.warning("请选择能源类型");return}if(!p.value||p.value.length!==2){S.warning("请选择时间范围");return}v.value=!0,b.value=!0,C.value=!0;try{const t={energyType:o.energyType,startTime:p.value[0],endTime:p.value[1],groupId:o.groupId||null,dateFormat:o.dateFormat||"day"},e=await se(t);n.value=e||[],await F(),D()}catch(t){console.error("查询能耗趋势失败:",t),S.error(t.message||"查询失败，请稍后重试"),n.value=[]}finally{v.value=!1,b.value=!1}},D=()=>{var i;if(!w.value||n.value.length===0)return;r&&(r.dispose(),r=null),r=de(w.value);const t=n.value.map(d=>d.timeLabel),e=n.value.map(d=>d.consumption),m=((i=n.value[0])==null?void 0:i.unit)||z(o.energyType),f={tooltip:{trigger:"axis",backgroundColor:"rgba(50, 50, 50, 0.9)",borderColor:"transparent",borderWidth:0,padding:[12,16],textStyle:{color:"#fff",fontSize:13},formatter:d=>{const c=d[0];return`${c.axisValue}<br/>${c.seriesName}: ${Number(c.value).toFixed(2)} ${m}`}},grid:{left:"3%",right:"4%",bottom:"10%",top:"10%",containLabel:!0},xAxis:{type:"category",boundaryGap:!1,data:t,axisLine:{lineStyle:{color:"#e0e0e0"}},axisLabel:{color:"#6b7280",fontSize:12,rotate:o.dateFormat==="day"?0:45},splitLine:{show:!1}},yAxis:{type:"value",name:`能耗 (${m})`,nameTextStyle:{color:"#6b7280",fontSize:12},axisLine:{show:!1},axisTick:{show:!1},axisLabel:{color:"#6b7280",fontSize:12},splitLine:{lineStyle:{color:"#f0f0f0",type:"dashed"}}},series:[{name:"能耗",type:"line",smooth:!0,data:e,areaStyle:{color:{type:"linear",x:0,y:0,x2:0,y2:1,colorStops:[{offset:0,color:"rgba(102, 126, 234, 0.3)"},{offset:1,color:"rgba(102, 126, 234, 0.05)"}]}},lineStyle:{color:"#667eea",width:3},itemStyle:{color:"#667eea"},symbol:"circle",symbolSize:6,emphasis:{focus:"series",itemStyle:{color:"#667eea",borderColor:"#fff",borderWidth:2}}}],dataZoom:[{type:"inside",start:0,end:100},{type:"slider",start:0,end:100,height:24,bottom:8,borderColor:"#e0e0e0",fillerColor:"rgba(102, 126, 234, 0.2)",handleStyle:{color:"#667eea"}}]};r.setOption(f,!0)},B=()=>{o.energyType="electric",o.groupId=null,o.dateFormat="day",p.value=[],n.value=[],r&&(r.dispose(),r=null)},V=t=>{const e=t.getFullYear(),m=String(t.getMonth()+1).padStart(2,"0"),f=String(t.getDate()).padStart(2,"0"),i=String(t.getHours()).padStart(2,"0"),d=String(t.getMinutes()).padStart(2,"0"),c=String(t.getSeconds()).padStart(2,"0");return`${e}-${m}-${f} ${i}:${d}:${c}`},L=()=>{r&&r.resize()};return q(()=>n.value,()=>{n.value.length>0&&F(()=>{D()})},{deep:!0}),Z(async()=>{const t=new Date,e=new Date;e.setDate(e.getDate()-30),e.setHours(0,0,0,0),t.setHours(23,59,59,999),p.value=[V(e),V(t)],await H(),await y(),window.addEventListener("resize",L)}),O(()=>{r&&(r.dispose(),r=null),window.removeEventListener("resize",L)}),(t,e)=>{const m=u("el-icon"),f=u("el-card"),i=u("el-option"),d=u("el-select"),c=u("el-form-item"),U=u("el-date-picker"),$=u("el-button"),R=u("el-form"),A=u("el-tag"),Q=u("el-empty"),W=J("loading");return x(),K("div",ce,[e[8]||(e[8]=s("div",{class:"page-header bg-white shadow-sm mb-6 px-6 py-4"},[s("h1",{class:"text-2xl font-semibold text-gray-900 mb-2"},"能耗趋势"),s("p",{class:"text-sm text-gray-600"},"支持电、水、气三种能源类型的能耗趋势分析")],-1)),s("div",ue,[a(f,{class:"tree-panel",shadow:"hover"},{header:l(()=>[...e[3]||(e[3]=[s("div",{style:{display:"flex","justify-content":"space-between","align-items":"center"}},[s("strong",{style:{"font-size":"15px"}},"设备分组")],-1)])]),default:l(()=>[s("div",{class:P(["all-groups-btn",{active:o.groupId===null}]),onClick:G},[s("div",pe,[a(m,null,{default:l(()=>[a(h(X))]),_:1}),e[4]||(e[4]=s("span",null,"全部分组",-1))])],2),a(ne,{groups:k.value,"current-group-id":o.groupId,"show-actions":!1,"show-count":!1,onSelect:Y},null,8,["groups","current-group-id"]),s("div",me,[a(m,{size:14,class:"hint-icon"},{default:l(()=>[a(h(ee))]),_:1}),e[5]||(e[5]=s("span",null,"点击分组查看该分组下的能耗数据",-1))])]),_:1}),s("div",fe,[a(f,{class:"filter-card mb-6 shadow-sm",shadow:"hover"},{default:l(()=>[a(R,{model:o,inline:"",class:"filter-form"},{default:l(()=>[a(c,{label:"能源类型"},{default:l(()=>[a(d,{modelValue:o.energyType,"onUpdate:modelValue":e[0]||(e[0]=_=>o.energyType=_),placeholder:"能源类型",class:"filter-select",onChange:y},{default:l(()=>[a(i,{label:"电力",value:"electric"}),a(i,{label:"水耗",value:"water"}),a(i,{label:"气耗",value:"gas"})]),_:1},8,["modelValue"])]),_:1}),a(c,{label:"时间范围"},{default:l(()=>[a(U,{modelValue:p.value,"onUpdate:modelValue":e[1]||(e[1]=_=>p.value=_),type:"datetimerange","range-separator":"至","start-placeholder":"开始","end-placeholder":"结束",format:"YYYY-MM-DD HH:mm:ss","value-format":"YYYY-MM-DD HH:mm:ss",class:"filter-datepicker"},null,8,["modelValue"])]),_:1}),a(c,{label:"时间粒度"},{default:l(()=>[a(d,{modelValue:o.dateFormat,"onUpdate:modelValue":e[2]||(e[2]=_=>o.dateFormat=_),placeholder:"粒度",class:"filter-select-small",onChange:y},{default:l(()=>[a(i,{label:"按天",value:"day"}),a(i,{label:"按小时",value:"hour"})]),_:1},8,["modelValue"])]),_:1}),a(c,{class:"filter-buttons"},{default:l(()=>[a($,{type:"primary",onClick:y,icon:h(te),loading:v.value,size:"default"},{default:l(()=>[...e[6]||(e[6]=[T(" 查询 ",-1)])]),_:1},8,["icon","loading"]),a($,{onClick:B,icon:h(ae),size:"default"},{default:l(()=>[...e[7]||(e[7]=[T(" 重置 ",-1)])]),_:1},8,["icon"])]),_:1})]),_:1},8,["model"])]),_:1}),n.value.length>0?(x(),I(f,{key:0,class:"chart-card shadow-sm mb-6",shadow:"hover"},{header:l(()=>[s("div",ge,[s("span",ye,M(N(o.energyType))+"趋势分析 ",1),s("div",_e,[a(A,{size:"small",type:"info"},{default:l(()=>[T(M(z(o.energyType)),1)]),_:1})])])]),default:l(()=>[oe(s("div",{ref_key:"trendChartRef",ref:w,class:"chart-container"},null,512),[[W,b.value]])]),_:1})):E("",!0),!v.value&&C.value&&n.value.length===0?(x(),I(Q,{key:1,description:"暂无数据","image-size":120})):E("",!0)])])])}}},Ce=j(ve,[["__scopeId","data-v-227b9ae8"]]);export{Ce as default};
