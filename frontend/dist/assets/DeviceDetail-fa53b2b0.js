import{a2 as me,_ as $e,a as Me,u as qe,Y as X,a7 as he,Z as _e,r as D,a0 as Ne,o as c,c as g,b as t,e as l,w as i,t as m,B as q,q as C,a1 as S,F as de,d as ce,y as K,z as ue,k as Y,h as ee,g as _,E as y,a3 as be,i as f,Q as Ve,j as Ye,ae as pe,J as Le,X as te,a4 as we,a5 as Ce,af as He,s as Ae,ad as Ie}from"./index-98982554.js";import{a as Je,e as Re}from"./device-4933ef44.js";import{a as Be,b as Oe}from"./product-77d1d13a.js";import{g as je}from"./system-cd788387.js";import{i as Ee}from"./index-18acf776.js";const Ue=J=>me({url:"/device-data/list",method:"post",data:J}),Fe=J=>me({url:"/commands/send",method:"post",data:J}),Qe=J=>me({url:"/device-logs/list",method:"post",data:J});const We={class:"device-detail-page"},Ze={class:"topbar"},Ge={key:0,class:"header-section"},Xe={class:"header-left"},Ke={class:"device-title-bar-compact"},et={class:"device-title-text"},tt={class:"title-row"},at={class:"device-name-wrapper"},ot={class:"device-name-large"},st={class:"device-code-badge"},lt={class:"info-grid-compact"},nt={class:"info-card-compact"},rt={class:"info-value"},it={class:"info-card-compact"},dt={class:"info-value"},ct={class:"info-card-compact"},ut={class:"info-value"},pt={class:"header-right"},mt={class:"info-section-title"},gt={class:"mqtt-card-compact"},vt={class:"mqtt-line"},yt={class:"mqtt-value"},ft={class:"mqtt-value"},ht={class:"mqtt-line"},_t={class:"mqtt-code-inline"},bt={class:"mqtt-line"},wt={class:"mqtt-code-inline"},Ct={class:"mqtt-line"},Tt={class:"mqtt-code-inline"},xt={class:"tabs"},Dt={key:0,class:"data-grid-wrapper"},St={class:"data-grid"},zt={class:"data-label"},kt={class:"data-value"},Pt={key:0,class:"data-unit"},$t={class:"data-time"},Mt={key:1,class:"empty-data"},qt={class:"history-toolbar"},Nt={style:{flex:"1",display:"flex",gap:"12px","justify-content":"flex-end"}},Vt={class:"history-chart-container"},Yt={key:0,class:"empty-data"},Lt={class:"history-table-wrapper"},Ht={class:"history-table-container"},At={key:0},It={key:0,class:"unit-text"},Jt={key:1,style:{color:"#ccc"}},Rt={key:1,class:"empty-data"},Bt={class:"metadata-table-wrapper"},Ot={class:"metadata-table-container"},jt={class:"time-cell"},Et={class:"json-cell"},Ut={class:"json-display"},Ft={key:1,class:"empty-data"},Qt={class:"command-grid"},Wt=["onClick"],Zt={class:"command-name"},Gt={key:0,class:"empty-data"},Xt={class:"log-filter-bar"},Kt={class:"log-table-wrapper"},ea={key:1,class:"empty-data"},ta={__name:"DeviceDetail",setup(J){const B=Me(),Te=qe(),u=ee({id:null,deviceName:"",deviceCode:"",productId:null,productName:"",groupId:null,groupName:"",groupPath:"",status:0,lastOnlineTime:"",createTime:""}),z=_([]),L=_([]),O=_([]),ae=_("-"),M=_("chart"),N=_([]),b=_([]),j=_([]),H=_(null);let k=null;const v=ee({currentPage:1,pageSize:50,total:0}),w=_("realtime"),E=_([]),U=_(!1),oe=_({logType:""}),F=_([]),V=ee({currentPage:1,pageSize:20,total:0}),A=ee({broker:"",port:"",username:"",password:""}),xe=async()=>{try{const a=await je();a&&Object.assign(A,a)}catch(a){console.error("加载MQTT配置失败:",a),A.broker="localhost",A.port="1883",A.username="admin",A.password="admin123."}},De=async()=>{var a,e,o;try{const s=B.query.deviceCode||B.params.deviceCode;if(console.log("设备编码:",s,"路由参数:",B.query,B.params),!s){y.error("设备编码不存在"),R();return}await xe(),console.log("请求设备详情，参数:",{deviceCode:s});const d=await Je({deviceCode:s});console.log("设备详情响应数据:",d),d&&typeof d=="object"?(Object.assign(u,d),se()):(y.error("获取设备详情失败：返回数据格式错误"),console.error("返回数据:",d),R())}catch(s){console.error("加载设备详情失败:",s),console.error("错误详情:",{message:s.message,response:s.response,data:(a=s.response)==null?void 0:a.data});const d=((o=(e=s.response)==null?void 0:e.data)==null?void 0:o.message)||s.message||"加载设备详情失败";y.error(d),R()}},ge=async()=>{if(!u.productId){console.warn("产品ID不存在");return}if(!(z.value.length>0))try{const a=await Be(u.productId);a&&(z.value=a||[],console.log("产品属性加载完成:",z.value.length,"个"))}catch(a){console.error("加载产品属性失败:",a),y.error("加载产品属性失败")}},Se=async()=>{if(!u.productId){console.warn("产品ID不存在");return}if(!(L.value.length>0))try{const a=await Oe(u.productId);a&&(Array.isArray(a)?L.value=a:a.list&&Array.isArray(a.list)?L.value=a.list:L.value=[],console.log("产品命令加载完成:",L.value.length,"个"))}catch(a){console.error("加载产品命令失败:",a),y.error("加载产品命令失败")}},se=async()=>{try{z.value.length===0&&await ge();const a=await Re({deviceCode:u.deviceCode});if(a){const e=a.reportTime;if(e)ae.value=e.includes("T")?e.replace("T"," "):e;else{const s=new Date,d=s.getFullYear(),T=String(s.getMonth()+1).padStart(2,"0"),x=String(s.getDate()).padStart(2,"0"),n=String(s.getHours()).padStart(2,"0"),p=String(s.getMinutes()).padStart(2,"0"),h=String(s.getSeconds()).padStart(2,"0");ae.value=`${d}-${T}-${x} ${n}:${p}:${h}`}const o=a.data||{};O.value=z.value.map(s=>{const d=o[s.addr];return{key:s.addr,label:s.attrName,value:d!=null&&d!==""?d:"-",unit:s.unit}})}else O.value=z.value.map(e=>({key:e.addr,label:e.attrName,value:"-",unit:e.unit}))}catch(a){console.error("加载实时数据失败:",a),y.error("加载实时数据失败")}},ze=X(()=>{const a=(v.currentPage-1)*v.pageSize,e=a+v.pageSize;return b.value.slice(a,e)}),Q=X(()=>{if(!j.value||j.value.length===0)return[];const a=new Map;return j.value.forEach(e=>{if(e.rawPayload){const o=e.reportTime||e.ctime||"";if(!a.has(e.rawPayload))a.set(e.rawPayload,{reportTime:o,rawPayload:e.rawPayload});else{const s=a.get(e.rawPayload);new Date(o)<new Date(s.reportTime)&&(s.reportTime=o)}}}),Array.from(a.values()).map(e=>{try{const o=JSON.stringify(JSON.parse(e.rawPayload),null,2);return{reportTime:e.reportTime,rawJson:e.rawPayload,formattedJson:o}}catch(o){return console.error("JSON解析失败:",o,e.rawPayload),{reportTime:e.reportTime,rawJson:e.rawPayload,formattedJson:e.rawPayload}}}).sort((e,o)=>new Date(o.reportTime)-new Date(e.reportTime))}),ke=X(()=>{const a=(v.currentPage-1)*v.pageSize,e=a+v.pageSize;return Q.value.slice(a,e)}),ve=X(()=>"calc(100vh - 320px)"),le=async()=>{try{if(!N.value||N.value.length!==2){y.warning("请选择查询时间范围");return}const a=await Ue({deviceCode:u.deviceCode,startTime:N.value[0],endTime:N.value[1]});if(a){j.value=a.map(o=>({...o,reportTime:o.ctime?o.ctime.includes("T")?o.ctime.replace("T"," "):o.ctime:""}));const e=new Map;a.forEach(o=>{let s="";o.ctime&&(s=o.ctime.includes("T")?o.ctime.replace("T"," "):o.ctime),e.has(s)||e.set(s,{reportTime:s,rawPayload:o.rawPayload||null}),e.get(s)[o.addr]=o.addrv,o.rawPayload&&!e.get(s).rawPayload&&(e.get(s).rawPayload=o.rawPayload)}),b.value=Array.from(e.values()).sort((o,s)=>new Date(s.reportTime)-new Date(o.reportTime)),v.total=b.value.length,v.currentPage=1,y.success(`查询成功，共 ${b.value.length} 条记录`),M.value==="chart"&&be(()=>{ne()})}}catch(a){console.error("查询历史数据失败:",a),y.error("查询历史数据失败")}},ne=()=>{if(console.log("=== 开始渲染图表 ==="),console.log("historyChartRef.value:",H.value),console.log("historyData.value.length:",b.value.length),console.log("productAttributes.value.length:",z.value.length),!H.value){console.error("图表容器未找到");return}const a=H.value.getBoundingClientRect();if(console.log("容器尺寸:",a.width,"x",a.height),a.width===0||a.height===0){console.error("容器尺寸为0，可能未显示"),setTimeout(()=>{if(H.value){const n=H.value.getBoundingClientRect();n.width>0&&n.height>0&&ne()}},200);return}if(b.value.length===0){console.warn("无历史数据");return}if(z.value.length===0){console.warn("产品属性未加载");return}k&&(k.dispose(),k=null),k=Ee(H.value),console.log("图表实例已创建");const e=[...b.value].sort((n,p)=>new Date(n.reportTime.replace("T"," "))-new Date(p.reportTime.replace("T"," ")));console.log("排序后数据:",e.length,"条");const o=e.map(n=>{const p=n.reportTime.replace("T"," ");return p.split(" ")[1]||p});console.log("时间轴数据:",o.slice(0,5));const s=z.value.filter(n=>{const p=n.dataType;return p==="int"||p==="float"||p==="double"});if(console.log("数值属性:",s.map(n=>`${n.attrName}(${n.addr})`)),s.length===0){console.warn("没有数值类型的属性"),y.warning("当前产品没有可绘制的数值属性");return}const d=["#409eff","#67c23a","#e6a23c","#f56c6c","#909399"],T=s.map((n,p)=>{const h=e.map(I=>{const $=I[n.addr];return $!=null&&$!==""?Number($):null}),P=h.filter(I=>I!==null).length;return console.log(`${n.attrName}: ${P} 个有效数据点`),{name:n.attrName,type:"line",smooth:!0,symbol:"circle",symbolSize:6,data:h,itemStyle:{color:d[p%d.length]},lineStyle:{width:2},connectNulls:!1}}),x={title:{text:"历史数据趋势图",left:"center",top:10,textStyle:{fontSize:16,fontWeight:600,color:"#333"}},backgroundColor:"#fff",tooltip:{trigger:"axis",backgroundColor:"rgba(255, 255, 255, 0.95)",borderColor:"#ddd",borderWidth:1,padding:10,textStyle:{color:"#333",fontSize:12},formatter:function(n){let p=`<div style="font-weight: bold; margin-bottom: 8px; font-size: 13px;">${n[0].axisValue}</div>`;return n.forEach(h=>{if(h.value!==null){const P=s.find($=>$.attrName===h.seriesName),I=(P==null?void 0:P.unit)||"";p+=`<div style="margin: 4px 0;">${h.marker} ${h.seriesName}: <span style="font-weight: bold;">${h.value}</span> ${I}</div>`}}),p}},legend:{data:T.map(n=>n.name),top:30,type:"scroll",textStyle:{fontSize:11}},grid:{left:55,right:35,bottom:50,top:65,containLabel:!1},xAxis:{type:"category",boundaryGap:!1,data:o,axisLine:{lineStyle:{color:"#999"}},axisLabel:{color:"#666",fontSize:11,rotate:45,interval:Math.floor(o.length/15)||0},splitLine:{show:!1}},yAxis:{type:"value",axisLine:{show:!0,lineStyle:{color:"#999"}},axisLabel:{color:"#666",fontSize:11},splitLine:{lineStyle:{color:"#e5e5e5",type:"dashed"}}},dataZoom:[{type:"inside",start:0,end:100,zoomOnMouseWheel:!0,moveOnMouseMove:!0},{type:"slider",start:0,end:100,height:20,bottom:8,borderColor:"#ccc",fillerColor:"rgba(64, 158, 255, 0.2)",handleStyle:{color:"#409eff"}}],series:T};console.log("设置图表配置"),k.setOption(x,!0),console.log("图表渲染完成"),console.log("=== 渲染图表结束 ===")};he(M,async a=>{a==="chart"&&(b.value.length===0?(console.log("图表视图无数据，开始查询..."),await le()):(console.log("图表视图有数据，渲染图表..."),setTimeout(()=>{be(()=>{ne()})},100)))}),he([()=>w.value,()=>M.value],()=>{w.value==="history"&&M.value==="chart"&&k&&setTimeout(()=>{k&&k.resize()},100)}),_e(()=>{window.addEventListener("resize",()=>{k&&k.resize()})});const Pe=async a=>{if(console.log("点击命令按钮:",a),console.log("设备状态:",u.status),u.status!==1){y.warning("设备离线，无法下发命令");return}try{await Ie.confirm(`是否确认执行 ${a.commandName||a.addr} 指令？`,"命令确认",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}),await Fe({deviceCode:u.deviceCode,commands:[{addr:a.addr,addrv:a.commandValue}]})&&(y.success("命令已下发"),setTimeout(()=>{se()},1e3))}catch(e){e!=="cancel"&&(console.error("发送命令失败:",e),y.error("发送命令失败"))}},W=async a=>{w.value=a,a==="realtime"?se():a==="history"?(await ge(),N.value.length===0&&ye(),b.value.length===0&&await le()):a==="command"?await Se():a==="log"&&Z()},Z=async()=>{var a,e,o,s,d,T,x;U.value=!0;try{const n=await Qe({page:V.currentPage,pageSize:V.pageSize,deviceCode:u.deviceCode,logType:oe.value.logType,startTime:(a=F.value)==null?void 0:a[0],endTime:(e=F.value)==null?void 0:e[1]});E.value=(n==null?void 0:n.list)||[],V.total=(n==null?void 0:n.total)||0}catch(n){if(console.error("加载设备日志失败:",n),((o=n==null?void 0:n.response)==null?void 0:o.status)===401||(s=n==null?void 0:n.message)!=null&&s.includes("登录已过期")||(d=n==null?void 0:n.message)!=null&&d.includes("未授权"))return;const p=((x=(T=n==null?void 0:n.response)==null?void 0:T.data)==null?void 0:x.message)||(n==null?void 0:n.message)||"获取设备日志失败";y.error(p)}finally{U.value=!1}},ye=()=>{const a=new Date,e=new Date(a.getFullYear(),a.getMonth(),a.getDate(),0,0,0);N.value=[re(e),re(a)]},re=a=>{const e=new Date(a),o=e.getFullYear(),s=String(e.getMonth()+1).padStart(2,"0"),d=String(e.getDate()).padStart(2,"0"),T=String(e.getHours()).padStart(2,"0"),x=String(e.getMinutes()).padStart(2,"0"),n=String(e.getSeconds()).padStart(2,"0");return`${o}-${s}-${d} ${T}:${x}:${n}`},R=()=>{Te.push("/devices")},ie=async(a,e)=>{try{if(navigator.clipboard&&navigator.clipboard.writeText){await navigator.clipboard.writeText(a),y({message:`${e}已复制到剪贴板`,type:"success",duration:2e3});return}const o=document.createElement("textarea");o.value=a,o.style.position="fixed",o.style.left="-999999px",o.style.top="-999999px",document.body.appendChild(o),o.select();try{const s=document.execCommand("copy");if(document.body.removeChild(o),s)y({message:`${e}已复制到剪贴板`,type:"success",duration:2e3});else throw new Error("execCommand failed")}catch(s){throw document.body.removeChild(o),s}}catch(o){console.error("复制失败:",o),y.error("复制失败，请手动选择复制")}};return _e(()=>{De(),ye()}),(a,e)=>{const o=D("el-icon"),s=D("el-button"),d=D("el-radio-button"),T=D("el-radio-group"),x=D("el-date-picker"),n=D("el-table-column"),p=D("el-table"),h=D("el-pagination"),P=D("el-option"),I=D("el-select"),$=D("el-tag"),fe=Ne("loading");return c(),g("div",We,[t("div",Ze,[t("div",{class:"breadcrumb"},[t("span",{onClick:R,class:"breadcrumb-link"},"设备管理"),e[17]||(e[17]=t("span",{class:"breadcrumb-sep"},"/",-1)),e[18]||(e[18]=t("span",{class:"breadcrumb-current"},"设备详情",-1))]),l(s,{type:"primary",onClick:R,size:"default",class:"back-btn"},{default:i(()=>[l(o,{style:{"margin-right":"6px"}},{default:i(()=>[l(f(Ve))]),_:1}),e[19]||(e[19]=C(" 返回设备列表 ",-1))]),_:1})]),w.value!=="history"?(c(),g("div",Ge,[t("div",Xe,[t("div",Ke,[t("div",et,[t("div",tt,[t("div",at,[t("h1",ot,m(u.deviceName||"-"),1),t("div",st,m(u.deviceCode||"-"),1)]),t("div",{class:q(["status-badge",u.status===1?"status-online":"status-offline"])},[e[20]||(e[20]=t("span",{class:"status-dot"},null,-1)),t("span",null,m(u.status===1?"在线":"离线"),1)],2)])])]),t("div",lt,[t("div",nt,[e[21]||(e[21]=t("div",{class:"info-label"},"产品类型",-1)),t("div",rt,m(u.productName||"-"),1)]),t("div",it,[e[22]||(e[22]=t("div",{class:"info-label"},"所属分组",-1)),t("div",dt,m(u.groupName||"-"),1)]),t("div",ct,[e[23]||(e[23]=t("div",{class:"info-label"},"最后上线",-1)),t("div",ut,m(re(u.lastOnlineTime)||"-"),1)])])]),t("div",pt,[t("div",mt,[l(o,{class:"section-icon",size:20},{default:i(()=>[l(f(Ye))]),_:1}),e[24]||(e[24]=C(" MQTT连接信息 ",-1))]),t("div",gt,[t("div",vt,[e[25]||(e[25]=t("span",{class:"mqtt-label"},"地址:",-1)),t("span",yt,m(A.broker||"-"),1),e[26]||(e[26]=t("span",{class:"mqtt-sep"},"|",-1)),e[27]||(e[27]=t("span",{class:"mqtt-label"},"端口:",-1)),t("span",ft,m(A.port||"-"),1)]),t("div",ht,[e[28]||(e[28]=t("span",{class:"mqtt-label"},"Client ID:",-1)),t("code",_t,m(u.deviceCode||"-"),1),l(s,{text:"",class:"copy-btn",onClick:e[0]||(e[0]=r=>ie(u.deviceCode,"Client ID")),size:"small"},{default:i(()=>[l(o,null,{default:i(()=>[l(f(pe))]),_:1})]),_:1})]),t("div",bt,[e[29]||(e[29]=t("span",{class:"mqtt-label"},"发布主题:",-1)),t("code",wt,"ssc/"+m(u.deviceCode||"-")+"/report",1),l(s,{text:"",class:"copy-btn",onClick:e[1]||(e[1]=r=>ie(`ssc/${u.deviceCode}/report`,"发布主题")),size:"small"},{default:i(()=>[l(o,null,{default:i(()=>[l(f(pe))]),_:1})]),_:1})]),t("div",Ct,[e[30]||(e[30]=t("span",{class:"mqtt-label"},"订阅主题:",-1)),t("code",Tt,"ssc/"+m(u.deviceCode||"-")+"/command",1),l(s,{text:"",class:"copy-btn",onClick:e[2]||(e[2]=r=>ie(`ssc/${u.deviceCode}/command`,"订阅主题")),size:"small"},{default:i(()=>[l(o,null,{default:i(()=>[l(f(pe))]),_:1})]),_:1})])])])])):S("",!0),t("div",xt,[t("button",{class:q(["tab",{active:w.value==="realtime"}]),onClick:e[3]||(e[3]=r=>W("realtime"))}," 实时数据 ",2),t("button",{class:q(["tab",{active:w.value==="history"}]),onClick:e[4]||(e[4]=r=>W("history"))}," 历史数据 ",2),t("button",{class:q(["tab",{active:w.value==="command"}]),onClick:e[5]||(e[5]=r=>W("command"))}," 命令控制 ",2),t("button",{class:q(["tab",{active:w.value==="log"}]),onClick:e[6]||(e[6]=r=>W("log"))}," 设备日志 ",2)]),t("div",{class:q(["tab-content",{active:w.value==="realtime"}])},[O.value.length>0?(c(),g("div",Dt,[t("div",St,[(c(!0),g(de,null,ce(O.value,r=>(c(),g("div",{key:r.key,class:"data-card"},[t("div",zt,m(r.label),1),t("div",null,[t("span",kt,m(r.value),1),r.unit?(c(),g("span",Pt,m(r.unit),1)):S("",!0)]),t("div",$t,[l(o,{class:"time-icon",size:14},{default:i(()=>[l(f(Le))]),_:1}),C(" "+m(ae.value),1)])]))),128))])])):(c(),g("div",Mt,[l(o,{class:"empty-icon",size:64},{default:i(()=>[l(f(te))]),_:1}),e[31]||(e[31]=t("div",{class:"empty-text"},"暂无实时数据",-1))]))],2),t("div",{class:q(["tab-content",{active:w.value==="history"}])},[t("div",qt,[l(T,{modelValue:M.value,"onUpdate:modelValue":e[7]||(e[7]=r=>M.value=r),size:"small"},{default:i(()=>[l(d,{label:"chart"},{default:i(()=>[l(o,{size:16,style:{"margin-right":"4px"}},{default:i(()=>[l(f(we))]),_:1}),e[32]||(e[32]=C(" 趋势图 ",-1))]),_:1}),l(d,{label:"table"},{default:i(()=>[l(o,{size:16,style:{"margin-right":"4px"}},{default:i(()=>[l(f(te))]),_:1}),e[33]||(e[33]=C(" 表格 ",-1))]),_:1}),l(d,{label:"metadata"},{default:i(()=>[l(o,{size:16,style:{"margin-right":"4px"}},{default:i(()=>[l(f(Ce))]),_:1}),e[34]||(e[34]=C(" 元数据 ",-1))]),_:1})]),_:1},8,["modelValue"]),t("div",Nt,[l(x,{modelValue:N.value,"onUpdate:modelValue":e[8]||(e[8]=r=>N.value=r),type:"datetimerange","range-separator":"至","start-placeholder":"开始时间","end-placeholder":"结束时间",format:"YYYY-MM-DD HH:mm:ss","value-format":"YYYY-MM-DD HH:mm:ss",style:{width:"400px"}},null,8,["modelValue"]),l(s,{type:"primary",onClick:le},{default:i(()=>[...e[35]||(e[35]=[C("查询",-1)])]),_:1})])]),K(t("div",Vt,[t("div",{ref_key:"historyChartRef",ref:H,class:"history-chart"},null,512),b.value.length===0?(c(),g("div",Yt,[l(o,{class:"empty-icon",size:64},{default:i(()=>[l(f(we))]),_:1}),e[36]||(e[36]=t("div",{class:"empty-text"},"暂无历史数据",-1))])):S("",!0)],512),[[ue,M.value==="chart"]]),K(t("div",Lt,[t("div",Ht,[l(p,{data:ze.value,stripe:"",style:{width:"100%"},height:ve.value},{default:i(()=>[l(n,{prop:"reportTime",label:"上报时间",width:"220",fixed:""}),(c(!0),g(de,null,ce(z.value,r=>(c(),Y(n,{key:r.addr,label:r.attrName,"min-width":"100"},{default:i(({row:G})=>[G[r.addr]!==void 0&&G[r.addr]!==null?(c(),g("span",At,[C(m(G[r.addr])+" ",1),r.unit?(c(),g("span",It,m(r.unit),1)):S("",!0)])):(c(),g("span",Jt,"-"))]),_:2},1032,["label"]))),128))]),_:1},8,["data","height"]),b.value.length>0?(c(),Y(h,{key:0,"current-page":v.currentPage,"onUpdate:currentPage":e[9]||(e[9]=r=>v.currentPage=r),"page-size":v.pageSize,"onUpdate:pageSize":e[10]||(e[10]=r=>v.pageSize=r),"page-sizes":[20,50,100,200],total:v.total,layout:"total, sizes, prev, pager, next, jumper",class:"history-pagination"},null,8,["current-page","page-size","total"])):S("",!0),b.value.length===0?(c(),g("div",Rt,[l(o,{class:"empty-icon",size:64},{default:i(()=>[l(f(te))]),_:1}),e[37]||(e[37]=t("div",{class:"empty-text"},"暂无历史数据",-1))])):S("",!0)])],512),[[ue,M.value==="table"]]),K(t("div",Bt,[t("div",Ot,[l(p,{data:ke.value,stripe:"",style:{width:"100%"},height:ve.value,border:""},{default:i(()=>[l(n,{prop:"reportTime",label:"上报时间",width:"220",fixed:"left"},{default:i(({row:r})=>[t("div",jt,[t("span",null,m(r.reportTime),1)])]),_:1}),l(n,{prop:"formattedJson",label:"原始JSON数据"},{default:i(({row:r})=>[t("div",Et,[t("pre",Ut,m(r.rawJson),1)])]),_:1})]),_:1},8,["data","height"]),Q.value.length>0?(c(),Y(h,{key:0,"current-page":v.currentPage,"onUpdate:currentPage":e[11]||(e[11]=r=>v.currentPage=r),"page-size":v.pageSize,"onUpdate:pageSize":e[12]||(e[12]=r=>v.pageSize=r),"page-sizes":[20,50,100,200],total:Q.value.length,layout:"total, sizes, prev, pager, next, jumper",class:"metadata-pagination"},null,8,["current-page","page-size","total"])):S("",!0),Q.value.length===0?(c(),g("div",Ft,[l(o,{class:"empty-icon",size:64},{default:i(()=>[l(f(Ce))]),_:1}),e[38]||(e[38]=t("div",{class:"empty-text"},"暂无元数据",-1)),e[39]||(e[39]=t("div",{class:"empty-hint"},"请先查询历史数据",-1))])):S("",!0)])],512),[[ue,M.value==="metadata"]])],2),t("div",{class:q(["tab-content",{active:w.value==="command"}])},[t("div",Qt,[(c(!0),g(de,null,ce(L.value,r=>(c(),g("button",{key:r.id,class:"command-btn",onClick:G=>Pe(r)},[l(o,{class:"command-icon",size:40},{default:i(()=>[l(f(He))]),_:1}),t("div",Zt,m(r.commandName),1)],8,Wt))),128)),L.value.length===0?(c(),g("div",Gt,[l(o,{class:"empty-icon",size:64},{default:i(()=>[l(f(Ae))]),_:1}),e[40]||(e[40]=t("div",{class:"empty-text"},"暂无可用命令",-1))])):S("",!0)])],2),t("div",{class:q(["tab-content",{active:w.value==="log"}])},[t("div",Xt,[l(I,{modelValue:oe.value.logType,"onUpdate:modelValue":e[13]||(e[13]=r=>oe.value.logType=r),placeholder:"日志类型",clearable:"",style:{width:"150px"}},{default:i(()=>[l(P,{label:"全部",value:""}),l(P,{label:"设备上线",value:"online"}),l(P,{label:"设备离线",value:"offline"}),l(P,{label:"命令下发",value:"command"})]),_:1},8,["modelValue"]),l(x,{modelValue:F.value,"onUpdate:modelValue":e[14]||(e[14]=r=>F.value=r),type:"datetimerange","range-separator":"至","start-placeholder":"开始时间","end-placeholder":"结束时间",format:"YYYY-MM-DD HH:mm:ss","value-format":"YYYY-MM-DD HH:mm:ss",style:{width:"380px"}},null,8,["modelValue"]),l(s,{type:"primary",onClick:Z},{default:i(()=>[...e[41]||(e[41]=[C("查询",-1)])]),_:1})]),t("div",Kt,[K((c(),Y(p,{data:E.value,stripe:"",style:{width:"100%"}},{default:i(()=>[l(n,{prop:"createTime",label:"时间",width:"180"}),l(n,{prop:"logType",label:"类型",width:"120"},{default:i(({row:r})=>[r.logType==="online"?(c(),Y($,{key:0,type:"success"},{default:i(()=>[...e[42]||(e[42]=[C("设备上线",-1)])]),_:1})):r.logType==="offline"?(c(),Y($,{key:1,type:"danger"},{default:i(()=>[...e[43]||(e[43]=[C("设备离线",-1)])]),_:1})):(c(),Y($,{key:2,type:"info"},{default:i(()=>[...e[44]||(e[44]=[C("命令下发",-1)])]),_:1}))]),_:1}),l(n,{prop:"logDetail",label:"详情"})]),_:1},8,["data"])),[[fe,U.value]]),E.value.length>0?(c(),Y(h,{key:0,"current-page":V.currentPage,"onUpdate:currentPage":e[15]||(e[15]=r=>V.currentPage=r),"page-size":V.pageSize,"onUpdate:pageSize":e[16]||(e[16]=r=>V.pageSize=r),total:V.total,"page-sizes":[20,50,100],layout:"total, sizes, prev, pager, next, jumper",class:"log-pagination",onSizeChange:Z,onCurrentChange:Z},null,8,["current-page","page-size","total"])):S("",!0),E.value.length===0&&!U.value?(c(),g("div",ea,[l(o,{class:"empty-icon",size:64},{default:i(()=>[l(f(te))]),_:1}),e[45]||(e[45]=t("div",{class:"empty-text"},"暂无日志数据",-1))])):S("",!0)])],2)])}}},ra=$e(ta,[["__scopeId","data-v-709f9cf1"]]);export{ra as default};
