import{_ as L,b as C,s as x,v as V,N as j,d as M,o as w,e as N,f,g as I,w as D,i as T,U as A,z as b,V as P,t as S,A as F,B as U,F as q,C as W,I as X,O as Y,W as H,E as J,X as K,Y as s}from"./index-df07b552.js";import{g as Q}from"./group-4506506d.js";function R(l){const m=[],v=a=>{Array.isArray(a)&&a.forEach(n=>{m.push({id:n.id,name:n.name,parentId:n.parentId||0,path:n.path,level:n.level,deviceCount:n.deviceCount||0,desc:n.description||""}),n.children&&n.children.length>0&&v(n.children)})};return v(l),m}const Z={class:"group-tree"},ee={class:"group-name"},te={class:"tree-item-right"},oe={key:0,class:"item-count"},ae={class:"tree-children"},ne={__name:"GroupTree",props:{groups:{type:Array,default:()=>[]},autoLoad:{type:Boolean,default:!0},currentGroupId:{type:Number,default:null},showActions:{type:Boolean,default:!0},showCount:{type:Boolean,default:!1},countData:{type:Object,default:()=>({})},defaultExpanded:{type:Boolean,default:!0}},emits:["select","edit","delete","loaded"],setup(l,{expose:m,emit:v}){const a=l,n=v,y=C(a.defaultExpanded),d=C([]),E=C(!1),G=x(()=>a.groups&&a.groups.length>0?a.groups:d.value),_=async()=>{try{E.value=!0;const e=await Q();d.value=R(e.tree||[]),n("loaded",d.value)}catch(e){console.error("åŠ è½½åˆ†ç»„æ•°æ®å¤±è´¥:",e),J.error("åŠ è½½åˆ†ç»„æ•°æ®å¤±è´¥")}finally{E.value=!1}};m({loadGroups:_,groupsData:d});const c=x(()=>{const e=G.value.filter(r=>r.parentId===0||r.parentId===null);return e.length>0?e[0]:null}),$=x(()=>{const e=c.value;return e?G.value.filter(o=>o.parentId===e.id):[]}),O=()=>{y.value=!y.value},k=e=>{e&&n("select",e)},z=e=>a.countData[e]||0,B=K({name:"TreeNode",props:{group:{type:Object,required:!0},allGroups:{type:Array,default:()=>[]},currentGroupId:{type:Number,default:null},showActions:{type:Boolean,default:!0},showCount:{type:Boolean,default:!1},countData:{type:Object,default:()=>({})}},emits:["select","edit","delete"],setup(e,{emit:o}){const r=C(!1),u=x(()=>e.allGroups.filter(t=>t.parentId===e.group.id));return{nodeExpanded:r,children:u,toggleNodeExpand:t=>{t.stopPropagation(),r.value=!r.value},handleNodeSelect:()=>{o("select",e.group.id)},getCount:t=>e.countData[t]||0}},render(){const{group:e,nodeExpanded:o,children:r,showActions:u,showCount:p,countData:h}=this,i=()=>!o||r.length===0?null:s("div",{class:"tree-children"},r.map(t=>s(B,{key:t.id,group:t,allGroups:this.actualGroups,currentGroupId:this.currentGroupId,showActions:u,showCount:p,countData:h,onSelect:g=>this.$emit("select",g),onEdit:g=>this.$emit("edit",g),onDelete:g=>this.$emit("delete",g)})));return s("div",{class:["tree-item","child-item",{active:this.currentGroupId===e.id}],onClick:t=>{t.target.tagName!=="BUTTON"&&!t.target.closest(".tree-item-actions")&&this.handleNodeSelect()}},[s("div",{class:["tree-item-left",{active:this.currentGroupId===e.id}]},[r.length>0?s("el-icon",{class:["expand-icon",{expanded:o}],onClick:this.toggleNodeExpand},[s(A)]):s("span",{class:"child-dot"}),s("span",{class:"group-name"},e.name)]),s("div",{class:"tree-item-right"},[u?s("div",{class:"tree-item-actions",style:"display: flex; gap: 8px;"},[s("el-button",{size:"small",type:"primary",text:!0,onClick:t=>{t.stopPropagation(),this.$emit("edit",e)}},"âœï¸ ç¼–è¾‘"),s("el-button",{size:"small",type:"danger",text:!0,onClick:t=>{t.stopPropagation(),this.$emit("delete",e)}},"ðŸ—‘ï¸ åˆ é™¤")]):null]),i()])}});return V(()=>{a.autoLoad&&(!a.groups||a.groups.length===0)&&_()}),j(()=>a.groups,e=>{a.autoLoad&&(!e||e.length===0)&&d.value.length===0&&_()},{immediate:!0}),(e,o)=>{var u,p,h;const r=M("el-icon");return w(),N("div",Z,[f("div",{class:b(["tree-item root-item",{active:l.currentGroupId===((u=c.value)==null?void 0:u.id)}])},[f("div",{class:"tree-item-left",onClick:o[0]||(o[0]=i=>{var t;return k((t=c.value)==null?void 0:t.id)})},[I(r,{class:b(["expand-icon",{expanded:y.value}]),onClick:P(O,["stop"])},{default:D(()=>[I(T(A))]),_:1},8,["class"]),f("span",ee,S(((p=c.value)==null?void 0:p.name)||"æ€»åˆ†ç»„"),1)]),f("div",te,[l.showCount?(w(),N("span",oe,S(z((h=c.value)==null?void 0:h.id)),1)):F("",!0)])],2),I(H,{name:"slide-fade"},{default:D(()=>[U(f("div",ae,[(w(!0),N(q,null,W($.value,i=>(w(),X(T(B),{key:i.id,group:i,"all-groups":G.value,"current-group-id":l.currentGroupId,"show-actions":l.showActions,"show-count":l.showCount,"count-data":l.countData,onSelect:k,onEdit:o[1]||(o[1]=t=>e.$emit("edit",t)),onDelete:o[2]||(o[2]=t=>e.$emit("delete",t))},null,8,["group","all-groups","current-group-id","show-actions","show-count","count-data"]))),128))],512),[[Y,y.value]])]),_:1})])}}},le=L(ne,[["__scopeId","data-v-33f4013c"]]);export{le as G,R as f};
