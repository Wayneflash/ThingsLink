import{_ as K,Z as O,r,a0 as X,o as _,c as E,b as n,e as a,w as l,k as S,a1 as M,g as m,E as y,B as ee,i as v,ab as te,T as ae,F as le,d as oe,M as se,q as z,D as ne,t as b,a8 as re,y as ie,s as de,h as Y}from"./index-b22c89f8.js";import{b as ce}from"./energy-9a038ebd.js";import{g as pe}from"./device-bd9b9d14.js";import{f as ue,G as ge}from"./GroupTree-356546ac.js";import{g as me}from"./group-ecf4db62.js";const fe={class:"energy-report-page min-h-screen bg-gray-50"},_e={class:"energy-container"},ye={class:"btn-left"},ve={class:"tree-hint"},be={class:"content-panel"},he={class:"flex items-center justify-between"},we={class:"text-lg font-semibold text-gray-900"},xe={class:"flex items-center gap-2"},Te={class:"flex items-center"},Se={class:"text-gray-900"},ze={class:"font-semibold text-gray-900"},De={class:"ml-1 text-sm text-gray-500"},Ve={class:"pagination-wrapper mt-4"},ke={__name:"EnergyReport",setup(Ie){const f=m(!1),D=m(!1),k=m(!1),o=Y({energyType:"electric",deviceId:null,groupId:null,reportType:"daily"}),c=m([]),I=m([]),C=m([]),H=t=>{o.groupId=t,p()},U=()=>{o.groupId=null,p()},G=async()=>{try{const t=await me();t.tree&&(C.value=ue(t.tree))}catch(t){console.error("加载分组列表失败:",t)}},u=m([]),i=Y({page:1,pageSize:10,total:0}),$=t=>({electric:"电力",water:"水耗",gas:"气耗"})[t]||"能源",B=t=>({electric:"kWh",water:"m³",gas:"m³"})[t]||"",F=async()=>{try{const t=await pe({page:1,pageSize:1e3});t&&t.list&&(I.value=t.list)}catch(t){console.error("加载设备列表失败:",t)}},p=async()=>{if(!o.energyType){y.warning("请选择能源类型");return}if(!c.value||c.value.length!==2){y.warning("请选择时间范围");return}f.value=!0,k.value=!0;try{const t={energyType:o.energyType,startTime:c.value[0],endTime:c.value[1],deviceId:o.deviceId||null,groupId:o.groupId||null,reportType:o.reportType||"daily",page:i.page,pageSize:i.pageSize},e=await ce(t);u.value=(e==null?void 0:e.records)||[],i.total=(e==null?void 0:e.total)||0}catch(t){console.error("查询能耗报表失败:",t),y.error(t.message||"查询失败，请稍后重试"),u.value=[],i.total=0}finally{f.value=!1}},R=async()=>{if(u.value.length===0){y.warning("暂无数据可导出");return}D.value=!0;try{y.success("导出功能开发中...")}catch(t){console.error("导出报表失败:",t),y.error("导出失败，请稍后重试")}finally{D.value=!1}},L=()=>{o.energyType="electric",o.deviceId=null,o.groupId=null,o.reportType="daily",c.value=[],i.page=1,i.pageSize=10,u.value=[],i.total=0},j=t=>t==null||isNaN(t)?"0.00":Number(t).toFixed(2),N=t=>{const e=t.getFullYear(),h=String(t.getMonth()+1).padStart(2,"0"),w=String(t.getDate()).padStart(2,"0"),d=String(t.getHours()).padStart(2,"0"),x=String(t.getMinutes()).padStart(2,"0"),g=String(t.getSeconds()).padStart(2,"0");return`${e}-${h}-${w} ${d}:${x}:${g}`};return O(async()=>{const t=new Date,e=new Date;e.setDate(e.getDate()-30),e.setHours(0,0,0,0),t.setHours(23,59,59,999),c.value=[N(e),N(t)],await Promise.all([F(),G()]),await p()}),(t,e)=>{const h=r("el-icon"),w=r("el-card"),d=r("el-option"),x=r("el-select"),g=r("el-form-item"),Q=r("el-date-picker"),V=r("el-button"),q=r("el-form"),P=r("el-tag"),T=r("el-table-column"),A=r("el-table"),W=r("el-pagination"),Z=r("el-empty"),J=X("loading");return _(),E("div",fe,[e[12]||(e[12]=n("div",{class:"page-header bg-white shadow-sm mb-6 px-6 py-4"},[n("h1",{class:"text-2xl font-semibold text-gray-900 mb-2"},"能耗报表"),n("p",{class:"text-sm text-gray-600"},"支持电、水、气三种能源类型的能耗报表导出")],-1)),n("div",_e,[a(w,{class:"tree-panel",shadow:"hover"},{header:l(()=>[...e[6]||(e[6]=[n("div",{style:{display:"flex","justify-content":"space-between","align-items":"center"}},[n("strong",{style:{"font-size":"15px"}},"设备分组")],-1)])]),default:l(()=>[n("div",{class:ee(["all-groups-btn",{active:o.groupId===null}]),onClick:U},[n("div",ye,[a(h,null,{default:l(()=>[a(v(te))]),_:1}),e[7]||(e[7]=n("span",null,"全部分组",-1))])],2),a(ge,{groups:C.value,"current-group-id":o.groupId,"show-actions":!1,"show-count":!1,onSelect:H},null,8,["groups","current-group-id"]),n("div",ve,[a(h,{size:14,class:"hint-icon"},{default:l(()=>[a(v(ae))]),_:1}),e[8]||(e[8]=n("span",null,"点击分组查看该分组下的能耗数据",-1))])]),_:1}),n("div",be,[a(w,{class:"filter-card mb-6 shadow-sm",shadow:"hover"},{default:l(()=>[a(q,{model:o,inline:"",class:"filter-form"},{default:l(()=>[a(g,{label:"能源类型"},{default:l(()=>[a(x,{modelValue:o.energyType,"onUpdate:modelValue":e[0]||(e[0]=s=>o.energyType=s),placeholder:"能源类型",class:"filter-select",onChange:p},{default:l(()=>[a(d,{label:"电力",value:"electric"}),a(d,{label:"水耗",value:"water"}),a(d,{label:"气耗",value:"gas"})]),_:1},8,["modelValue"])]),_:1}),a(g,{label:"时间范围"},{default:l(()=>[a(Q,{modelValue:c.value,"onUpdate:modelValue":e[1]||(e[1]=s=>c.value=s),type:"datetimerange","range-separator":"至","start-placeholder":"开始","end-placeholder":"结束",format:"YYYY-MM-DD HH:mm:ss","value-format":"YYYY-MM-DD HH:mm:ss",class:"filter-datepicker"},null,8,["modelValue"])]),_:1}),a(g,{label:"设备"},{default:l(()=>[a(x,{modelValue:o.deviceId,"onUpdate:modelValue":e[2]||(e[2]=s=>o.deviceId=s),placeholder:"全部设备",filterable:"",clearable:"",class:"filter-select"},{default:l(()=>[(_(!0),E(le,null,oe(I.value,s=>(_(),S(d,{key:s.id,label:s.deviceName,value:s.id},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1}),a(g,{label:"报表类型"},{default:l(()=>[a(x,{modelValue:o.reportType,"onUpdate:modelValue":e[3]||(e[3]=s=>o.reportType=s),placeholder:"类型",class:"filter-select-small",onChange:p},{default:l(()=>[a(d,{label:"日报表",value:"daily"}),a(d,{label:"月报表",value:"monthly"}),a(d,{label:"年报表",value:"yearly"})]),_:1},8,["modelValue"])]),_:1}),a(g,{class:"filter-buttons"},{default:l(()=>[a(V,{type:"primary",onClick:p,icon:v(se),loading:f.value,size:"default"},{default:l(()=>[...e[9]||(e[9]=[z(" 查询 ",-1)])]),_:1},8,["icon","loading"]),a(V,{onClick:L,icon:v(ne),size:"default"},{default:l(()=>[...e[10]||(e[10]=[z(" 重置 ",-1)])]),_:1},8,["icon"])]),_:1})]),_:1},8,["model"])]),_:1}),u.value.length>0||f.value?(_(),S(w,{key:0,class:"report-card shadow-sm",shadow:"hover"},{header:l(()=>[n("div",he,[n("span",we,b($(o.energyType))+"报表 ",1),n("div",xe,[a(P,{size:"small",type:"info"},{default:l(()=>[z(b(B(o.energyType)),1)]),_:1}),a(V,{size:"small",type:"success",icon:v(re),onClick:R,loading:D.value},{default:l(()=>[...e[11]||(e[11]=[z(" 导出 ",-1)])]),_:1},8,["icon","loading"])])])]),default:l(()=>[ie((_(),S(A,{data:u.value,stripe:"",class:"report-table","default-sort":{prop:"date",order:"descending"}},{default:l(()=>[a(T,{prop:"deviceName",label:"设备名称","min-width":"180",fixed:"left"},{default:l(({row:s})=>[n("div",Te,[a(h,{class:"mr-2 text-gray-400"},{default:l(()=>[a(v(de))]),_:1}),n("span",null,b(s.deviceName),1)])]),_:1}),a(T,{prop:"deviceCode",label:"设备编码","min-width":"150"}),a(T,{prop:"date",label:"日期",width:"180",sortable:""},{default:l(({row:s})=>[n("span",Se,b(s.date),1)]),_:1}),a(T,{prop:"consumption",label:"能耗",width:"180",sortable:"",align:"right"},{default:l(({row:s})=>[n("span",ze,b(j(s.consumption)),1),n("span",De,b(s.unit),1)]),_:1})]),_:1},8,["data"])),[[J,f.value]]),n("div",Ve,[a(W,{"current-page":i.page,"onUpdate:currentPage":e[4]||(e[4]=s=>i.page=s),"page-size":i.pageSize,"onUpdate:pageSize":e[5]||(e[5]=s=>i.pageSize=s),"page-sizes":[10,20,50,100],total:i.total,layout:"total, sizes, prev, pager, next, jumper",onSizeChange:p,onCurrentChange:p,class:"pagination"},null,8,["current-page","page-size","total"])])]),_:1})):M("",!0),!f.value&&k.value&&u.value.length===0?(_(),S(Z,{key:1,description:"暂无数据","image-size":120})):M("",!0)])])])}}},He=K(ke,[["__scopeId","data-v-87fd81f2"]]);export{He as default};
