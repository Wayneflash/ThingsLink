import{_ as O,r as C,q as x,s as j,H as M,c as P,o as w,d as I,e as m,f as N,w as D,h as T,$ as A,y as $,a0 as V,t as S,z as q,A as F,F as H,B as R,I as U,R as J,a1 as K,E as Q,a2 as W,a3 as s}from"./index-6b170f93.js";import{g as X}from"./group-a8b438dc.js";function Y(l){const f=[],v=o=>{Array.isArray(o)&&o.forEach(n=>{f.push({id:n.id,name:n.name,parentId:n.parentId||0,path:n.path,level:n.level,deviceCount:n.deviceCount||0,desc:n.description||""}),n.children&&n.children.length>0&&v(n.children)})};return v(l),f}const Z={class:"group-tree"},ee={class:"group-name"},te={class:"tree-item-right"},ae={key:0,class:"item-count"},oe={class:"tree-children"},ne={__name:"GroupTree",props:{groups:{type:Array,default:()=>[]},autoLoad:{type:Boolean,default:!0},currentGroupId:{type:Number,default:null},showActions:{type:Boolean,default:!0},showCount:{type:Boolean,default:!1},countData:{type:Object,default:()=>({})},defaultExpanded:{type:Boolean,default:!0}},emits:["select","edit","delete","loaded"],setup(l,{expose:f,emit:v}){const o=l,n=v,y=C(o.defaultExpanded),d=C([]),E=C(!1),G=x(()=>o.groups&&o.groups.length>0?o.groups:d.value),_=async()=>{try{E.value=!0;const e=await X();d.value=Y(e.tree||[]),n("loaded",d.value)}catch(e){console.error("åŠ è½½åˆ†ç»„æ•°æ®å¤±è´¥:",e),Q.error("åŠ è½½åˆ†ç»„æ•°æ®å¤±è´¥")}finally{E.value=!1}};f({loadGroups:_,groupsData:d});const c=x(()=>{const e=G.value.filter(r=>r.parentId===0||r.parentId===null);return e.length>0?e[0]:null}),b=x(()=>{const e=c.value;return e?G.value.filter(a=>a.parentId===e.id):[]}),z=()=>{y.value=!y.value},k=e=>{e&&n("select",e)},L=e=>o.countData[e]||0,B=W({name:"TreeNode",props:{group:{type:Object,required:!0},allGroups:{type:Array,default:()=>[]},currentGroupId:{type:Number,default:null},showActions:{type:Boolean,default:!0},showCount:{type:Boolean,default:!1},countData:{type:Object,default:()=>({})}},emits:["select","edit","delete"],setup(e,{emit:a}){const r=C(!1),u=x(()=>e.allGroups.filter(t=>t.parentId===e.group.id));return{nodeExpanded:r,children:u,toggleNodeExpand:t=>{t.stopPropagation(),r.value=!r.value},handleNodeSelect:()=>{a("select",e.group.id)},getCount:t=>e.countData[t]||0}},render(){const{group:e,nodeExpanded:a,children:r,showActions:u,showCount:p,countData:h}=this,i=()=>!a||r.length===0?null:s("div",{class:"tree-children"},r.map(t=>s(B,{key:t.id,group:t,allGroups:this.actualGroups,currentGroupId:this.currentGroupId,showActions:u,showCount:p,countData:h,onSelect:g=>this.$emit("select",g),onEdit:g=>this.$emit("edit",g),onDelete:g=>this.$emit("delete",g)})));return s("div",{class:["tree-item","child-item",{active:this.currentGroupId===e.id}],onClick:t=>{t.target.tagName!=="BUTTON"&&!t.target.closest(".tree-item-actions")&&this.handleNodeSelect()}},[s("div",{class:["tree-item-left",{active:this.currentGroupId===e.id}]},[r.length>0?s("el-icon",{class:["expand-icon",{expanded:a}],onClick:this.toggleNodeExpand},[s(A)]):s("span",{class:"child-dot"}),s("span",{class:"group-name"},e.name)]),s("div",{class:"tree-item-right"},[u?s("div",{class:"tree-item-actions",style:"display: flex; gap: 8px;"},[s("el-button",{size:"small",type:"primary",text:!0,onClick:t=>{t.stopPropagation(),this.$emit("edit",e)}},"âœï¸ ç¼–è¾‘"),s("el-button",{size:"small",type:"danger",text:!0,onClick:t=>{t.stopPropagation(),this.$emit("delete",e)}},"ðŸ—‘ï¸ åˆ é™¤")]):null]),i()])}});return j(()=>{o.autoLoad&&(!o.groups||o.groups.length===0)&&_()}),M(()=>o.groups,e=>{o.autoLoad&&(!e||e.length===0)&&d.value.length===0&&_()},{immediate:!0}),(e,a)=>{var u,p,h;const r=P("el-icon");return w(),I("div",Z,[m("div",{class:$(["tree-item root-item",{active:l.currentGroupId===((u=c.value)==null?void 0:u.id)}])},[m("div",{class:"tree-item-left",onClick:a[0]||(a[0]=i=>{var t;return k((t=c.value)==null?void 0:t.id)})},[N(r,{class:$(["expand-icon",{expanded:y.value}]),onClick:V(z,["stop"])},{default:D(()=>[N(T(A))]),_:1},8,["class"]),m("span",ee,S(((p=c.value)==null?void 0:p.name)||"æ€»åˆ†ç»„"),1)]),m("div",te,[l.showCount?(w(),I("span",ae,S(L((h=c.value)==null?void 0:h.id)),1)):q("",!0)])],2),N(K,{name:"slide-fade"},{default:D(()=>[F(m("div",oe,[(w(!0),I(H,null,R(b.value,i=>(w(),U(T(B),{key:i.id,group:i,"all-groups":G.value,"current-group-id":l.currentGroupId,"show-actions":l.showActions,"show-count":l.showCount,"count-data":l.countData,onSelect:k,onEdit:a[1]||(a[1]=t=>e.$emit("edit",t)),onDelete:a[2]||(a[2]=t=>e.$emit("delete",t))},null,8,["group","all-groups","current-group-id","show-actions","show-count","count-data"]))),128))],512),[[J,y.value]])]),_:1})])}}},le=O(ne,[["__scopeId","data-v-99c3a56a"]]);export{le as G,Y as f};
