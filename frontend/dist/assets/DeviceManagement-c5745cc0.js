import{_ as ye,u as be,b as n,c as we,s as Ce,v as Ve,d as r,y as he,o as V,e as F,f as u,g as t,w as o,E as y,z as ke,i as U,H as xe,t as G,h as Se,F as K,C as H,I as q,J as Ie,q as c,K as De,L as ze,B as $e,M as Ne}from"./index-d25c41ea.js";import{g as Me,d as Pe,u as Ue,c as Ge}from"./device-d263828f.js";import{g as Le}from"./group-a2fe2bd7.js";import{g as Be}from"./product-a510e37a.js";import{f as Te,G as Fe}from"./GroupTree-8e23dc37.js";import{G as qe}from"./GroupSelector-9b63f6bd.js";const je={class:"device-management-page"},Ee={class:"device-container"},Re={class:"btn-left"},Ae={class:"device-count"},Oe={style:{display:"flex","justify-content":"space-between","align-items":"center",gap:"20px"}},Ke={style:{margin:"0","font-size":"16px"}},He={style:{display:"flex",gap:"12px"}},Je={class:"pagination-container"},Qe={__name:"DeviceManagement",setup(Ye){const J=be(),L=n(!1),N=n(!1),b=n(!1),B=n("æ·»åŠ è®¾å¤‡"),w=n(!1),M=n(null),T=n(null),h=n(""),k=n(""),x=n(""),g=n(null),i=n(1),S=n(20),j=n(0),I=n([]),D=n([]),P=n([]),E=n(0),s=we({id:null,deviceName:"",deviceCode:"",productId:null,groupId:null,remark:""}),Q={deviceName:[{required:!0,message:"è¯·è¾“å…¥è®¾å¤‡åç§°",trigger:"blur"}],deviceCode:[{required:!0,message:"è¯·è¾“å…¥è®¾å¤‡ç¼–ç ",trigger:"blur"}],productId:[{required:!0,message:"è¯·é€‰æ‹©äº§å“ç±»å‹",trigger:"change"}],groupId:[{required:!0,message:"è¯·é€‰æ‹©æ‰€å±åˆ†ç»„",trigger:"change"}]},Y=l=>(i.value-1)*S.value+l+1,W=l=>{if(!l)return"-";if(typeof l=="string"&&l.match(/^\d{4}-\d{2}-\d{2} \d{2}:\d{2}:\d{2}$/))return l;const e=new Date(l),v=e.getFullYear(),_=String(e.getMonth()+1).padStart(2,"0"),C=String(e.getDate()).padStart(2,"0"),f=String(e.getHours()).padStart(2,"0"),z=String(e.getMinutes()).padStart(2,"0"),d=String(e.getSeconds()).padStart(2,"0");return`${v}-${_}-${C} ${f}:${z}:${d}`},X=Ce(()=>{if(!g.value)return`å…¨éƒ¨è®¾å¤‡ (${I.value.length}å°)`;const l=P.value.find(e=>e.id===g.value);if(l){const e=I.value.length;return`${l.name} (${e}å°)`}return"è¯·é€‰æ‹©åˆ†ç»„"}),p=async()=>{try{L.value=!0;const l=await Me({page:i.value,pageSize:S.value,keyword:h.value,status:k.value,groupId:g.value,productId:x.value});console.log("è®¾å¤‡åˆ—è¡¨APIè¿”å›:",l),I.value=l.list||[],j.value=l.total||0,console.log("è®¾å¤‡åˆ—è¡¨æ•°æ®:",I.value),g.value||(E.value=l.total||0)}catch(l){console.error("åŠ è½½è®¾å¤‡åˆ—è¡¨å¤±è´¥:",l),y.error("åŠ è½½è®¾å¤‡åˆ—è¡¨å¤±è´¥")}finally{L.value=!1}},Z=async()=>{try{const l=await Be({page:1,pageSize:1e3});console.log("äº§å“åˆ—è¡¨APIè¿”å›:",l),D.value=l.list||[],console.log("äº§å“åˆ—è¡¨æ•°æ®:",D.value)}catch(l){console.error("åŠ è½½äº§å“åˆ—è¡¨å¤±è´¥:",l)}},ee=async()=>{try{const l=await Le();l.tree&&(P.value=Te(l.tree),console.log("åŠ è½½çš„åˆ†ç»„æ•°æ®ï¼ˆæ‰å¹³åŒ–ï¼‰:",P.value))}catch(l){console.error("åŠ è½½åˆ†ç»„åˆ—è¡¨å¤±è´¥:",l)}},R=l=>{if(console.log("getProductLabelè°ƒç”¨ï¼Œproduct:",l),!l)return"";const e=l.productName||l.name||"",v=l.productModel||l.model||"",_=v?`${e} - ${v}`:e;return console.log("äº§å“æ ‡ç­¾:",_),_},le=()=>{g.value=null,console.log("é€‰ä¸­å…¨éƒ¨è®¾å¤‡"),i.value=1,p()},te=l=>{g.value=l,console.log("é€‰ä¸­åˆ†ç»„:",l),i.value=1,p()},A=()=>{console.log("æ‰§è¡ŒæŸ¥è¯¢ï¼Œæœç´¢å…³é”®è¯:",h.value,"çŠ¶æ€:",k.value,"äº§å“:",x.value),i.value=1,p()},ae=()=>{console.log("åˆ·æ–°è®¾å¤‡åˆ—è¡¨"),h.value="",k.value="",x.value="",i.value=1,p(),y.success("åˆ·æ–°æˆåŠŸ")},oe=async()=>{B.value="æ·»åŠ è®¾å¤‡",w.value=!1,b.value=!0,await new Promise(l=>setTimeout(l,100)),T.value&&await T.value.loadGroups()},ne=l=>{J.push({path:"/devices/detail",query:{deviceCode:l.deviceCode}})},se=l=>{B.value="ç¼–è¾‘è®¾å¤‡",w.value=!0,Object.assign(s,{id:l.id,deviceName:l.deviceName,deviceCode:l.deviceCode,productId:l.productId,groupId:l.groupId,remark:l.remark||""}),b.value=!0},re=l=>{Ne.confirm(`ç¡®å®šè¦åˆ é™¤è®¾å¤‡"${l.deviceName}"å—ï¼Ÿ`,"åˆ é™¤ç¡®è®¤",{confirmButtonText:"ç¡®å®š",cancelButtonText:"å–æ¶ˆ",type:"warning"}).then(async()=>{try{await Pe(l.deviceCode),y.success("è®¾å¤‡åˆ é™¤æˆåŠŸ"),p()}catch(e){console.error("åˆ é™¤è®¾å¤‡å¤±è´¥:",e),y.error("è®¾å¤‡åˆ é™¤å¤±è´¥")}}).catch(()=>{})},ue=async()=>{if(N.value){console.log("æ­£åœ¨ä¿å­˜ä¸­ï¼Œè¯·å‹¿é‡å¤ç‚¹å‡»");return}M.value&&await M.value.validate(async l=>{if(l)try{N.value=!0;let e;w.value?e=await Ue(s):e=await Ge(s),y.success(w.value?"è®¾å¤‡æ›´æ–°æˆåŠŸ":"è®¾å¤‡æ·»åŠ æˆåŠŸ"),b.value=!1,p()}catch(e){e.message&&e.message.includes("è®¾å¤‡ç¼–ç å·²å­˜åœ¨")?y.error(e.message):y.error(w.value?"è®¾å¤‡æ›´æ–°å¤±è´¥":"è®¾å¤‡æ·»åŠ å¤±è´¥")}finally{N.value=!1}})},ie=()=>{var l;Object.assign(s,{id:null,deviceName:"",deviceCode:"",productId:null,groupId:null,remark:""}),(l=M.value)==null||l.clearValidate()},de=l=>{S.value=l,i.value=1,p()},ce=l=>{i.value=l,p()};return Ve(()=>{p(),Z(),ee()}),(l,e)=>{const v=r("el-icon"),_=r("el-card"),C=r("el-input"),f=r("el-option"),z=r("el-select"),d=r("el-button"),m=r("el-table-column"),pe=r("el-tag"),ve=r("el-table"),me=r("el-pagination"),$=r("el-form-item"),ge=r("el-form"),fe=r("el-dialog"),_e=he("loading");return V(),F("div",je,[e[24]||(e[24]=u("h1",{class:"page-title"},"è®¾å¤‡ç®¡ç†",-1)),u("div",Ee,[t(_,{class:"tree-panel",shadow:"hover"},{header:o(()=>[...e[13]||(e[13]=[u("div",{style:{display:"flex","justify-content":"space-between","align-items":"center"}},[u("strong",{style:{"font-size":"15px"}},"è®¾å¤‡åˆ†ç»„")],-1)])]),default:o(()=>[u("div",{class:ke(["all-devices-btn",{active:g.value===null}]),onClick:le},[u("div",Re,[t(v,null,{default:o(()=>[t(U(xe))]),_:1}),e[14]||(e[14]=u("span",null,"å…¨éƒ¨è®¾å¤‡",-1))]),u("span",Ae,G(E.value),1)],2),t(Fe,{groups:P.value,"current-group-id":g.value,"show-actions":!1,"show-count":!1,onSelect:te},null,8,["groups","current-group-id"]),e[15]||(e[15]=u("div",{class:"tree-hint"}," ğŸ’¡ ç‚¹å‡»åˆ†ç»„æŸ¥çœ‹è¯¥åˆ†ç»„ä¸‹çš„è®¾å¤‡ ",-1))]),_:1}),t(_,{class:"device-panel",shadow:"hover"},{header:o(()=>[u("div",Oe,[u("h3",Ke,G(X.value),1),u("div",He,[t(C,{modelValue:h.value,"onUpdate:modelValue":e[0]||(e[0]=a=>h.value=a),placeholder:"ğŸ” æœç´¢è®¾å¤‡åç§°æˆ–ç¼–ç ",clearable:"",style:{width:"240px"},onKeyup:Se(A,["enter"])},null,8,["modelValue"]),t(z,{modelValue:k.value,"onUpdate:modelValue":e[1]||(e[1]=a=>k.value=a),placeholder:"è®¾å¤‡çŠ¶æ€",clearable:"",filterable:"",style:{width:"120px"}},{default:o(()=>[t(f,{label:"å…¨éƒ¨çŠ¶æ€",value:""}),t(f,{label:"åœ¨çº¿",value:"online"}),t(f,{label:"ç¦»çº¿",value:"offline"})]),_:1},8,["modelValue"]),t(z,{modelValue:x.value,"onUpdate:modelValue":e[2]||(e[2]=a=>x.value=a),placeholder:"äº§å“ç±»å‹",clearable:"",filterable:"",style:{width:"200px"},onVisibleChange:e[3]||(e[3]=a=>{a&&console.log("äº§å“ä¸‹æ‹‰æ¡†å±•å¼€ï¼ŒproductListé•¿åº¦:",D.value.length)})},{default:o(()=>[t(f,{label:"å…¨éƒ¨äº§å“",value:""}),(V(!0),F(K,null,H(D.value,a=>(V(),q(f,{key:a.id,label:R(a),value:a.id},null,8,["label","value"]))),128))]),_:1},8,["modelValue"]),t(d,{type:"primary",size:"default",onClick:A},{default:o(()=>[t(v,null,{default:o(()=>[t(U(Ie))]),_:1}),e[16]||(e[16]=c(" æŸ¥è¯¢ ",-1))]),_:1}),t(d,{size:"default",onClick:ae},{default:o(()=>[t(v,null,{default:o(()=>[t(U(De))]),_:1}),e[17]||(e[17]=c(" åˆ·æ–° ",-1))]),_:1}),t(d,{type:"primary",size:"default",onClick:oe},{default:o(()=>[t(v,null,{default:o(()=>[t(U(ze))]),_:1}),e[18]||(e[18]=c(" æ·»åŠ è®¾å¤‡ ",-1))]),_:1})])])]),default:o(()=>[$e((V(),q(ve,{data:I.value,stripe:"",style:{width:"100%"}},{default:o(()=>[t(m,{type:"index",label:"åºå·",width:"80",index:Y}),t(m,{prop:"deviceName",label:"è®¾å¤‡åç§°","min-width":"150"}),t(m,{prop:"deviceCode",label:"è®¾å¤‡ç¼–ç ","min-width":"150"}),t(m,{prop:"productName",label:"äº§å“ç±»å‹","min-width":"120"}),t(m,{prop:"productModel",label:"äº§å“å‹å·","min-width":"120"}),t(m,{prop:"groupName",label:"æ‰€å±åˆ†ç»„","min-width":"120"}),t(m,{prop:"status",label:"çŠ¶æ€",width:"100"},{default:o(({row:a})=>[t(pe,{type:a.status===1?"success":"info",size:"small"},{default:o(()=>[c(G(a.status===1?"åœ¨çº¿":"ç¦»çº¿"),1)]),_:2},1032,["type"])]),_:1}),t(m,{prop:"lastOnlineTime",label:"æœ€åä¸Šçº¿","min-width":"160"},{default:o(({row:a})=>[c(G(W(a.lastOnlineTime)),1)]),_:1}),t(m,{label:"æ“ä½œ",width:"240",fixed:"right"},{default:o(({row:a})=>[t(d,{size:"small",type:"primary",link:"",onClick:O=>ne(a)},{default:o(()=>[...e[19]||(e[19]=[c(" è¯¦æƒ… ",-1)])]),_:1},8,["onClick"]),t(d,{size:"small",type:"primary",link:"",onClick:O=>se(a)},{default:o(()=>[...e[20]||(e[20]=[c(" ç¼–è¾‘ ",-1)])]),_:1},8,["onClick"]),t(d,{size:"small",type:"danger",link:"",onClick:O=>re(a)},{default:o(()=>[...e[21]||(e[21]=[c(" åˆ é™¤ ",-1)])]),_:1},8,["onClick"])]),_:1})]),_:1},8,["data"])),[[_e,L.value]]),u("div",Je,[t(me,{"current-page":i.value,"onUpdate:currentPage":e[4]||(e[4]=a=>i.value=a),"page-size":S.value,"onUpdate:pageSize":e[5]||(e[5]=a=>S.value=a),"page-sizes":[10,20,50,100],total:j.value,layout:"total, sizes, prev, pager, next, jumper",onSizeChange:de,onCurrentChange:ce},null,8,["current-page","page-size","total"])])]),_:1})]),t(fe,{modelValue:b.value,"onUpdate:modelValue":e[12]||(e[12]=a=>b.value=a),title:B.value,width:"600px",onClose:ie},{footer:o(()=>[t(d,{onClick:e[11]||(e[11]=a=>b.value=!1)},{default:o(()=>[...e[22]||(e[22]=[c("å–æ¶ˆ",-1)])]),_:1}),t(d,{type:"primary",onClick:ue,loading:N.value},{default:o(()=>[...e[23]||(e[23]=[c("ç¡®å®š",-1)])]),_:1},8,["loading"])]),default:o(()=>[t(ge,{ref_key:"deviceFormRef",ref:M,model:s,rules:Q,"label-width":"100px"},{default:o(()=>[t($,{label:"è®¾å¤‡åç§°",prop:"deviceName"},{default:o(()=>[t(C,{modelValue:s.deviceName,"onUpdate:modelValue":e[6]||(e[6]=a=>s.deviceName=a),placeholder:"è¯·è¾“å…¥è®¾å¤‡åç§°"},null,8,["modelValue"])]),_:1}),t($,{label:"è®¾å¤‡ç¼–ç ",prop:"deviceCode"},{default:o(()=>[t(C,{modelValue:s.deviceCode,"onUpdate:modelValue":e[7]||(e[7]=a=>s.deviceCode=a),placeholder:"è¯·è¾“å…¥è®¾å¤‡ç¼–ç ",disabled:w.value},null,8,["modelValue","disabled"])]),_:1}),t($,{label:"äº§å“ç±»å‹",prop:"productId"},{default:o(()=>[t(z,{modelValue:s.productId,"onUpdate:modelValue":e[8]||(e[8]=a=>s.productId=a),placeholder:"è¯·é€‰æ‹©äº§å“ç±»å‹",filterable:"",style:{width:"100%"}},{default:o(()=>[(V(!0),F(K,null,H(D.value,a=>(V(),q(f,{key:a.id,label:R(a),value:a.id},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1}),t($,{label:"æ‰€å±åˆ†ç»„",prop:"groupId"},{default:o(()=>[t(qe,{ref_key:"groupSelectorRef",ref:T,modelValue:s.groupId,"onUpdate:modelValue":e[9]||(e[9]=a=>s.groupId=a)},null,8,["modelValue"])]),_:1}),t($,{label:"å¤‡æ³¨"},{default:o(()=>[t(C,{modelValue:s.remark,"onUpdate:modelValue":e[10]||(e[10]=a=>s.remark=a),type:"textarea",rows:3,placeholder:"è¯·è¾“å…¥å¤‡æ³¨ä¿¡æ¯"},null,8,["modelValue"])]),_:1})]),_:1},8,["model"])]),_:1},8,["modelValue","title"])])}}},al=ye(Qe,[["__scopeId","data-v-3567f83f"]]);export{al as default};
