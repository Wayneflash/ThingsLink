import{_ as J,u as K,r as _,z as W,c as u,o as w,d as x,e as d,g as l,w as t,E as m,i as b,U as X,q as s,t as P,T as N,F as R,k as j,M as G,D as Y,X as Z}from"./index-62e02c83.js";import{p as C}from"./index-4b76e424.js";const h={class:"toolbar"},ee={class:"input-hint"},le={class:"input-hint"},oe={class:"input-hint"},te={class:"input-hint"},re={class:"alert-title"},ae={__name:"ProductList",setup(se){const z=K(),i=_([]),k=_(""),c=_(!1),n=_(!1),T=_(null),r=_({id:null,productName:"",productModel:"",protocol:"MQTT",description:""}),B={productName:[{required:!0,message:"请输入产品名称",trigger:"blur"}],productModel:[{required:!0,message:"请输入产品型号",trigger:"blur"}],protocol:[{required:!0,message:"请选择协议类型",trigger:"change"}]},g=async()=>{try{console.log("开始加载产品列表...");const o=await C.getProductList();if(console.log("产品列表响应:",JSON.stringify(o,null,2)),!o){console.error("响应为空"),m.error("服务器无响应");return}o.list&&Array.isArray(o.list)?(console.log("使用 res.list，长度:",o.list.length),i.value=o.list):Array.isArray(o)?(console.log("使用 res，长度:",o.length),i.value=o):(console.warn("数据格式不正确:",typeof o),i.value=[]),console.log("最终 products.value:",i.value),console.log("产品数量:",i.value.length)}catch(o){console.error("加载产品列表失败:",o),console.error("错误堆栈:",o.stack),m.error("加载产品列表失败: "+o.message)}},D=()=>{const o=k.value.toLowerCase().trim();if(!o){g();return}i.value=i.value.filter(e=>e.productName&&e.productName.toLowerCase().includes(o)||e.productModel&&e.productModel.toLowerCase().includes(o))},L=()=>{n.value=!1,r.value={id:null,productName:"",productModel:"",protocol:"MQTT",description:""},c.value=!0},U=o=>{n.value=!0,r.value={id:o.id,productName:o.productName,productModel:o.productModel,protocol:o.protocol,description:o.description||""},c.value=!0},$=async()=>{if(T.value)try{if(await T.value.validate(),n.value){const o=await C.updateProduct({id:r.value.id,productName:r.value.productName,productModel:r.value.productModel,protocol:r.value.protocol,description:r.value.description});m.success("产品信息已更新"),c.value=!1,g()}else{const o=await C.createProduct({name:r.value.productName,code:r.value.productModel,protocol:r.value.protocol,description:r.value.description});m.success("产品创建成功！"),c.value=!1,o&&o.id?z.push(`/products/${o.id}`):g()}}catch(o){o!==!1&&(console.error("提交失败:",o),m.error(n.value?"更新产品失败":"创建产品失败"))}},F=o=>{z.push(`/products/${o.id}`)},S=async o=>{try{await Z.confirm(`确定要删除产品"${o.productName}"吗？

删除后该产品的所有属性和命令也将被删除，此操作不可恢复！`,"删除确认",{confirmButtonText:"确定删除",cancelButtonText:"取消",type:"warning"}),await C.deleteProduct(o.id),m.success("产品已删除"),g()}catch(e){e!=="cancel"&&(console.error("删除产品失败:",e),m.error("删除产品失败"))}};return W(()=>{g()}),(o,e)=>{const f=u("el-icon"),y=u("el-input"),v=u("el-button"),A=u("el-card"),p=u("el-table-column"),q=u("el-table"),M=u("el-form-item"),V=u("el-option"),I=u("el-select"),Q=u("el-form"),O=u("el-alert"),H=u("el-dialog");return w(),x("div",null,[e[25]||(e[25]=d("h1",{class:"page-title"},"产品管理",-1)),l(A,{class:"toolbar-card"},{default:t(()=>[d("div",h,[l(y,{modelValue:k.value,"onUpdate:modelValue":e[0]||(e[0]=a=>k.value=a),placeholder:"搜索产品名称或型号...",clearable:"",style:{width:"300px"},onInput:D},{prefix:t(()=>[l(f,null,{default:t(()=>[l(b(X))]),_:1})]),_:1},8,["modelValue"]),l(v,{type:"primary",onClick:L},{default:t(()=>[...e[7]||(e[7]=[s("+ 创建产品",-1)])]),_:1})])]),_:1}),l(A,null,{default:t(()=>[l(q,{data:i.value,border:"",stripe:""},{default:t(()=>[l(p,{prop:"id",label:"产品ID",width:"80"}),l(p,{prop:"productName",label:"产品名称"}),l(p,{prop:"productModel",label:"产品型号"}),l(p,{prop:"protocol",label:"协议类型"}),l(p,{label:"属性数量",width:"100",align:"center"},{default:t(({row:a})=>[s(P(a.attrCount||0)+" 个 ",1)]),_:1}),l(p,{label:"命令数量",width:"100",align:"center"},{default:t(({row:a})=>[s(P(a.cmdCount||0)+" 个 ",1)]),_:1}),l(p,{prop:"createTime",label:"创建时间",width:"180"}),l(p,{label:"操作",width:"280"},{default:t(({row:a})=>[l(v,{size:"small",type:"primary",onClick:E=>F(a)},{default:t(()=>[...e[8]||(e[8]=[s("查看详情",-1)])]),_:1},8,["onClick"]),l(v,{size:"small",onClick:E=>U(a)},{default:t(()=>[...e[9]||(e[9]=[s("编辑",-1)])]),_:1},8,["onClick"]),l(v,{size:"small",type:"danger",onClick:E=>S(a)},{default:t(()=>[...e[10]||(e[10]=[s("删除",-1)])]),_:1},8,["onClick"])]),_:1})]),_:1},8,["data"])]),_:1}),l(H,{modelValue:c.value,"onUpdate:modelValue":e[6]||(e[6]=a=>c.value=a),title:n.value?"编辑产品":"创建产品",width:"600px"},{footer:t(()=>[l(v,{onClick:e[5]||(e[5]=a=>c.value=!1)},{default:t(()=>[...e[24]||(e[24]=[s("取消",-1)])]),_:1}),l(v,{type:"primary",onClick:$},{default:t(()=>[s(P(n.value?"保存修改":"确定创建"),1)]),_:1})]),default:t(()=>[l(Q,{model:r.value,"label-width":"120px",rules:B,ref_key:"productFormRef",ref:T},{default:t(()=>[l(M,{label:"产品名称",prop:"productName"},{default:t(()=>[l(y,{modelValue:r.value.productName,"onUpdate:modelValue":e[1]||(e[1]=a=>r.value.productName=a),placeholder:"如：智能水表、空气监测仪、温湿度传感器"},null,8,["modelValue"]),d("div",ee,[l(f,{class:"hint-icon",size:14},{default:t(()=>[l(b(N))]),_:1}),e[11]||(e[11]=s(" 给产品起一个清晰易懂的名称，方便后续管理 ",-1))])]),_:1}),l(M,{label:"产品型号",prop:"productModel"},{default:t(()=>[l(y,{modelValue:r.value.productModel,"onUpdate:modelValue":e[2]||(e[2]=a=>r.value.productModel=a),placeholder:"如：WATER-PRO、AIR-01、TEM-SENSOR",disabled:n.value},null,8,["modelValue","disabled"]),d("div",le,[l(f,{class:"hint-icon",size:14},{default:t(()=>[l(b(N))]),_:1}),n.value?(w(),x(R,{key:1},[s("产品型号创建后不可修改")],64)):(w(),x(R,{key:0},[s("产品型号是唯一标识，建议使用英文+数字组合，创建后不可修改")],64))])]),_:1}),l(M,{label:"协议类型",prop:"protocol"},{default:t(()=>[l(I,{modelValue:r.value.protocol,"onUpdate:modelValue":e[3]||(e[3]=a=>r.value.protocol=a),placeholder:"请选择协议类型",style:{width:"100%"}},{default:t(()=>[l(V,{label:"MQTT（推荐，轻量级物联网协议）",value:"MQTT"}),l(V,{label:"HTTP（适合请求-响应场景）",value:"HTTP"}),l(V,{label:"CoAP（适合资源受限设备）",value:"CoAP"}),l(V,{label:"Modbus（工业设备常用）",value:"Modbus"})]),_:1},8,["modelValue"]),d("div",oe,[l(f,{class:"hint-icon",size:14},{default:t(()=>[l(b(N))]),_:1}),e[12]||(e[12]=s(" 选择设备使用的通信协议，影响设备接入方式 ",-1))])]),_:1}),l(M,{label:"产品描述",prop:"description"},{default:t(()=>[l(y,{modelValue:r.value.description,"onUpdate:modelValue":e[4]||(e[4]=a=>r.value.description=a),type:"textarea",rows:4,placeholder:"描述产品的功能、用途、适用场景等..."},null,8,["modelValue"]),d("div",te,[l(f,{class:"hint-icon",size:14},{default:t(()=>[l(b(N))]),_:1}),e[13]||(e[13]=s(" 详细描述有助于团队成员理解产品定位 ",-1))])]),_:1})]),_:1},8,["model"]),n.value?Y("",!0):(w(),j(O,{key:0,type:"info",closable:!1,style:{"margin-bottom":"20px"}},{title:t(()=>[d("div",re,[l(f,{class:"alert-icon",size:16},{default:t(()=>[l(b(G))]),_:1}),e[14]||(e[14]=s(" 下一步操作 ",-1))])]),default:t(()=>[e[15]||(e[15]=s(' 创建产品后，点击"查看详情"跳转到详情页，添加"属性"和"命令"来完整定义设备的物模型：',-1)),e[16]||(e[16]=d("br",null,null,-1)),e[17]||(e[17]=s(" • ",-1)),e[18]||(e[18]=d("strong",null,"属性",-1)),e[19]||(e[19]=s("：设备上报的数据字段（如温度、湿度、电量）",-1)),e[20]||(e[20]=d("br",null,null,-1)),e[21]||(e[21]=s(" • ",-1)),e[22]||(e[22]=d("strong",null,"命令",-1)),e[23]||(e[23]=s("：平台下发给设备的控制指令（如开关、设置参数） ",-1))]),_:1}))]),_:1},8,["modelValue","title"])])}}},ne=J(ae,[["__scopeId","data-v-becc21e4"]]);export{ne as default};
