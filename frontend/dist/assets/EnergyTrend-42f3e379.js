import{_ as P,r as f,b as Z,O as J,z as K,A as X,c as p,B as ee,o as _,d as E,e as s,g as a,w as o,k as S,D as Y,E as T,I as G,C as te,i as b,S as ae,T as le,F as oe,f as se,U as re,q as C,V as ne,t as M,G as ie}from"./index-84c82c57.js";import{a as de}from"./energy-b6378c29.js";import{g as ce}from"./device-1b039595.js";import{f as ue,G as pe}from"./GroupTree-6fc1dd10.js";import{g as me}from"./group-bdbfd9b3.js";import{i as fe}from"./index-18acf776.js";const ge={class:"energy-trend-page min-h-screen bg-gray-50"},ye={class:"energy-container"},ve={class:"btn-left"},_e={class:"tree-hint"},he={class:"content-panel"},be={class:"flex items-center justify-between"},we={class:"text-lg font-semibold text-gray-900"},xe={class:"flex items-center gap-2"},Se={__name:"EnergyTrend",setup(Te){const h=f(!1),w=f(!1),k=f(!1),l=Z({energyType:"electric",deviceId:null,groupId:null,dateFormat:"day"}),z=f([]),N=e=>{l.groupId=e,v()},H=()=>{l.groupId=null,v()},U=async()=>{try{const e=await me();e.tree&&(z.value=ue(e.tree))}catch(e){console.error("加载分组列表失败:",e)}},m=f([]),D=f([]),n=f([]),x=f(null);let r=null;const B=e=>({electric:"电力",water:"水耗",gas:"气耗"})[e]||"能源",V=e=>({electric:"kWh",water:"m³",gas:"m³"})[e]||"",A=async()=>{try{const e=await ce({page:1,pageSize:1e3});e&&e.list&&(D.value=e.list)}catch(e){console.error("加载设备列表失败:",e)}},v=async()=>{if(!l.energyType){T.warning("请选择能源类型");return}if(!m.value||m.value.length!==2){T.warning("请选择时间范围");return}h.value=!0,w.value=!0,k.value=!0;try{const e={energyType:l.energyType,startTime:m.value[0],endTime:m.value[1],deviceId:l.deviceId||null,groupId:l.groupId||null,dateFormat:l.dateFormat||"day"},t=await de(e);n.value=t||[],await G(),I()}catch(e){console.error("查询能耗趋势失败:",e),T.error(e.message||"查询失败，请稍后重试"),n.value=[]}finally{h.value=!1,w.value=!1}},I=()=>{var i;if(!x.value||n.value.length===0)return;r&&(r.dispose(),r=null),r=fe(x.value);const e=n.value.map(d=>d.timeLabel),t=n.value.map(d=>d.consumption),g=((i=n.value[0])==null?void 0:i.unit)||V(l.energyType),y={tooltip:{trigger:"axis",backgroundColor:"rgba(50, 50, 50, 0.9)",borderColor:"transparent",borderWidth:0,padding:[12,16],textStyle:{color:"#fff",fontSize:13},formatter:d=>{const c=d[0];return`${c.axisValue}<br/>${c.seriesName}: ${Number(c.value).toFixed(2)} ${g}`}},grid:{left:"3%",right:"4%",bottom:"10%",top:"10%",containLabel:!0},xAxis:{type:"category",boundaryGap:!1,data:e,axisLine:{lineStyle:{color:"#e0e0e0"}},axisLabel:{color:"#6b7280",fontSize:12,rotate:l.dateFormat==="day"?0:45},splitLine:{show:!1}},yAxis:{type:"value",name:`能耗 (${g})`,nameTextStyle:{color:"#6b7280",fontSize:12},axisLine:{show:!1},axisTick:{show:!1},axisLabel:{color:"#6b7280",fontSize:12},splitLine:{lineStyle:{color:"#f0f0f0",type:"dashed"}}},series:[{name:"能耗",type:"line",smooth:!0,data:t,areaStyle:{color:{type:"linear",x:0,y:0,x2:0,y2:1,colorStops:[{offset:0,color:"rgba(102, 126, 234, 0.3)"},{offset:1,color:"rgba(102, 126, 234, 0.05)"}]}},lineStyle:{color:"#667eea",width:3},itemStyle:{color:"#667eea"},symbol:"circle",symbolSize:6,emphasis:{focus:"series",itemStyle:{color:"#667eea",borderColor:"#fff",borderWidth:2}}}],dataZoom:[{type:"inside",start:0,end:100},{type:"slider",start:0,end:100,height:24,bottom:8,borderColor:"#e0e0e0",fillerColor:"rgba(102, 126, 234, 0.2)",handleStyle:{color:"#667eea"}}]};r.setOption(y,!0)},R=()=>{l.energyType="electric",l.deviceId=null,l.groupId=null,l.dateFormat="day",m.value=[],n.value=[],r&&(r.dispose(),r=null)},L=e=>{const t=e.getFullYear(),g=String(e.getMonth()+1).padStart(2,"0"),y=String(e.getDate()).padStart(2,"0"),i=String(e.getHours()).padStart(2,"0"),d=String(e.getMinutes()).padStart(2,"0"),c=String(e.getSeconds()).padStart(2,"0");return`${t}-${g}-${y} ${i}:${d}:${c}`},F=()=>{r&&r.resize()};return J(()=>n.value,()=>{n.value.length>0&&G(()=>{I()})},{deep:!0}),K(async()=>{const e=new Date,t=new Date;t.setDate(t.getDate()-30),t.setHours(0,0,0,0),e.setHours(23,59,59,999),m.value=[L(t),L(e)],await Promise.all([A(),U()]),await v(),window.addEventListener("resize",F)}),X(()=>{r&&(r.dispose(),r=null),window.removeEventListener("resize",F)}),(e,t)=>{const g=p("el-icon"),y=p("el-card"),i=p("el-option"),d=p("el-select"),c=p("el-form-item"),Q=p("el-date-picker"),$=p("el-button"),W=p("el-form"),j=p("el-tag"),q=p("el-empty"),O=ee("loading");return _(),E("div",ge,[t[9]||(t[9]=s("div",{class:"page-header bg-white shadow-sm mb-6 px-6 py-4"},[s("h1",{class:"text-2xl font-semibold text-gray-900 mb-2"},"能耗趋势"),s("p",{class:"text-sm text-gray-600"},"支持电、水、气三种能源类型的能耗趋势分析")],-1)),s("div",ye,[a(y,{class:"tree-panel",shadow:"hover"},{header:o(()=>[...t[4]||(t[4]=[s("div",{style:{display:"flex","justify-content":"space-between","align-items":"center"}},[s("strong",{style:{"font-size":"15px"}},"设备分组")],-1)])]),default:o(()=>[s("div",{class:te(["all-groups-btn",{active:l.groupId===null}]),onClick:H},[s("div",ve,[a(g,null,{default:o(()=>[a(b(ae))]),_:1}),t[5]||(t[5]=s("span",null,"全部分组",-1))])],2),a(pe,{groups:z.value,"current-group-id":l.groupId,"show-actions":!1,"show-count":!1,onSelect:N},null,8,["groups","current-group-id"]),s("div",_e,[a(g,{size:14,class:"hint-icon"},{default:o(()=>[a(b(le))]),_:1}),t[6]||(t[6]=s("span",null,"点击分组查看该分组下的能耗数据",-1))])]),_:1}),s("div",he,[a(y,{class:"filter-card mb-6 shadow-sm",shadow:"hover"},{default:o(()=>[a(W,{model:l,inline:"",class:"filter-form"},{default:o(()=>[a(c,{label:"能源类型"},{default:o(()=>[a(d,{modelValue:l.energyType,"onUpdate:modelValue":t[0]||(t[0]=u=>l.energyType=u),placeholder:"能源类型",class:"filter-select",onChange:v},{default:o(()=>[a(i,{label:"电力",value:"electric"}),a(i,{label:"水耗",value:"water"}),a(i,{label:"气耗",value:"gas"})]),_:1},8,["modelValue"])]),_:1}),a(c,{label:"时间范围"},{default:o(()=>[a(Q,{modelValue:m.value,"onUpdate:modelValue":t[1]||(t[1]=u=>m.value=u),type:"datetimerange","range-separator":"至","start-placeholder":"开始","end-placeholder":"结束",format:"YYYY-MM-DD HH:mm:ss","value-format":"YYYY-MM-DD HH:mm:ss",class:"filter-datepicker"},null,8,["modelValue"])]),_:1}),a(c,{label:"设备"},{default:o(()=>[a(d,{modelValue:l.deviceId,"onUpdate:modelValue":t[2]||(t[2]=u=>l.deviceId=u),placeholder:"全部设备",filterable:"",clearable:"",class:"filter-select"},{default:o(()=>[(_(!0),E(oe,null,se(D.value,u=>(_(),S(i,{key:u.id,label:u.deviceName,value:u.id},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1}),a(c,{label:"时间粒度"},{default:o(()=>[a(d,{modelValue:l.dateFormat,"onUpdate:modelValue":t[3]||(t[3]=u=>l.dateFormat=u),placeholder:"粒度",class:"filter-select-small",onChange:v},{default:o(()=>[a(i,{label:"按天",value:"day"}),a(i,{label:"按小时",value:"hour"})]),_:1},8,["modelValue"])]),_:1}),a(c,{class:"filter-buttons"},{default:o(()=>[a($,{type:"primary",onClick:v,icon:b(re),loading:h.value,size:"default"},{default:o(()=>[...t[7]||(t[7]=[C(" 查询 ",-1)])]),_:1},8,["icon","loading"]),a($,{onClick:R,icon:b(ne),size:"default"},{default:o(()=>[...t[8]||(t[8]=[C(" 重置 ",-1)])]),_:1},8,["icon"])]),_:1})]),_:1},8,["model"])]),_:1}),n.value.length>0?(_(),S(y,{key:0,class:"chart-card shadow-sm mb-6",shadow:"hover"},{header:o(()=>[s("div",be,[s("span",we,M(B(l.energyType))+"趋势分析 ",1),s("div",xe,[a(j,{size:"small",type:"info"},{default:o(()=>[C(M(V(l.energyType)),1)]),_:1})])])]),default:o(()=>[ie(s("div",{ref_key:"trendChartRef",ref:x,class:"chart-container"},null,512),[[O,w.value]])]),_:1})):Y("",!0),!h.value&&k.value&&n.value.length===0?(_(),S(q,{key:1,description:"暂无数据","image-size":120})):Y("",!0)])])])}}},Le=P(Se,[["__scopeId","data-v-d743d168"]]);export{Le as default};
