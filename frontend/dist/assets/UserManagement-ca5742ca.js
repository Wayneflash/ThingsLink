import{_ as _e,b as i,s as N,c as we,v as be,d,y as Ie,o as f,e as D,f as n,g as a,w as o,D as xe,z as F,i as A,n as he,t as V,I,L as j,q as m,B as Ve,F as J,A as Ue,C as Ce,M as H,E as v}from"./index-d25c41ea.js";import{g as Ne}from"./group-a2fe2bd7.js";import{g as Q,u as Se,d as ke,a as Te,c as ze}from"./user-b40b7fed.js";import{g as $e}from"./role-cab68442.js";import{f as Be,G as Ge}from"./GroupTree-8e23dc37.js";import{G as Me}from"./GroupSelector-9b63f6bd.js";const Re={class:"user-management-page"},De={class:"user-container"},Ae={class:"btn-left"},Le={class:"user-count"},Ee={style:{display:"flex","justify-content":"space-between","align-items":"center",gap:"20px"}},Oe={style:{margin:"0","font-size":"16px"}},qe={style:{display:"flex",gap:"16px"}},Fe={__name:"UserManagement",setup(je){const z=i(!1),w=i(!1),$=i("åˆ›å»ºç”¨æˆ·"),U=i(!1),B=i(null),S=i(null),x=i(""),u=i(null);i(!1);const G=i(null),L=N(()=>G.value?G.value.roleId===1:!1),y=i([]),C=i([]),M=i(0),k=i([]),t=we({id:null,username:"",realName:"",phone:"",email:"",password:"",groupId:null,roleId:null,status:1}),K={username:[{required:!0,message:"è¯·è¾“å…¥ç”¨æˆ·å",trigger:"blur"},{min:3,max:20,message:"ç”¨æˆ·åé•¿åº¦åœ¨ 3 åˆ° 20 ä¸ªå­—ç¬¦",trigger:"blur"}],realName:[{required:!0,message:"å§“åä¸èƒ½ä¸ºç©º",trigger:"blur"},{min:2,max:20,message:"å§“åé•¿åº¦åœ¨ 2 åˆ° 20 ä¸ªå­—ç¬¦",trigger:"blur"}],phone:[{validator:(l,e,r)=>{e?/^1[3-9]\d{9}$/.test(e)?r():r(new Error("è¯·è¾“å…¥æ­£ç¡®çš„æ‰‹æœºå·ç ")):r()},trigger:"blur"}],email:[{validator:(l,e,r)=>{e?/^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(e)?r():r(new Error("è¯·è¾“å…¥æ­£ç¡®çš„é‚®ç®±åœ°å€")):r()},trigger:"blur"}],password:[{required:!0,message:"è¯·è¾“å…¥å¯†ç ",trigger:"blur"},{min:6,message:"å¯†ç é•¿åº¦è‡³å°‘ 6 ä¸ªå­—ç¬¦",trigger:"blur"}],groupId:[{required:!0,message:"è¯·é€‰æ‹©æ‰€å±åˆ†ç»„",trigger:"change"}],roleId:[{required:!0,message:"è¯·é€‰æ‹©è§’è‰²",trigger:"change"}]},P=N(()=>{if(!u.value)return`å…¨éƒ¨ç”¨æˆ· (${R.value.length}äºº)`;const l=y.value.find(e=>e.id===u.value);if(l){const e=R.value.length;return`${l.name} (${e}äºº)`}return"è¯·é€‰æ‹©åˆ†ç»„"}),R=N(()=>{let l=C.value;return x.value&&(l=l.filter(r=>r.username.toLowerCase().includes(x.value.toLowerCase())||r.realName.toLowerCase().includes(x.value.toLowerCase()))),l.map(r=>{const _=y.value.find(p=>p.id===r.groupId),c=_?_.name:"æœªçŸ¥åˆ†ç»„";return{...r,groupName:c}}).sort((r,_)=>{if(r.username==="admin")return-1;if(_.username==="admin")return 1;const c=new Date(r.createTime||0).getTime();return new Date(_.createTime||0).getTime()-c})}),W=l=>l+1,X=()=>{u.value=null,console.log("é€‰ä¸­å…¨éƒ¨ç”¨æˆ·"),h()},Y=l=>{u.value=l,console.log("é€‰ä¸­åˆ†ç»„:",l),x.value="",h()},Z=()=>{},ee=l=>{const e=k.value.find(r=>r.id===l);return e!=null&&e.isSuperAdmin?"danger":"info"},T=N(()=>{const l=k.value.find(e=>e.id===t.roleId);return(l==null?void 0:l.isSuperAdmin)||!1}),le=N(()=>T.value?"ğŸ”’ è¶…çº§ç®¡ç†å‘˜è‡ªåŠ¨å½’å±æœ€é¡¶çº§åˆ†ç»„ï¼Œæ‹¥æœ‰å…¨å±€æ•°æ®æƒé™":"ğŸ’¡ å†³å®šç”¨æˆ·èƒ½çœ‹åˆ°å“ªäº›è®¾å¤‡æ•°æ®ï¼Œç”¨æˆ·å¯æŸ¥çœ‹æ‰€å±åˆ†ç»„åŠå…¶å­åˆ†ç»„çš„è®¾å¤‡"),te=()=>{if(T.value){const l=y.value.find(e=>e.parentId===0||e.parentId===null);t.groupId=l?l.id:null}},ae=()=>{if($.value="åˆ›å»ºç”¨æˆ·",U.value=!1,t.id=null,t.username="",t.realName="",t.phone="",t.email="",t.password="",u.value)t.groupId=u.value;else{const l=y.value.find(e=>e.parentId===0||e.parentId===null);t.groupId=l?l.id:null}t.roleId=null,t.status=1,w.value=!0},oe=async()=>{await xe(),S.value&&S.value.groupsData.length===0&&await S.value.loadGroups()},se=l=>{$.value="ç¼–è¾‘ç”¨æˆ·",U.value=!0,Object.assign(t,{id:l.id,username:l.username,realName:l.realName,phone:l.phone||"",email:l.email||"",groupId:l.groupId,roleId:l.roleId,status:l.status}),w.value=!0},re=async l=>{const e=l.status===1?"ç¦ç”¨":"å¯ç”¨";await H.confirm(`ç¡®å®šè¦${e}ç”¨æˆ·â€œ${l.realName}â€å—ï¼Ÿ`,`${e}ç¡®è®¤`,{confirmButtonText:"ç¡®å®š",cancelButtonText:"å–æ¶ˆ",type:"warning"});try{const r=l.status===1?0:1;await Se({id:l.id,status:r}),l.status=r,v.success(`å·²${e}ç”¨æˆ·`)}catch(r){v.error(r.message||`${e}å¤±è´¥`)}},ne=async l=>{await H.confirm(`ç¡®å®šè¦åˆ é™¤ç”¨æˆ·â€œ${l.realName}â€å—ï¼Ÿ`,"åˆ é™¤ç¡®è®¤",{confirmButtonText:"ç¡®å®š",cancelButtonText:"å–æ¶ˆ",type:"warning"});try{await ke(l.id),await h(),v.success("ç”¨æˆ·åˆ é™¤æˆåŠŸ")}catch(e){v.error(e.message||"åˆ é™¤å¤±è´¥")}},ue=async()=>{if(B.value){console.log("å½“å‰è¡¨å•æ•°æ®:",JSON.parse(JSON.stringify(t)));try{const l=await B.value.validate();console.log("éªŒè¯ç»“æœ:",l),l&&(U.value?(await Te({id:t.id,realname:t.realName,phone:t.phone,email:t.email,groupId:t.groupId,roleId:t.roleId,status:t.status}),w.value=!1,await h(),v.success("ç”¨æˆ·æ›´æ–°æˆåŠŸ")):(await ze({username:t.username,password:t.password,realname:t.realName,phone:t.phone,email:t.email,groupId:t.groupId,roleId:t.roleId,status:t.status}),w.value=!1,await h(),v.success("ç”¨æˆ·åˆ›å»ºæˆåŠŸ")))}catch(l){if(console.error("éªŒè¯æˆ–æäº¤é”™è¯¯:",l),l!=null&&l.message)v.error(l.message);else if(typeof l=="object"){const e=Object.keys(l)[0];if(console.log("é”™è¯¯å­—æ®µ:",e,l[e]),e&&l[e]){const r=l[e][0];r!=null&&r.message&&v.error(r.message)}}else v.error("æ“ä½œå¤±è´¥")}}},h=async()=>{try{z.value=!0,console.log("loadUsers è¢«è°ƒç”¨, currentGroupId:",u.value);const l={page:1,pageSize:1e3};u.value?(l.groupId=u.value,console.log("æŸ¥è¯¢æŒ‡å®šåˆ†ç»„çš„ç”¨æˆ·, groupId:",u.value)):console.log("æŸ¥è¯¢å…¨éƒ¨ç”¨æˆ·");const e=await Q(l);console.log("ç”¨æˆ·åˆ—è¡¨å“åº”:",e),C.value=e.list||[],console.log("ç”¨æˆ·æ•°é‡:",C.value.length),u.value||(M.value=e.total||C.value.length)}catch(l){console.error("åŠ è½½ç”¨æˆ·å¤±è´¥:",l),C.value=[]}finally{z.value=!1}},ie=async()=>{try{const l=await Ne();y.value=Be(l.tree||[]),y.value.length>0&&!u.value&&(u.value=y.value[0].id),await de()}catch(l){console.error("åŠ è½½åˆ†ç»„å¤±è´¥:",l)}},de=async()=>{try{const l=await Q({page:1,pageSize:1});M.value=l.total||0}catch(l){console.error("åŠ è½½æ€»ç”¨æˆ·æ•°å¤±è´¥:",l)}},pe=async()=>{try{const l=await $e({page:1,pageSize:100});k.value=(l.list||[]).map(e=>({id:e.id,name:e.name,isSuperAdmin:e.roleCode==="super_admin"||e.code==="super_admin"}))}catch(l){console.error("åŠ è½½è§’è‰²åˆ—è¡¨å¤±è´¥:",l)}};return be(async()=>{const l=localStorage.getItem("userInfo");l&&(G.value=JSON.parse(l)),await pe(),ie(),h()}),(l,e)=>{const r=d("el-icon"),_=d("el-card"),c=d("el-input"),p=d("el-button"),E=d("el-tooltip"),g=d("el-table-column"),O=d("el-tag"),me=d("el-table"),b=d("el-form-item"),ce=d("el-option"),fe=d("el-select"),ge=d("el-form"),ve=d("el-dialog"),ye=Ie("loading");return f(),D("div",Re,[e[27]||(e[27]=n("h1",{class:"page-title"},"ç”¨æˆ·ç®¡ç†",-1)),n("div",De,[a(_,{class:"tree-panel",shadow:"hover"},{header:o(()=>[...e[10]||(e[10]=[n("div",{style:{display:"flex","justify-content":"space-between","align-items":"center"}},[n("strong",{style:{"font-size":"15px"}},"è®¾å¤‡åˆ†ç»„")],-1)])]),default:o(()=>[n("div",{class:F(["all-users-btn",{active:u.value===null}]),onClick:X},[n("div",Ae,[a(r,null,{default:o(()=>[a(A(he))]),_:1}),e[11]||(e[11]=n("span",null,"å…¨éƒ¨ç”¨æˆ·",-1))]),n("span",Le,V(M.value),1)],2),a(Ge,{groups:y.value,"current-group-id":u.value,"show-actions":!1,"show-count":!1,onSelect:Y},null,8,["groups","current-group-id"]),e[12]||(e[12]=n("div",{class:"tree-hint"}," ğŸ’¡ ç‚¹å‡»åˆ†ç»„æŸ¥çœ‹è¯¥åˆ†ç»„ä¸‹çš„ç”¨æˆ· ",-1))]),_:1}),a(_,{class:"user-panel",shadow:"hover"},{header:o(()=>[n("div",Ee,[n("h3",Oe,V(P.value),1),n("div",qe,[a(c,{modelValue:x.value,"onUpdate:modelValue":e[0]||(e[0]=s=>x.value=s),placeholder:"ğŸ” æœç´¢ç”¨æˆ·åæˆ–å§“å",clearable:"",style:{width:"240px"},onInput:Z},null,8,["modelValue"]),L.value?(f(),I(p,{key:0,type:"primary",size:"default",onClick:ae},{default:o(()=>[a(r,null,{default:o(()=>[a(A(j))]),_:1}),e[13]||(e[13]=m(" åˆ›å»ºç”¨æˆ· ",-1))]),_:1})):(f(),I(E,{key:1,content:"åªæœ‰è¶…çº§ç®¡ç†å‘˜æ‰èƒ½åˆ›å»ºç”¨æˆ·",placement:"top"},{default:o(()=>[a(p,{type:"primary",size:"default",disabled:""},{default:o(()=>[a(r,null,{default:o(()=>[a(A(j))]),_:1}),e[14]||(e[14]=m(" åˆ›å»ºç”¨æˆ· ",-1))]),_:1})]),_:1}))])])]),default:o(()=>[Ve((f(),I(me,{data:R.value,stripe:""},{default:o(()=>[a(g,{type:"index",label:"åºå·",width:"80",index:W}),a(g,{prop:"username",label:"ç”¨æˆ·å","min-width":"120"}),a(g,{prop:"realName",label:"å§“å","min-width":"120"}),a(g,{prop:"phone",label:"æ‰‹æœºå·ç ","min-width":"130"}),a(g,{prop:"email",label:"é‚®ç®±","min-width":"180"}),a(g,{prop:"groupName",label:"æ‰€å±åˆ†ç»„","min-width":"120"}),a(g,{prop:"roleName",label:"è§’è‰²","min-width":"120"},{default:o(({row:s})=>[a(O,{type:ee(s.roleId),size:"small"},{default:o(()=>[m(V(s.roleName),1)]),_:2},1032,["type"])]),_:1}),a(g,{prop:"status",label:"çŠ¶æ€",width:"100"},{default:o(({row:s})=>[a(O,{type:s.status===1?"success":"warning",size:"small"},{default:o(()=>[m(V(s.status===1?"å¯ç”¨":"ç¦ç”¨"),1)]),_:2},1032,["type"])]),_:1}),a(g,{label:"æ“ä½œ",width:"200",fixed:"right"},{default:o(({row:s})=>[s.isSuper?(f(),I(p,{key:0,size:"small",text:"",disabled:"",style:{opacity:"0.5"}},{default:o(()=>[...e[15]||(e[15]=[m("ä¸å¯æ“ä½œ",-1)])]),_:1})):L.value?(f(),D(J,{key:2},[a(p,{size:"small",text:"",onClick:q=>se(s)},{default:o(()=>[...e[17]||(e[17]=[m("ç¼–è¾‘",-1)])]),_:1},8,["onClick"]),a(p,{size:"small",text:"",type:"warning",onClick:q=>re(s)},{default:o(()=>[m(V(s.status===1?"ç¦ç”¨":"å¯ç”¨"),1)]),_:2},1032,["onClick"]),a(p,{size:"small",text:"",type:"danger",onClick:q=>ne(s)},{default:o(()=>[...e[18]||(e[18]=[m(" åˆ é™¤ ",-1)])]),_:1},8,["onClick"])],64)):(f(),I(E,{key:1,content:"åªæœ‰è¶…çº§ç®¡ç†å‘˜æ‰èƒ½ç®¡ç†ç”¨æˆ·",placement:"top"},{default:o(()=>[a(p,{size:"small",text:"",disabled:"",style:{opacity:"0.5"}},{default:o(()=>[...e[16]||(e[16]=[m("ç¼–è¾‘",-1)])]),_:1})]),_:1}))]),_:1})]),_:1},8,["data"])),[[ye,z.value]])]),_:1})]),a(ve,{modelValue:w.value,"onUpdate:modelValue":e[9]||(e[9]=s=>w.value=s),title:$.value,width:"500px",onOpened:oe},{footer:o(()=>[a(p,{onClick:e[8]||(e[8]=s=>w.value=!1)},{default:o(()=>[...e[25]||(e[25]=[m("å–æ¶ˆ",-1)])]),_:1}),a(p,{type:"primary",onClick:ue},{default:o(()=>[...e[26]||(e[26]=[m("ç¡®å®š",-1)])]),_:1})]),default:o(()=>[a(ge,{ref_key:"userFormRef",ref:B,model:t,rules:K,"label-width":"100px"},{default:o(()=>[a(b,{label:"ç”¨æˆ·å",prop:"username"},{default:o(()=>[a(c,{modelValue:t.username,"onUpdate:modelValue":e[1]||(e[1]=s=>t.username=s),placeholder:"å¦‚ï¼šzhangsanã€lisi",disabled:U.value,autocomplete:"off"},null,8,["modelValue","disabled"]),e[19]||(e[19]=n("div",{class:"form-hint"},"ğŸ’¡ ç”¨äºç™»å½•çš„è´¦å·ï¼Œå»ºè®®ä½¿ç”¨è‹±æ–‡ï¼Œåˆ›å»ºåä¸å¯ä¿®æ”¹",-1))]),_:1}),U.value?Ue("",!0):(f(),I(b,{key:0,label:"å¯†ç ",prop:"password"},{default:o(()=>[a(c,{modelValue:t.password,"onUpdate:modelValue":e[2]||(e[2]=s=>t.password=s),type:"password",placeholder:"è¯·è¾“å…¥å¯†ç ","show-password":"",autocomplete:"new-password"},null,8,["modelValue"]),e[20]||(e[20]=n("div",{class:"form-hint"},"ğŸ’¡ å¯†ç å°†é‡‡ç”¨ BCrypt åŠ å¯†å­˜å‚¨ï¼Œå»ºè®® 6 ä½ä»¥ä¸Š",-1))]),_:1})),a(b,{label:"å§“å",prop:"realName"},{default:o(()=>[a(c,{modelValue:t.realName,"onUpdate:modelValue":e[3]||(e[3]=s=>t.realName=s),modelModifiers:{trim:!0},placeholder:"å¦‚ï¼šå¼ ä¸‰ã€æå››",autocomplete:"off",clearable:""},null,8,["modelValue"]),e[21]||(e[21]=n("div",{class:"form-hint"},"ğŸ’¡ ç”¨æˆ·çš„çœŸå®å§“åï¼Œç”¨äºæ˜¾ç¤ºå’Œè¯†åˆ«",-1))]),_:1}),a(b,{label:"æ‰€å±åˆ†ç»„",prop:"groupId"},{default:o(()=>[a(Me,{ref_key:"groupSelectorRef",ref:S,modelValue:t.groupId,"onUpdate:modelValue":e[4]||(e[4]=s=>t.groupId=s),disabled:T.value},null,8,["modelValue","disabled"]),n("div",{class:F(["form-hint",{"hint-super":T.value}])},V(le.value),3)]),_:1}),a(b,{label:"è§’è‰²",prop:"roleId"},{default:o(()=>[a(fe,{modelValue:t.roleId,"onUpdate:modelValue":e[5]||(e[5]=s=>t.roleId=s),placeholder:"è¯·é€‰æ‹©è§’è‰²",style:{width:"100%"},onChange:te},{default:o(()=>[(f(!0),D(J,null,Ce(k.value,s=>(f(),I(ce,{key:s.id,label:s.name,value:s.id},null,8,["label","value"]))),128))]),_:1},8,["modelValue"]),e[22]||(e[22]=n("div",{class:"form-hint"},"ğŸ’¡ é€‰æ‹©ç”¨æˆ·çš„è§’è‰²ï¼Œè§’è‰²å†³å®šäº†ç”¨æˆ·çš„èœå•æƒé™",-1))]),_:1}),a(b,{label:"æ‰‹æœºå·ç ",prop:"phone"},{default:o(()=>[a(c,{modelValue:t.phone,"onUpdate:modelValue":e[6]||(e[6]=s=>t.phone=s),modelModifiers:{trim:!0},placeholder:"è¯·è¾“å…¥æ‰‹æœºå·ç ",autocomplete:"tel",clearable:"",maxlength:"11"},null,8,["modelValue"]),e[23]||(e[23]=n("div",{class:"form-hint"},"ğŸ’¡ ç”¨äºçŸ­ä¿¡æ¨é€é€šçŸ¥ï¼Œè¯·å¡«å†™çœŸå®æœ‰æ•ˆçš„æ‰‹æœºå·ç ",-1))]),_:1}),a(b,{label:"é‚®ç®±",prop:"email"},{default:o(()=>[a(c,{modelValue:t.email,"onUpdate:modelValue":e[7]||(e[7]=s=>t.email=s),modelModifiers:{trim:!0},placeholder:"è¯·è¾“å…¥é‚®ç®±åœ°å€",autocomplete:"email",clearable:""},null,8,["modelValue"]),e[24]||(e[24]=n("div",{class:"form-hint"},"ğŸ’¡ ç”¨äºé‚®ä»¶æ¨é€é€šçŸ¥ï¼Œè¯·å¡«å†™çœŸå®æœ‰æ•ˆçš„é‚®ç®±åœ°å€",-1))]),_:1})]),_:1},8,["model"])]),_:1},8,["modelValue","title"])])}}},Xe=_e(Fe,[["__scopeId","data-v-a9067381"]]);export{Xe as default};
