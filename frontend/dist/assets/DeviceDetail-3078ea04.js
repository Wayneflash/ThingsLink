import{a2 as ve,_ as Me,a as Pe,u as qe,Y as K,a7 as he,Z as _e,r as z,a0 as Ne,o as u,c as v,b as t,e as s,w as r,t as m,B as N,q as C,a1 as k,F as ce,d as ue,y as ee,z as pe,k as Y,h as te,g as b,E as f,a3 as be,i as y,Q as Ve,j as Ye,ae as me,J as Le,X as ae,a4 as we,a5 as Te,af as He,s as Ae,ad as Ie}from"./index-8fcd860e.js";import{a as Je,e as Re}from"./device-8b64369e.js";import{a as Be,b as Oe}from"./product-10f9ab22.js";import{g as je}from"./system-c7ccab1a.js";import{i as Ee}from"./index-18acf776.js";const Ue=R=>ve({url:"/device-data/list",method:"post",data:R}),Fe=R=>ve({url:"/commands/send",method:"post",data:R}),Qe=R=>ve({url:"/device-logs/list",method:"post",data:R});const We={class:"device-detail-page"},Ze={class:"topbar"},Ge={key:0,class:"header-section"},Xe={class:"header-left"},Ke={class:"device-title-bar-compact"},et={class:"device-title-text"},tt={class:"title-row"},at={class:"device-name-wrapper"},ot={class:"device-name-large"},st={class:"device-code-badge"},lt={class:"info-grid-compact"},nt={class:"info-card-compact"},it={class:"info-value"},rt={class:"info-card-compact"},dt={class:"info-value"},ct={class:"info-card-compact"},ut={class:"info-value"},pt={class:"header-right"},mt={class:"info-section-title"},vt={class:"mqtt-card-compact"},gt={class:"mqtt-line"},ft={class:"mqtt-value"},yt={class:"mqtt-value"},ht={class:"mqtt-line"},_t={class:"mqtt-code-inline"},bt={class:"mqtt-line"},wt={class:"mqtt-code-inline"},Tt={class:"mqtt-line"},Ct={class:"mqtt-code-inline"},xt={class:"tabs"},Dt={key:0,class:"data-grid-wrapper"},St={class:"data-grid"},zt={class:"data-label"},kt={class:"data-value"},$t={key:0,class:"data-unit"},Mt={class:"data-time"},Pt={key:1,class:"empty-data"},qt={class:"history-toolbar"},Nt={style:{flex:"1",display:"flex",gap:"12px","justify-content":"flex-end"}},Vt={class:"history-chart-container"},Yt={key:0,class:"empty-data"},Lt={class:"history-table-wrapper"},Ht={class:"history-table-container"},At={key:0},It={key:0,class:"unit-text"},Jt={key:1,style:{color:"#ccc"}},Rt={key:1,class:"empty-data"},Bt={class:"metadata-table-wrapper"},Ot={class:"metadata-table-container"},jt={class:"time-cell"},Et={class:"json-cell"},Ut={class:"json-display"},Ft={key:1,class:"empty-data"},Qt={class:"command-grid"},Wt=["onClick"],Zt={class:"command-name"},Gt={key:0,class:"empty-data"},Xt={class:"log-filter-bar"},Kt={class:"log-table-wrapper"},ea={key:1,class:"empty-data"},ta={__name:"DeviceDetail",setup(R){const j=Pe(),Ce=qe(),d=te({id:null,deviceName:"",deviceCode:"",productId:null,productName:"",groupId:null,groupName:"",groupPath:"",status:0,lastOnlineTime:"",createTime:""}),w=b([]),L=b([]),E=b([]),oe=b("-"),x=b("chart"),q=b([]),h=b([]),H=b([]),A=b(null);let $=null;const g=te({currentPage:1,pageSize:50,total:0}),T=b("realtime"),U=b([]),F=b(!1),se=b({logType:""}),Q=b([]),V=te({currentPage:1,pageSize:20,total:0}),I=te({broker:"",port:"",username:"",password:""}),xe=async()=>{try{const a=await je();a&&Object.assign(I,a)}catch(a){console.error("加载MQTT配置失败:",a),I.broker="localhost",I.port="1883",I.username="admin",I.password="admin123."}},De=async()=>{var a,e,o;try{const n=j.query.deviceCode||j.params.deviceCode;if(console.log("设备编码:",n,"路由参数:",j.query,j.params),!n){f.error("设备编码不存在"),O();return}await xe(),console.log("请求设备详情，参数:",{deviceCode:n});const c=await Je({deviceCode:n});console.log("设备详情响应数据:",c),c&&typeof c=="object"?(Object.assign(d,c),le()):(f.error("获取设备详情失败：返回数据格式错误"),console.error("返回数据:",c),O())}catch(n){console.error("加载设备详情失败:",n),console.error("错误详情:",{message:n.message,response:n.response,data:(a=n.response)==null?void 0:a.data});const c=((o=(e=n.response)==null?void 0:e.data)==null?void 0:o.message)||n.message||"加载设备详情失败";f.error(c),O()}},ge=async()=>{if(!d.productId){console.warn("产品ID不存在");return}if(!(w.value.length>0))try{const a=await Be(d.productId);a&&(w.value=a||[],console.log("产品属性加载完成:",w.value.length,"个"))}catch(a){console.error("加载产品属性失败:",a),f.error("加载产品属性失败")}},Se=async()=>{if(!d.productId){console.warn("产品ID不存在");return}if(!(L.value.length>0))try{const a=await Oe(d.productId);a&&(Array.isArray(a)?L.value=a:a.list&&Array.isArray(a.list)?L.value=a.list:L.value=[],console.log("产品命令加载完成:",L.value.length,"个"))}catch(a){console.error("加载产品命令失败:",a),f.error("加载产品命令失败")}},le=async()=>{try{w.value.length===0&&d.productAttrs&&(w.value=d.productAttrs||[]),w.value.length===0&&T.value==="realtime"&&await ge();const a=await Re({deviceCode:d.deviceCode});if(a){const e=a.reportTime;if(e)oe.value=e.includes("T")?e.replace("T"," "):e;else{const n=new Date,c=n.getFullYear(),D=String(n.getMonth()+1).padStart(2,"0"),S=String(n.getDate()).padStart(2,"0"),l=String(n.getHours()).padStart(2,"0"),p=String(n.getMinutes()).padStart(2,"0"),_=String(n.getSeconds()).padStart(2,"0");oe.value=`${c}-${D}-${S} ${l}:${p}:${_}`}const o=a.data||{};E.value=w.value.map(n=>{const c=o[n.addr];return{key:n.addr,label:n.attrName,value:c!=null&&c!==""?c:"-",unit:n.unit}})}else E.value=w.value.map(e=>({key:e.addr,label:e.attrName,value:"-",unit:e.unit}))}catch(a){console.error("加载实时数据失败:",a),f.error("加载实时数据失败")}},ze=K(()=>{const a=(g.currentPage-1)*g.pageSize,e=a+g.pageSize;return h.value.slice(a,e)}),W=K(()=>{if(!H.value||H.value.length===0)return[];const a=new Map;return H.value.forEach(e=>{if(e.rawPayload){const o=e.reportTime||e.ctime||"";if(!a.has(e.rawPayload))a.set(e.rawPayload,{reportTime:o,rawPayload:e.rawPayload});else{const n=a.get(e.rawPayload);new Date(o)<new Date(n.reportTime)&&(n.reportTime=o)}}}),Array.from(a.values()).map(e=>{try{const o=JSON.stringify(JSON.parse(e.rawPayload),null,2);return{reportTime:e.reportTime,rawJson:e.rawPayload,formattedJson:o}}catch(o){return console.error("JSON解析失败:",o,e.rawPayload),{reportTime:e.reportTime,rawJson:e.rawPayload,formattedJson:e.rawPayload}}}).sort((e,o)=>new Date(o.reportTime)-new Date(e.reportTime))}),ke=K(()=>{const a=(g.currentPage-1)*g.pageSize,e=a+g.pageSize;return W.value.slice(a,e)}),fe=K(()=>"calc(100vh - 320px)"),B=async()=>{try{if(!q.value||q.value.length!==2){f.warning("请选择查询时间范围");return}w.value.length===0&&await ge();const a=await Ue({deviceCode:d.deviceCode,startTime:q.value[0],endTime:q.value[1]});if(a){const e=new Map;a.forEach(o=>{let n="";o.ctime&&(n=o.ctime.includes("T")?o.ctime.replace("T"," "):o.ctime),e.has(n)||e.set(n,{reportTime:n}),e.get(n)[o.addr]=o.addrv}),x.value==="metadata"?H.value=a.map(o=>({...o,reportTime:o.ctime?o.ctime.includes("T")?o.ctime.replace("T"," "):o.ctime:""})):H.value=[],h.value=Array.from(e.values()).sort((o,n)=>new Date(n.reportTime)-new Date(o.reportTime)),g.total=h.value.length,g.currentPage=1,x.value==="metadata"&&(H.value=a.map(o=>({...o,reportTime:o.ctime?o.ctime.includes("T")?o.ctime.replace("T"," "):o.ctime:""}))),f.success(`查询成功，共 ${h.value.length} 条记录`),x.value==="chart"&&be(()=>{ne()})}}catch(a){console.error("查询历史数据失败:",a),f.error("查询历史数据失败")}},ne=()=>{if(console.log("=== 开始渲染图表 ==="),console.log("historyChartRef.value:",A.value),console.log("historyData.value.length:",h.value.length),console.log("productAttributes.value.length:",w.value.length),!A.value){console.error("图表容器未找到");return}const a=A.value.getBoundingClientRect();if(console.log("容器尺寸:",a.width,"x",a.height),a.width===0||a.height===0){console.error("容器尺寸为0，可能未显示"),setTimeout(()=>{if(A.value){const l=A.value.getBoundingClientRect();l.width>0&&l.height>0&&ne()}},200);return}if(h.value.length===0){console.warn("无历史数据");return}if(w.value.length===0){console.warn("产品属性未加载");return}$&&($.dispose(),$=null),$=Ee(A.value),console.log("图表实例已创建");const e=[...h.value].sort((l,p)=>new Date(l.reportTime.replace("T"," "))-new Date(p.reportTime.replace("T"," ")));console.log("排序后数据:",e.length,"条");const o=e.map(l=>{const p=l.reportTime.replace("T"," ");return p.split(" ")[1]||p});console.log("时间轴数据:",o.slice(0,5));const n=w.value.filter(l=>{const p=l.dataType;return p==="int"||p==="float"||p==="double"});if(console.log("数值属性:",n.map(l=>`${l.attrName}(${l.addr})`)),n.length===0){console.warn("没有数值类型的属性"),f.warning("当前产品没有可绘制的数值属性");return}const c=["#409eff","#67c23a","#e6a23c","#f56c6c","#909399"],D=n.map((l,p)=>{const _=e.map(J=>{const P=J[l.addr];return P!=null&&P!==""?Number(P):null}),M=_.filter(J=>J!==null).length;return console.log(`${l.attrName}: ${M} 个有效数据点`),{name:l.attrName,type:"line",smooth:!0,symbol:"circle",symbolSize:6,data:_,itemStyle:{color:c[p%c.length]},lineStyle:{width:2},connectNulls:!1}}),S={title:{text:"历史数据趋势图",left:"center",top:10,textStyle:{fontSize:16,fontWeight:600,color:"#333"}},backgroundColor:"#fff",tooltip:{trigger:"axis",backgroundColor:"rgba(255, 255, 255, 0.95)",borderColor:"#ddd",borderWidth:1,padding:10,textStyle:{color:"#333",fontSize:12},formatter:function(l){let p=`<div style="font-weight: bold; margin-bottom: 8px; font-size: 13px;">${l[0].axisValue}</div>`;return l.forEach(_=>{if(_.value!==null){const M=n.find(P=>P.attrName===_.seriesName),J=(M==null?void 0:M.unit)||"";p+=`<div style="margin: 4px 0;">${_.marker} ${_.seriesName}: <span style="font-weight: bold;">${_.value}</span> ${J}</div>`}}),p}},legend:{data:D.map(l=>l.name),top:30,type:"scroll",textStyle:{fontSize:11}},grid:{left:55,right:35,bottom:50,top:65,containLabel:!1},xAxis:{type:"category",boundaryGap:!1,data:o,axisLine:{lineStyle:{color:"#999"}},axisLabel:{color:"#666",fontSize:11,rotate:45,interval:Math.floor(o.length/15)||0},splitLine:{show:!1}},yAxis:{type:"value",axisLine:{show:!0,lineStyle:{color:"#999"}},axisLabel:{color:"#666",fontSize:11},splitLine:{lineStyle:{color:"#e5e5e5",type:"dashed"}}},dataZoom:[{type:"inside",start:0,end:100,zoomOnMouseWheel:!0,moveOnMouseMove:!0},{type:"slider",start:0,end:100,height:20,bottom:8,borderColor:"#ccc",fillerColor:"rgba(64, 158, 255, 0.2)",handleStyle:{color:"#409eff"}}],series:D};console.log("设置图表配置"),$.setOption(S,!0),console.log("图表渲染完成"),console.log("=== 渲染图表结束 ===")};he(x,async(a,e)=>{a==="metadata"?h.value.length>0&&H.value.length===0?await B():h.value.length===0&&(q.value.length===0&&ie(),await B()):a==="chart"&&(h.value.length===0?(console.log("图表视图无数据，开始查询..."),await B()):(console.log("图表视图有数据，渲染图表..."),setTimeout(()=>{be(()=>{ne()})},100)))}),he([()=>T.value,()=>x.value],()=>{T.value==="history"&&x.value==="chart"&&$&&setTimeout(()=>{$&&$.resize()},100)}),_e(()=>{window.addEventListener("resize",()=>{$&&$.resize()})});const $e=async a=>{if(console.log("点击命令按钮:",a),console.log("设备状态:",d.status),d.status!==1){f.warning("设备离线，无法下发命令");return}try{await Ie.confirm(`是否确认执行 ${a.commandName||a.addr} 指令？`,"命令确认",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}),await Fe({deviceCode:d.deviceCode,commands:[{addr:a.addr,addrv:a.commandValue}]})&&(f.success("命令已下发"),setTimeout(()=>{le()},1e3))}catch(e){e!=="cancel"&&(console.error("发送命令失败:",e),f.error("发送命令失败"))}},Z=async a=>{T.value=a,a==="realtime"?le():a==="history"?(q.value.length===0&&ie(),h.value.length===0&&await B()):a==="command"?await Se():a==="log"&&G()},G=async()=>{var a,e,o,n,c,D,S;F.value=!0;try{const l=await Qe({page:V.currentPage,pageSize:V.pageSize,deviceCode:d.deviceCode,logType:se.value.logType,startTime:(a=Q.value)==null?void 0:a[0],endTime:(e=Q.value)==null?void 0:e[1]});U.value=(l==null?void 0:l.list)||[],V.total=(l==null?void 0:l.total)||0}catch(l){if(console.error("加载设备日志失败:",l),((o=l==null?void 0:l.response)==null?void 0:o.status)===401||(n=l==null?void 0:l.message)!=null&&n.includes("登录已过期")||(c=l==null?void 0:l.message)!=null&&c.includes("未授权"))return;const p=((S=(D=l==null?void 0:l.response)==null?void 0:D.data)==null?void 0:S.message)||(l==null?void 0:l.message)||"获取设备日志失败";f.error(p)}finally{F.value=!1}},ie=()=>{const a=new Date,e=new Date(a.getFullYear(),a.getMonth(),a.getDate(),0,0,0);q.value=[re(e),re(a)]},re=a=>{const e=new Date(a),o=e.getFullYear(),n=String(e.getMonth()+1).padStart(2,"0"),c=String(e.getDate()).padStart(2,"0"),D=String(e.getHours()).padStart(2,"0"),S=String(e.getMinutes()).padStart(2,"0"),l=String(e.getSeconds()).padStart(2,"0");return`${o}-${n}-${c} ${D}:${S}:${l}`},O=()=>{Ce.push("/devices")},de=async(a,e)=>{try{if(navigator.clipboard&&navigator.clipboard.writeText){await navigator.clipboard.writeText(a),f({message:`${e}已复制到剪贴板`,type:"success",duration:2e3});return}const o=document.createElement("textarea");o.value=a,o.style.position="fixed",o.style.left="-999999px",o.style.top="-999999px",document.body.appendChild(o),o.select();try{const n=document.execCommand("copy");if(document.body.removeChild(o),n)f({message:`${e}已复制到剪贴板`,type:"success",duration:2e3});else throw new Error("execCommand failed")}catch(n){throw document.body.removeChild(o),n}}catch(o){console.error("复制失败:",o),f.error("复制失败，请手动选择复制")}};return _e(()=>{De(),ie()}),(a,e)=>{const o=z("el-icon"),n=z("el-button"),c=z("el-radio-button"),D=z("el-radio-group"),S=z("el-date-picker"),l=z("el-table-column"),p=z("el-table"),_=z("el-pagination"),M=z("el-option"),J=z("el-select"),P=z("el-tag"),ye=Ne("loading");return u(),v("div",We,[t("div",Ze,[t("div",{class:"breadcrumb"},[t("span",{onClick:O,class:"breadcrumb-link"},"设备管理"),e[17]||(e[17]=t("span",{class:"breadcrumb-sep"},"/",-1)),e[18]||(e[18]=t("span",{class:"breadcrumb-current"},"设备详情",-1))]),s(n,{type:"primary",onClick:O,size:"default",class:"back-btn"},{default:r(()=>[s(o,{style:{"margin-right":"6px"}},{default:r(()=>[s(y(Ve))]),_:1}),e[19]||(e[19]=C(" 返回设备列表 ",-1))]),_:1})]),T.value!=="history"?(u(),v("div",Ge,[t("div",Xe,[t("div",Ke,[t("div",et,[t("div",tt,[t("div",at,[t("h1",ot,m(d.deviceName||"-"),1),t("div",st,m(d.deviceCode||"-"),1)]),t("div",{class:N(["status-badge",d.status===1?"status-online":"status-offline"])},[e[20]||(e[20]=t("span",{class:"status-dot"},null,-1)),t("span",null,m(d.status===1?"在线":"离线"),1)],2)])])]),t("div",lt,[t("div",nt,[e[21]||(e[21]=t("div",{class:"info-label"},"产品类型",-1)),t("div",it,m(d.productName||"-"),1)]),t("div",rt,[e[22]||(e[22]=t("div",{class:"info-label"},"所属分组",-1)),t("div",dt,m(d.groupName||"-"),1)]),t("div",ct,[e[23]||(e[23]=t("div",{class:"info-label"},"最后上线",-1)),t("div",ut,m(re(d.lastOnlineTime)||"-"),1)])])]),t("div",pt,[t("div",mt,[s(o,{class:"section-icon",size:20},{default:r(()=>[s(y(Ye))]),_:1}),e[24]||(e[24]=C(" MQTT连接信息 ",-1))]),t("div",vt,[t("div",gt,[e[25]||(e[25]=t("span",{class:"mqtt-label"},"地址:",-1)),t("span",ft,m(I.broker||"-"),1),e[26]||(e[26]=t("span",{class:"mqtt-sep"},"|",-1)),e[27]||(e[27]=t("span",{class:"mqtt-label"},"端口:",-1)),t("span",yt,m(I.port||"-"),1)]),t("div",ht,[e[28]||(e[28]=t("span",{class:"mqtt-label"},"Client ID:",-1)),t("code",_t,m(d.deviceCode||"-"),1),s(n,{text:"",class:"copy-btn",onClick:e[0]||(e[0]=i=>de(d.deviceCode,"Client ID")),size:"small"},{default:r(()=>[s(o,null,{default:r(()=>[s(y(me))]),_:1})]),_:1})]),t("div",bt,[e[29]||(e[29]=t("span",{class:"mqtt-label"},"发布主题:",-1)),t("code",wt,"ssc/"+m(d.deviceCode||"-")+"/report",1),s(n,{text:"",class:"copy-btn",onClick:e[1]||(e[1]=i=>de(`ssc/${d.deviceCode}/report`,"发布主题")),size:"small"},{default:r(()=>[s(o,null,{default:r(()=>[s(y(me))]),_:1})]),_:1})]),t("div",Tt,[e[30]||(e[30]=t("span",{class:"mqtt-label"},"订阅主题:",-1)),t("code",Ct,"ssc/"+m(d.deviceCode||"-")+"/command",1),s(n,{text:"",class:"copy-btn",onClick:e[2]||(e[2]=i=>de(`ssc/${d.deviceCode}/command`,"订阅主题")),size:"small"},{default:r(()=>[s(o,null,{default:r(()=>[s(y(me))]),_:1})]),_:1})])])])])):k("",!0),t("div",xt,[t("button",{class:N(["tab",{active:T.value==="realtime"}]),onClick:e[3]||(e[3]=i=>Z("realtime"))}," 实时数据 ",2),t("button",{class:N(["tab",{active:T.value==="history"}]),onClick:e[4]||(e[4]=i=>Z("history"))}," 历史数据 ",2),t("button",{class:N(["tab",{active:T.value==="command"}]),onClick:e[5]||(e[5]=i=>Z("command"))}," 命令控制 ",2),t("button",{class:N(["tab",{active:T.value==="log"}]),onClick:e[6]||(e[6]=i=>Z("log"))}," 设备日志 ",2)]),t("div",{class:N(["tab-content",{active:T.value==="realtime"}])},[E.value.length>0?(u(),v("div",Dt,[t("div",St,[(u(!0),v(ce,null,ue(E.value,i=>(u(),v("div",{key:i.key,class:"data-card"},[t("div",zt,m(i.label),1),t("div",null,[t("span",kt,m(i.value),1),i.unit?(u(),v("span",$t,m(i.unit),1)):k("",!0)]),t("div",Mt,[s(o,{class:"time-icon",size:14},{default:r(()=>[s(y(Le))]),_:1}),C(" "+m(oe.value),1)])]))),128))])])):(u(),v("div",Pt,[s(o,{class:"empty-icon",size:64},{default:r(()=>[s(y(ae))]),_:1}),e[31]||(e[31]=t("div",{class:"empty-text"},"暂无实时数据",-1))]))],2),t("div",{class:N(["tab-content",{active:T.value==="history"}])},[t("div",qt,[s(D,{modelValue:x.value,"onUpdate:modelValue":e[7]||(e[7]=i=>x.value=i),size:"small"},{default:r(()=>[s(c,{label:"chart"},{default:r(()=>[s(o,{size:16,style:{"margin-right":"4px"}},{default:r(()=>[s(y(we))]),_:1}),e[32]||(e[32]=C(" 趋势图 ",-1))]),_:1}),s(c,{label:"table"},{default:r(()=>[s(o,{size:16,style:{"margin-right":"4px"}},{default:r(()=>[s(y(ae))]),_:1}),e[33]||(e[33]=C(" 表格 ",-1))]),_:1}),s(c,{label:"metadata"},{default:r(()=>[s(o,{size:16,style:{"margin-right":"4px"}},{default:r(()=>[s(y(Te))]),_:1}),e[34]||(e[34]=C(" 元数据 ",-1))]),_:1})]),_:1},8,["modelValue"]),t("div",Nt,[s(S,{modelValue:q.value,"onUpdate:modelValue":e[8]||(e[8]=i=>q.value=i),type:"datetimerange","range-separator":"至","start-placeholder":"开始时间","end-placeholder":"结束时间",format:"YYYY-MM-DD HH:mm:ss","value-format":"YYYY-MM-DD HH:mm:ss",style:{width:"400px"}},null,8,["modelValue"]),s(n,{type:"primary",onClick:B},{default:r(()=>[...e[35]||(e[35]=[C("查询",-1)])]),_:1})])]),ee(t("div",Vt,[t("div",{ref_key:"historyChartRef",ref:A,class:"history-chart"},null,512),h.value.length===0?(u(),v("div",Yt,[s(o,{class:"empty-icon",size:64},{default:r(()=>[s(y(we))]),_:1}),e[36]||(e[36]=t("div",{class:"empty-text"},"暂无历史数据",-1))])):k("",!0)],512),[[pe,x.value==="chart"]]),ee(t("div",Lt,[t("div",Ht,[s(p,{data:ze.value,stripe:"",style:{width:"100%"},height:fe.value},{default:r(()=>[s(l,{prop:"reportTime",label:"上报时间",width:"220",fixed:""}),(u(!0),v(ce,null,ue(w.value,i=>(u(),Y(l,{key:i.addr,label:i.attrName,"min-width":"100"},{default:r(({row:X})=>[X[i.addr]!==void 0&&X[i.addr]!==null?(u(),v("span",At,[C(m(X[i.addr])+" ",1),i.unit?(u(),v("span",It,m(i.unit),1)):k("",!0)])):(u(),v("span",Jt,"-"))]),_:2},1032,["label"]))),128))]),_:1},8,["data","height"]),h.value.length>0?(u(),Y(_,{key:0,"current-page":g.currentPage,"onUpdate:currentPage":e[9]||(e[9]=i=>g.currentPage=i),"page-size":g.pageSize,"onUpdate:pageSize":e[10]||(e[10]=i=>g.pageSize=i),"page-sizes":[20,50,100,200],total:g.total,layout:"total, sizes, prev, pager, next, jumper",class:"history-pagination"},null,8,["current-page","page-size","total"])):k("",!0),h.value.length===0?(u(),v("div",Rt,[s(o,{class:"empty-icon",size:64},{default:r(()=>[s(y(ae))]),_:1}),e[37]||(e[37]=t("div",{class:"empty-text"},"暂无历史数据",-1))])):k("",!0)])],512),[[pe,x.value==="table"]]),ee(t("div",Bt,[t("div",Ot,[s(p,{data:ke.value,stripe:"",style:{width:"100%"},height:fe.value,border:""},{default:r(()=>[s(l,{prop:"reportTime",label:"上报时间",width:"220",fixed:"left"},{default:r(({row:i})=>[t("div",jt,[t("span",null,m(i.reportTime),1)])]),_:1}),s(l,{prop:"formattedJson",label:"原始JSON数据"},{default:r(({row:i})=>[t("div",Et,[t("pre",Ut,m(i.rawJson),1)])]),_:1})]),_:1},8,["data","height"]),W.value.length>0?(u(),Y(_,{key:0,"current-page":g.currentPage,"onUpdate:currentPage":e[11]||(e[11]=i=>g.currentPage=i),"page-size":g.pageSize,"onUpdate:pageSize":e[12]||(e[12]=i=>g.pageSize=i),"page-sizes":[20,50,100,200],total:W.value.length,layout:"total, sizes, prev, pager, next, jumper",class:"metadata-pagination"},null,8,["current-page","page-size","total"])):k("",!0),W.value.length===0?(u(),v("div",Ft,[s(o,{class:"empty-icon",size:64},{default:r(()=>[s(y(Te))]),_:1}),e[38]||(e[38]=t("div",{class:"empty-text"},"暂无元数据",-1)),e[39]||(e[39]=t("div",{class:"empty-hint"},"请先查询历史数据",-1))])):k("",!0)])],512),[[pe,x.value==="metadata"]])],2),t("div",{class:N(["tab-content",{active:T.value==="command"}])},[t("div",Qt,[(u(!0),v(ce,null,ue(L.value,i=>(u(),v("button",{key:i.id,class:"command-btn",onClick:X=>$e(i)},[s(o,{class:"command-icon",size:40},{default:r(()=>[s(y(He))]),_:1}),t("div",Zt,m(i.commandName),1)],8,Wt))),128)),L.value.length===0?(u(),v("div",Gt,[s(o,{class:"empty-icon",size:64},{default:r(()=>[s(y(Ae))]),_:1}),e[40]||(e[40]=t("div",{class:"empty-text"},"暂无可用命令",-1))])):k("",!0)])],2),t("div",{class:N(["tab-content",{active:T.value==="log"}])},[t("div",Xt,[s(J,{modelValue:se.value.logType,"onUpdate:modelValue":e[13]||(e[13]=i=>se.value.logType=i),placeholder:"日志类型",clearable:"",style:{width:"150px"}},{default:r(()=>[s(M,{label:"全部",value:""}),s(M,{label:"设备上线",value:"online"}),s(M,{label:"设备离线",value:"offline"}),s(M,{label:"命令下发",value:"command"})]),_:1},8,["modelValue"]),s(S,{modelValue:Q.value,"onUpdate:modelValue":e[14]||(e[14]=i=>Q.value=i),type:"datetimerange","range-separator":"至","start-placeholder":"开始时间","end-placeholder":"结束时间",format:"YYYY-MM-DD HH:mm:ss","value-format":"YYYY-MM-DD HH:mm:ss",style:{width:"380px"}},null,8,["modelValue"]),s(n,{type:"primary",onClick:G},{default:r(()=>[...e[41]||(e[41]=[C("查询",-1)])]),_:1})]),t("div",Kt,[ee((u(),Y(p,{data:U.value,stripe:"",style:{width:"100%"}},{default:r(()=>[s(l,{prop:"createTime",label:"时间",width:"180"}),s(l,{prop:"logType",label:"类型",width:"120"},{default:r(({row:i})=>[i.logType==="online"?(u(),Y(P,{key:0,type:"success"},{default:r(()=>[...e[42]||(e[42]=[C("设备上线",-1)])]),_:1})):i.logType==="offline"?(u(),Y(P,{key:1,type:"danger"},{default:r(()=>[...e[43]||(e[43]=[C("设备离线",-1)])]),_:1})):(u(),Y(P,{key:2,type:"info"},{default:r(()=>[...e[44]||(e[44]=[C("命令下发",-1)])]),_:1}))]),_:1}),s(l,{prop:"logDetail",label:"详情"})]),_:1},8,["data"])),[[ye,F.value]]),U.value.length>0?(u(),Y(_,{key:0,"current-page":V.currentPage,"onUpdate:currentPage":e[15]||(e[15]=i=>V.currentPage=i),"page-size":V.pageSize,"onUpdate:pageSize":e[16]||(e[16]=i=>V.pageSize=i),total:V.total,"page-sizes":[20,50,100],layout:"total, sizes, prev, pager, next, jumper",class:"log-pagination",onSizeChange:G,onCurrentChange:G},null,8,["current-page","page-size","total"])):k("",!0),U.value.length===0&&!F.value?(u(),v("div",ea,[s(o,{class:"empty-icon",size:64},{default:r(()=>[s(y(ae))]),_:1}),e[45]||(e[45]=t("div",{class:"empty-text"},"暂无日志数据",-1))])):k("",!0)])],2)])}}},ia=Me(ta,[["__scopeId","data-v-fee3ed39"]]);export{ia as default};
