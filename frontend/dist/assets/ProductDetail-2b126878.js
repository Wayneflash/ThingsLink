import{_ as ie,a as me,u as pe,r as p,s as ce,c as r,o as b,d as y,f as l,w as t,e as a,t as u,E as c,p as s,F as $,B as q,I as ve,Q as S}from"./index-6b170f93.js";import{p as w}from"./index-40bc4241.js";const fe={class:"product-detail"},_e={class:"page-header"},be={class:"page-title"},ye={class:"page-actions"},Ve={class:"info-item"},ge={class:"info-value"},we={class:"info-item"},Ne={class:"info-value"},ke={class:"info-item"},Ce={class:"info-value"},Te={class:"info-item"},xe={class:"info-value"},Pe={class:"info-item"},Me={class:"info-value"},Ue={class:"info-item"},Fe={class:"info-value"},Ae={class:"info-item"},Be={class:"info-desc"},De={class:"tab-header"},Re={key:0,class:"empty-state"},$e={key:1,class:"attr-list"},qe={class:"list-card-main"},Ie={class:"list-card-title"},Ee={class:"list-card-desc"},Qe={class:"list-card-actions"},ze={class:"tab-header"},He={key:0,class:"empty-state"},Oe={key:1,class:"cmd-list"},Le={class:"list-card-main"},Se={class:"list-card-title"},je={class:"list-card-desc"},Ge={class:"list-card-actions"},Je={__name:"ProductDetail",setup(Ke){const k=me(),j=pe(),v=p({}),V=p([]),T=p([]),I=p("attributes"),x=p(!1),P=p(!1),M=p(!1),U=p(null),F=p(null),A=p(null),i=p({productName:"",productModel:"",protocol:"",description:""}),n=p({addr:"",attrName:"",dataType:"",unit:""}),m=p({commandName:"",addr:"",commandValue:""}),G={productName:[{required:!0,message:"请输入产品名称",trigger:"blur"}],protocol:[{required:!0,message:"请选择协议类型",trigger:"change"}]},J={addr:[{required:!0,message:"请输入属性标识符",trigger:"blur"}],attrName:[{required:!0,message:"请输入属性名称",trigger:"blur"}],dataType:[{required:!0,message:"请选择数据类型",trigger:"change"}]},K={commandName:[{required:!0,message:"请输入命令名称",trigger:"blur"}],addr:[{required:!0,message:"请选择控制属性",trigger:"change"}],commandValue:[{required:!0,message:"请输入下发值",trigger:"blur"}]},E=async()=>{try{const d=k.params.id,e=await w.getProductDetail(d);v.value=e,e.attrs&&(V.value=e.attrs),e.commands&&(T.value=e.commands)}catch(d){console.error("加载产品详情失败:",d),c.error("加载产品详情失败")}},Q=async()=>{try{const d=k.params.id,e=await w.getProductAttributes(d);V.value=e||[]}catch(d){console.error("加载属性列表失败:",d)}},z=async()=>{try{const d=k.params.id,e=await w.getProductCommands(d);T.value=e||[]}catch(d){console.error("加载命令列表失败:",d)}},W=()=>{i.value={productName:v.value.productName,productModel:v.value.productModel,protocol:v.value.protocol,description:v.value.description||""},x.value=!0},X=async()=>{if(U.value)try{await U.value.validate(),await w.updateProduct({id:k.params.id,productName:i.value.productName,productModel:i.value.productModel,protocol:i.value.protocol,description:i.value.description}),c.success("产品信息已更新"),x.value=!1,E()}catch(d){d!==!1&&(console.error("更新产品失败:",d),c.error("更新产品失败"))}},Y=()=>{n.value={addr:"",attrName:"",dataType:"",unit:""},P.value=!0},Z=async()=>{if(F.value)try{if(await F.value.validate(),V.value.some(d=>d.addr===n.value.addr)){c.error("属性标识符已存在");return}await w.addProductAttribute({productId:k.params.id,addr:n.value.addr,attrName:n.value.attrName,dataType:n.value.dataType,unit:n.value.unit}),c.success("属性添加成功"),P.value=!1,Q()}catch(d){d!==!1&&(console.error("添加属性失败:",d),c.error("添加属性失败"))}},h=async d=>{try{await S.confirm(`确定要删除属性"${d.attrName}"吗？`,"删除确认",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}),await w.deleteProductAttribute(d.id),c.success("属性已删除"),Q()}catch(e){e!=="cancel"&&(console.error("删除属性失败:",e),c.error("删除属性失败"))}},ee=()=>{if(V.value.length===0){c.warning("请先添加属性后再创建命令");return}m.value={commandName:"",addr:"",commandValue:""},M.value=!0},le=async()=>{if(A.value)try{await A.value.validate(),await w.addProductCommand({productId:k.params.id,addr:m.value.addr,commandName:m.value.commandName,commandValue:m.value.commandValue,description:`控制属性 ${m.value.addr} 为 ${m.value.commandValue}`}),c.success("命令添加成功"),M.value=!1,z()}catch(d){d!==!1&&(console.error("添加命令失败:",d),c.error("添加命令失败"))}},te=async d=>{try{await S.confirm(`确定要删除命令"${d.commandName}"吗？`,"删除确认",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}),await w.deleteProductCommand(d.id),c.success("命令已删除"),z()}catch(e){e!=="cancel"&&(console.error("删除命令失败:",e),c.error("删除命令失败"))}},ae=()=>{j.push("/products")};return ce(()=>{E()}),(d,e)=>{const H=r("el-breadcrumb-item"),oe=r("el-breadcrumb"),f=r("el-button"),C=r("el-col"),de=r("el-row"),se=r("el-divider"),O=r("el-card"),L=r("el-tab-pane"),re=r("el-tabs"),g=r("el-input"),_=r("el-form-item"),N=r("el-option"),B=r("el-select"),D=r("el-form"),R=r("el-dialog"),ue=r("el-alert");return b(),y("div",fe,[l(oe,{separator:"›",class:"breadcrumb"},{default:t(()=>[l(H,{to:{path:"/products"}},{default:t(()=>[...e[18]||(e[18]=[s("产品管理",-1)])]),_:1}),l(H,null,{default:t(()=>[s(u(v.value.productName||"产品详情"),1)]),_:1})]),_:1}),a("div",_e,[a("h1",be,u(v.value.productName),1),a("div",ye,[l(f,{onClick:ae},{default:t(()=>[...e[19]||(e[19]=[s("← 返回列表",-1)])]),_:1}),l(f,{type:"primary",onClick:W},{default:t(()=>[...e[20]||(e[20]=[s("编辑产品",-1)])]),_:1})])]),l(O,{class:"info-card"},{header:t(()=>[...e[21]||(e[21]=[a("div",{class:"card-header"},[a("span",null,"基本信息")],-1)])]),default:t(()=>[l(de,{gutter:24},{default:t(()=>[l(C,{span:8},{default:t(()=>[a("div",Ve,[e[22]||(e[22]=a("div",{class:"info-label"},"产品名称",-1)),a("div",ge,u(v.value.productName||"-"),1)])]),_:1}),l(C,{span:8},{default:t(()=>[a("div",we,[e[23]||(e[23]=a("div",{class:"info-label"},"产品型号",-1)),a("div",Ne,u(v.value.productModel||"-"),1)])]),_:1}),l(C,{span:8},{default:t(()=>[a("div",ke,[e[24]||(e[24]=a("div",{class:"info-label"},"协议类型",-1)),a("div",Ce,u(v.value.protocol||"-"),1)])]),_:1}),l(C,{span:8},{default:t(()=>[a("div",Te,[e[25]||(e[25]=a("div",{class:"info-label"},"创建时间",-1)),a("div",xe,u(v.value.createTime||"-"),1)])]),_:1}),l(C,{span:8},{default:t(()=>[a("div",Pe,[e[26]||(e[26]=a("div",{class:"info-label"},"属性数量",-1)),a("div",Me,u(V.value.length)+" 个",1)])]),_:1}),l(C,{span:8},{default:t(()=>[a("div",Ue,[e[27]||(e[27]=a("div",{class:"info-label"},"命令数量",-1)),a("div",Fe,u(T.value.length)+" 个",1)])]),_:1})]),_:1}),l(se),a("div",Ae,[e[28]||(e[28]=a("div",{class:"info-label"},"产品描述",-1)),a("div",Be,u(v.value.description||"暂无描述"),1)])]),_:1}),l(O,{class:"tab-card"},{default:t(()=>[l(re,{modelValue:I.value,"onUpdate:modelValue":e[0]||(e[0]=o=>I.value=o)},{default:t(()=>[l(L,{label:"属性列表",name:"attributes"},{default:t(()=>[a("div",De,[e[30]||(e[30]=a("div",{class:"tab-title"},"设备属性定义",-1)),l(f,{type:"primary",onClick:Y},{default:t(()=>[...e[29]||(e[29]=[s("+ 添加属性",-1)])]),_:1})]),V.value.length===0?(b(),y("div",Re,[...e[31]||(e[31]=[a("div",{class:"empty-icon"},"📊",-1),a("div",{class:"empty-text"},'暂无属性，点击上方"添加属性"开始定义数据点',-1)])])):(b(),y("div",$e,[(b(!0),y($,null,q(V.value,o=>(b(),y("div",{key:o.id,class:"list-card"},[a("div",qe,[a("div",Ie,u(o.addr)+" - "+u(o.attrName),1),a("div",Ee,"类型："+u(o.dataType)+" | 单位："+u(o.unit||"无"),1)]),a("div",Qe,[l(f,{size:"small",type:"danger",onClick:ne=>h(o)},{default:t(()=>[...e[32]||(e[32]=[s("删除",-1)])]),_:1},8,["onClick"])])]))),128))]))]),_:1}),l(L,{label:"命令列表",name:"commands"},{default:t(()=>[a("div",ze,[e[34]||(e[34]=a("div",{class:"tab-title"},"设备命令定义",-1)),l(f,{type:"primary",onClick:ee},{default:t(()=>[...e[33]||(e[33]=[s("+ 添加命令",-1)])]),_:1})]),T.value.length===0?(b(),y("div",He,[...e[35]||(e[35]=[a("div",{class:"empty-icon"},"🎮",-1),a("div",{class:"empty-text"},'暂无命令，点击上方"添加命令"开始定义控制指令',-1)])])):(b(),y("div",Oe,[(b(!0),y($,null,q(T.value,o=>(b(),y("div",{key:o.id,class:"list-card"},[a("div",Le,[a("div",Se,u(o.commandName),1),a("div",je,"控制属性："+u(o.addr)+" | 下发值："+u(o.commandValue),1)]),a("div",Ge,[l(f,{size:"small",type:"danger",onClick:ne=>te(o)},{default:t(()=>[...e[36]||(e[36]=[s("删除",-1)])]),_:1},8,["onClick"])])]))),128))]))]),_:1})]),_:1},8,["modelValue"])]),_:1}),l(R,{modelValue:x.value,"onUpdate:modelValue":e[6]||(e[6]=o=>x.value=o),title:"编辑产品",width:"600px"},{footer:t(()=>[l(f,{onClick:e[5]||(e[5]=o=>x.value=!1)},{default:t(()=>[...e[38]||(e[38]=[s("取消",-1)])]),_:1}),l(f,{type:"primary",onClick:X},{default:t(()=>[...e[39]||(e[39]=[s("保存修改",-1)])]),_:1})]),default:t(()=>[l(D,{model:i.value,"label-width":"120px",rules:G,ref_key:"editFormRef",ref:U},{default:t(()=>[l(_,{label:"产品名称",prop:"productName"},{default:t(()=>[l(g,{modelValue:i.value.productName,"onUpdate:modelValue":e[1]||(e[1]=o=>i.value.productName=o),placeholder:"请输入产品名称"},null,8,["modelValue"])]),_:1}),l(_,{label:"产品型号",prop:"productModel"},{default:t(()=>[l(g,{modelValue:i.value.productModel,"onUpdate:modelValue":e[2]||(e[2]=o=>i.value.productModel=o),disabled:""},null,8,["modelValue"]),e[37]||(e[37]=a("div",{class:"input-hint"},"💡 产品型号创建后不可修改",-1))]),_:1}),l(_,{label:"协议类型",prop:"protocol"},{default:t(()=>[l(B,{modelValue:i.value.protocol,"onUpdate:modelValue":e[3]||(e[3]=o=>i.value.protocol=o),placeholder:"请选择协议类型",style:{width:"100%"}},{default:t(()=>[l(N,{label:"MQTT",value:"MQTT"}),l(N,{label:"HTTP",value:"HTTP"}),l(N,{label:"CoAP",value:"CoAP"}),l(N,{label:"Modbus",value:"Modbus"})]),_:1},8,["modelValue"])]),_:1}),l(_,{label:"产品描述"},{default:t(()=>[l(g,{modelValue:i.value.description,"onUpdate:modelValue":e[4]||(e[4]=o=>i.value.description=o),type:"textarea",rows:4,placeholder:"请输入产品描述"},null,8,["modelValue"])]),_:1})]),_:1},8,["model"])]),_:1},8,["modelValue"]),l(R,{modelValue:P.value,"onUpdate:modelValue":e[12]||(e[12]=o=>P.value=o),title:"添加产品属性",width:"600px"},{footer:t(()=>[l(f,{onClick:e[11]||(e[11]=o=>P.value=!1)},{default:t(()=>[...e[44]||(e[44]=[s("取消",-1)])]),_:1}),l(f,{type:"primary",onClick:Z},{default:t(()=>[...e[45]||(e[45]=[s("确定添加",-1)])]),_:1})]),default:t(()=>[l(D,{model:n.value,"label-width":"120px",rules:J,ref_key:"attrFormRef",ref:F},{default:t(()=>[l(_,{label:"属性标识符",prop:"addr"},{default:t(()=>[l(g,{modelValue:n.value.addr,"onUpdate:modelValue":e[7]||(e[7]=o=>n.value.addr=o),placeholder:"如：tem、hum、battery"},null,8,["modelValue"]),e[40]||(e[40]=a("div",{class:"input-hint"},"💡 英文标识符，用于数据上报的字段名，建议使用小写字母+下划线",-1))]),_:1}),l(_,{label:"属性名称",prop:"attrName"},{default:t(()=>[l(g,{modelValue:n.value.attrName,"onUpdate:modelValue":e[8]||(e[8]=o=>n.value.attrName=o),placeholder:"如：温度、湿度、电池电量"},null,8,["modelValue"]),e[41]||(e[41]=a("div",{class:"input-hint"},"💡 中文显示名称，方便理解属性含义",-1))]),_:1}),l(_,{label:"数据类型",prop:"dataType"},{default:t(()=>[l(B,{modelValue:n.value.dataType,"onUpdate:modelValue":e[9]||(e[9]=o=>n.value.dataType=o),placeholder:"请选择数据类型",style:{width:"100%"}},{default:t(()=>[l(N,{label:"整数 (int) - 如状态、计数",value:"int"}),l(N,{label:"浮点数 (float) - 如温度、湿度",value:"float"})]),_:1},8,["modelValue"]),e[42]||(e[42]=a("div",{class:"input-hint"},"💡 选择合适的数据类型，影响数据存储和处理方式",-1))]),_:1}),l(_,{label:"单位"},{default:t(()=>[l(g,{modelValue:n.value.unit,"onUpdate:modelValue":e[10]||(e[10]=o=>n.value.unit=o),placeholder:"如：℃、%、m/s（可选）"},null,8,["modelValue"]),e[43]||(e[43]=a("div",{class:"input-hint"},"💡 数值属性可填写单位，非数值属性可留空",-1))]),_:1})]),_:1},8,["model"])]),_:1},8,["modelValue"]),l(R,{modelValue:M.value,"onUpdate:modelValue":e[17]||(e[17]=o=>M.value=o),title:"添加产品命令",width:"600px"},{footer:t(()=>[l(f,{onClick:e[16]||(e[16]=o=>M.value=!1)},{default:t(()=>[...e[50]||(e[50]=[s("取消",-1)])]),_:1}),l(f,{type:"primary",onClick:le},{default:t(()=>[...e[51]||(e[51]=[s("确定添加",-1)])]),_:1})]),default:t(()=>[l(D,{model:m.value,"label-width":"120px",rules:K,ref_key:"cmdFormRef",ref:A},{default:t(()=>[l(_,{label:"命令名称",prop:"commandName"},{default:t(()=>[l(g,{modelValue:m.value.commandName,"onUpdate:modelValue":e[13]||(e[13]=o=>m.value.commandName=o),placeholder:"如：打开窗户、关闭灯光、设置模式"},null,8,["modelValue"]),e[46]||(e[46]=a("div",{class:"input-hint"},"💡 命令的显示名称，让用户知道这是什么操作",-1))]),_:1}),l(_,{label:"控制属性",prop:"addr"},{default:t(()=>[l(B,{modelValue:m.value.addr,"onUpdate:modelValue":e[14]||(e[14]=o=>m.value.addr=o),placeholder:"请选择要控制的属性",style:{width:"100%"}},{default:t(()=>[(b(!0),y($,null,q(V.value,o=>(b(),ve(N,{key:o.addr,label:`${o.attrName} (${o.addr})`,value:o.addr},null,8,["label","value"]))),128))]),_:1},8,["modelValue"]),e[47]||(e[47]=a("div",{class:"input-hint"},"💡 选择要控制的属性，命令会修改该属性的值",-1))]),_:1}),l(_,{label:"下发值",prop:"commandValue"},{default:t(()=>[l(g,{modelValue:m.value.commandValue,"onUpdate:modelValue":e[15]||(e[15]=o=>m.value.commandValue=o),placeholder:"如：1、0、ON、OFF"},null,8,["modelValue"]),e[48]||(e[48]=a("div",{class:"input-hint"},"💡 命令执行时会将该值下发给设备，设备根据该值进行操作",-1))]),_:1}),l(ue,{title:"💡 示例",type:"info",closable:!1},{default:t(()=>[...e[49]||(e[49]=[s(' 如果有一个属性叫 "window"，可以创建两个命令：',-1),a("br",null,null,-1),s(" • 命令名：打开窗户 | 控制属性：window | 下发值：1",-1),a("br",null,null,-1),s(" • 命令名：关闭窗户 | 控制属性：window | 下发值：0 ",-1)])]),_:1})]),_:1},8,["model"])]),_:1},8,["modelValue"])])}}},Ye=ie(Je,[["__scopeId","data-v-45e037bf"]]);export{Ye as default};
