import{_ as ce,a as ve,u as fe,r as p,z as _e,c as r,o as y,d as g,g as l,w as t,e as a,t as u,E as c,q as s,i as V,J as be,F as I,f as E,s as ye,a1 as w,k as Ve,W as j}from"./index-60c90437.js";import{p as C}from"./index-7762aa07.js";const ge={class:"product-detail"},we={class:"page-header"},Ne={class:"page-title"},ke={class:"page-actions"},Ce={class:"info-item"},Te={class:"info-value"},xe={class:"info-item"},Pe={class:"info-value"},Me={class:"info-item"},Ue={class:"info-value"},ze={class:"info-item"},Fe={class:"info-value"},Ae={class:"info-item"},De={class:"info-value"},Re={class:"info-item"},$e={class:"info-value"},Be={class:"info-item"},qe={class:"info-desc"},Ie={class:"tab-header"},Ee={key:0,class:"empty-state"},He={key:1,class:"attr-list"},Oe={class:"list-card-main"},Qe={class:"list-card-title"},Je={class:"list-card-desc"},Le={class:"list-card-actions"},Se={class:"tab-header"},We={key:0,class:"empty-state"},je={key:1,class:"cmd-list"},Ge={class:"list-card-main"},Ke={class:"list-card-title"},Xe={class:"list-card-desc"},Ye={class:"list-card-actions"},Ze={class:"input-hint"},he={class:"input-hint"},el={class:"input-hint"},ll={class:"input-hint"},tl={class:"input-hint"},al={class:"input-hint"},ol={class:"input-hint"},dl={class:"input-hint"},sl={class:"alert-title"},rl={__name:"ProductDetail",setup(ul){const x=ve(),G=fe(),v=p({}),N=p([]),M=p([]),H=p("attributes"),U=p(!1),z=p(!1),F=p(!1),A=p(null),D=p(null),R=p(null),i=p({productName:"",productModel:"",protocol:"",description:""}),n=p({addr:"",attrName:"",dataType:"",unit:""}),m=p({commandName:"",addr:"",commandValue:""}),K={productName:[{required:!0,message:"请输入产品名称",trigger:"blur"}],protocol:[{required:!0,message:"请选择协议类型",trigger:"change"}]},X={addr:[{required:!0,message:"请输入属性标识符",trigger:"blur"}],attrName:[{required:!0,message:"请输入属性名称",trigger:"blur"}],dataType:[{required:!0,message:"请选择数据类型",trigger:"change"}]},Y={commandName:[{required:!0,message:"请输入命令名称",trigger:"blur"}],addr:[{required:!0,message:"请选择控制属性",trigger:"change"}],commandValue:[{required:!0,message:"请输入下发值",trigger:"blur"}]},O=async()=>{try{const d=x.params.id,e=await C.getProductDetail(d);v.value=e,e.attrs&&(N.value=e.attrs),e.commands&&(M.value=e.commands)}catch(d){console.error("加载产品详情失败:",d),c.error("加载产品详情失败")}},Q=async()=>{try{const d=x.params.id,e=await C.getProductAttributes(d);N.value=e||[]}catch(d){console.error("加载属性列表失败:",d)}},J=async()=>{try{const d=x.params.id,e=await C.getProductCommands(d);M.value=e||[]}catch(d){console.error("加载命令列表失败:",d)}},Z=()=>{i.value={productName:v.value.productName,productModel:v.value.productModel,protocol:v.value.protocol,description:v.value.description||""},U.value=!0},h=async()=>{if(A.value)try{await A.value.validate(),await C.updateProduct({id:x.params.id,productName:i.value.productName,productModel:i.value.productModel,protocol:i.value.protocol,description:i.value.description}),c.success("产品信息已更新"),U.value=!1,O()}catch(d){d!==!1&&(console.error("更新产品失败:",d),c.error("更新产品失败"))}},ee=()=>{n.value={addr:"",attrName:"",dataType:"",unit:""},z.value=!0},le=async()=>{if(D.value)try{if(await D.value.validate(),N.value.some(d=>d.addr===n.value.addr)){c.error("属性标识符已存在");return}await C.addProductAttribute({productId:x.params.id,addr:n.value.addr,attrName:n.value.attrName,dataType:n.value.dataType,unit:n.value.unit}),c.success("属性添加成功"),z.value=!1,Q()}catch(d){d!==!1&&(console.error("添加属性失败:",d),c.error("添加属性失败"))}},te=async d=>{try{await j.confirm(`确定要删除属性"${d.attrName}"吗？`,"删除确认",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}),await C.deleteProductAttribute(d.id),c.success("属性已删除"),Q()}catch(e){e!=="cancel"&&(console.error("删除属性失败:",e),c.error("删除属性失败"))}},ae=()=>{if(N.value.length===0){c.warning("请先添加属性后再创建命令");return}m.value={commandName:"",addr:"",commandValue:""},F.value=!0},oe=async()=>{if(R.value)try{await R.value.validate(),await C.addProductCommand({productId:x.params.id,addr:m.value.addr,commandName:m.value.commandName,commandValue:m.value.commandValue,description:`控制属性 ${m.value.addr} 为 ${m.value.commandValue}`}),c.success("命令添加成功"),F.value=!1,J()}catch(d){d!==!1&&(console.error("添加命令失败:",d),c.error("添加命令失败"))}},de=async d=>{try{await j.confirm(`确定要删除命令"${d.commandName}"吗？`,"删除确认",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}),await C.deleteProductCommand(d.id),c.success("命令已删除"),J()}catch(e){e!=="cancel"&&(console.error("删除命令失败:",e),c.error("删除命令失败"))}},se=()=>{G.push("/products")};return _e(()=>{O()}),(d,e)=>{const L=r("el-breadcrumb-item"),re=r("el-breadcrumb"),f=r("el-button"),P=r("el-col"),ue=r("el-row"),ne=r("el-divider"),S=r("el-card"),_=r("el-icon"),W=r("el-tab-pane"),ie=r("el-tabs"),k=r("el-input"),b=r("el-form-item"),T=r("el-option"),$=r("el-select"),B=r("el-form"),q=r("el-dialog"),me=r("el-alert");return y(),g("div",ge,[l(re,{separator:"›",class:"breadcrumb"},{default:t(()=>[l(L,{to:{path:"/products"}},{default:t(()=>[...e[18]||(e[18]=[s("产品管理",-1)])]),_:1}),l(L,null,{default:t(()=>[s(u(v.value.productName||"产品详情"),1)]),_:1})]),_:1}),a("div",we,[a("h1",Ne,u(v.value.productName),1),a("div",ke,[l(f,{onClick:se},{default:t(()=>[...e[19]||(e[19]=[s("← 返回列表",-1)])]),_:1}),l(f,{type:"primary",onClick:Z},{default:t(()=>[...e[20]||(e[20]=[s("编辑产品",-1)])]),_:1})])]),l(S,{class:"info-card"},{header:t(()=>[...e[21]||(e[21]=[a("div",{class:"card-header"},[a("span",null,"基本信息")],-1)])]),default:t(()=>[l(ue,{gutter:24},{default:t(()=>[l(P,{span:8},{default:t(()=>[a("div",Ce,[e[22]||(e[22]=a("div",{class:"info-label"},"产品名称",-1)),a("div",Te,u(v.value.productName||"-"),1)])]),_:1}),l(P,{span:8},{default:t(()=>[a("div",xe,[e[23]||(e[23]=a("div",{class:"info-label"},"产品型号",-1)),a("div",Pe,u(v.value.productModel||"-"),1)])]),_:1}),l(P,{span:8},{default:t(()=>[a("div",Me,[e[24]||(e[24]=a("div",{class:"info-label"},"协议类型",-1)),a("div",Ue,u(v.value.protocol||"-"),1)])]),_:1}),l(P,{span:8},{default:t(()=>[a("div",ze,[e[25]||(e[25]=a("div",{class:"info-label"},"创建时间",-1)),a("div",Fe,u(v.value.createTime||"-"),1)])]),_:1}),l(P,{span:8},{default:t(()=>[a("div",Ae,[e[26]||(e[26]=a("div",{class:"info-label"},"属性数量",-1)),a("div",De,u(N.value.length)+" 个",1)])]),_:1}),l(P,{span:8},{default:t(()=>[a("div",Re,[e[27]||(e[27]=a("div",{class:"info-label"},"命令数量",-1)),a("div",$e,u(M.value.length)+" 个",1)])]),_:1})]),_:1}),l(ne),a("div",Be,[e[28]||(e[28]=a("div",{class:"info-label"},"产品描述",-1)),a("div",qe,u(v.value.description||"暂无描述"),1)])]),_:1}),l(S,{class:"tab-card"},{default:t(()=>[l(ie,{modelValue:H.value,"onUpdate:modelValue":e[0]||(e[0]=o=>H.value=o)},{default:t(()=>[l(W,{label:"属性列表",name:"attributes"},{default:t(()=>[a("div",Ie,[e[30]||(e[30]=a("div",{class:"tab-title"},"设备属性定义",-1)),l(f,{type:"primary",onClick:ee},{default:t(()=>[...e[29]||(e[29]=[s("+ 添加属性",-1)])]),_:1})]),N.value.length===0?(y(),g("div",Ee,[l(_,{class:"empty-icon",size:64},{default:t(()=>[l(V(be))]),_:1}),e[31]||(e[31]=a("div",{class:"empty-text"},'暂无属性，点击上方"添加属性"开始定义数据点',-1))])):(y(),g("div",He,[(y(!0),g(I,null,E(N.value,o=>(y(),g("div",{key:o.id,class:"list-card"},[a("div",Oe,[a("div",Qe,u(o.addr)+" - "+u(o.attrName),1),a("div",Je,"类型："+u(o.dataType)+" | 单位："+u(o.unit||"无"),1)]),a("div",Le,[l(f,{size:"small",type:"danger",onClick:pe=>te(o)},{default:t(()=>[...e[32]||(e[32]=[s("删除",-1)])]),_:1},8,["onClick"])])]))),128))]))]),_:1}),l(W,{label:"命令列表",name:"commands"},{default:t(()=>[a("div",Se,[e[34]||(e[34]=a("div",{class:"tab-title"},"设备命令定义",-1)),l(f,{type:"primary",onClick:ae},{default:t(()=>[...e[33]||(e[33]=[s("+ 添加命令",-1)])]),_:1})]),M.value.length===0?(y(),g("div",We,[l(_,{class:"empty-icon",size:64},{default:t(()=>[l(V(ye))]),_:1}),e[35]||(e[35]=a("div",{class:"empty-text"},'暂无命令，点击上方"添加命令"开始定义控制指令',-1))])):(y(),g("div",je,[(y(!0),g(I,null,E(M.value,o=>(y(),g("div",{key:o.id,class:"list-card"},[a("div",Ge,[a("div",Ke,u(o.commandName),1),a("div",Xe,"控制属性："+u(o.addr)+" | 下发值："+u(o.commandValue),1)]),a("div",Ye,[l(f,{size:"small",type:"danger",onClick:pe=>de(o)},{default:t(()=>[...e[36]||(e[36]=[s("删除",-1)])]),_:1},8,["onClick"])])]))),128))]))]),_:1})]),_:1},8,["modelValue"])]),_:1}),l(q,{modelValue:U.value,"onUpdate:modelValue":e[6]||(e[6]=o=>U.value=o),title:"编辑产品",width:"600px"},{footer:t(()=>[l(f,{onClick:e[5]||(e[5]=o=>U.value=!1)},{default:t(()=>[...e[38]||(e[38]=[s("取消",-1)])]),_:1}),l(f,{type:"primary",onClick:h},{default:t(()=>[...e[39]||(e[39]=[s("保存修改",-1)])]),_:1})]),default:t(()=>[l(B,{model:i.value,"label-width":"120px",rules:K,ref_key:"editFormRef",ref:A},{default:t(()=>[l(b,{label:"产品名称",prop:"productName"},{default:t(()=>[l(k,{modelValue:i.value.productName,"onUpdate:modelValue":e[1]||(e[1]=o=>i.value.productName=o),placeholder:"请输入产品名称"},null,8,["modelValue"])]),_:1}),l(b,{label:"产品型号",prop:"productModel"},{default:t(()=>[l(k,{modelValue:i.value.productModel,"onUpdate:modelValue":e[2]||(e[2]=o=>i.value.productModel=o),disabled:""},null,8,["modelValue"]),a("div",Ze,[l(_,{class:"hint-icon",size:14},{default:t(()=>[l(V(w))]),_:1}),e[37]||(e[37]=s(" 产品型号创建后不可修改 ",-1))])]),_:1}),l(b,{label:"协议类型",prop:"protocol"},{default:t(()=>[l($,{modelValue:i.value.protocol,"onUpdate:modelValue":e[3]||(e[3]=o=>i.value.protocol=o),placeholder:"请选择协议类型",style:{width:"100%"}},{default:t(()=>[l(T,{label:"MQTT",value:"MQTT"}),l(T,{label:"HTTP",value:"HTTP"}),l(T,{label:"CoAP",value:"CoAP"}),l(T,{label:"Modbus",value:"Modbus"})]),_:1},8,["modelValue"])]),_:1}),l(b,{label:"产品描述"},{default:t(()=>[l(k,{modelValue:i.value.description,"onUpdate:modelValue":e[4]||(e[4]=o=>i.value.description=o),type:"textarea",rows:4,placeholder:"请输入产品描述"},null,8,["modelValue"])]),_:1})]),_:1},8,["model"])]),_:1},8,["modelValue"]),l(q,{modelValue:z.value,"onUpdate:modelValue":e[12]||(e[12]=o=>z.value=o),title:"添加产品属性",width:"600px"},{footer:t(()=>[l(f,{onClick:e[11]||(e[11]=o=>z.value=!1)},{default:t(()=>[...e[44]||(e[44]=[s("取消",-1)])]),_:1}),l(f,{type:"primary",onClick:le},{default:t(()=>[...e[45]||(e[45]=[s("确定添加",-1)])]),_:1})]),default:t(()=>[l(B,{model:n.value,"label-width":"120px",rules:X,ref_key:"attrFormRef",ref:D},{default:t(()=>[l(b,{label:"属性标识符",prop:"addr"},{default:t(()=>[l(k,{modelValue:n.value.addr,"onUpdate:modelValue":e[7]||(e[7]=o=>n.value.addr=o),placeholder:"如：tem、hum、battery"},null,8,["modelValue"]),a("div",he,[l(_,{class:"hint-icon",size:14},{default:t(()=>[l(V(w))]),_:1}),e[40]||(e[40]=s(" 英文标识符，用于数据上报的字段名，建议使用小写字母+下划线 ",-1))])]),_:1}),l(b,{label:"属性名称",prop:"attrName"},{default:t(()=>[l(k,{modelValue:n.value.attrName,"onUpdate:modelValue":e[8]||(e[8]=o=>n.value.attrName=o),placeholder:"如：温度、湿度、电池电量"},null,8,["modelValue"]),a("div",el,[l(_,{class:"hint-icon",size:14},{default:t(()=>[l(V(w))]),_:1}),e[41]||(e[41]=s(" 中文显示名称，方便理解属性含义 ",-1))])]),_:1}),l(b,{label:"数据类型",prop:"dataType"},{default:t(()=>[l($,{modelValue:n.value.dataType,"onUpdate:modelValue":e[9]||(e[9]=o=>n.value.dataType=o),placeholder:"请选择数据类型",style:{width:"100%"}},{default:t(()=>[l(T,{label:"整数 (int) - 如状态、计数",value:"int"}),l(T,{label:"浮点数 (float) - 如温度、湿度",value:"float"})]),_:1},8,["modelValue"]),a("div",ll,[l(_,{class:"hint-icon",size:14},{default:t(()=>[l(V(w))]),_:1}),e[42]||(e[42]=s(" 选择合适的数据类型，影响数据存储和处理方式 ",-1))])]),_:1}),l(b,{label:"单位"},{default:t(()=>[l(k,{modelValue:n.value.unit,"onUpdate:modelValue":e[10]||(e[10]=o=>n.value.unit=o),placeholder:"如：℃、%、m/s（可选）"},null,8,["modelValue"]),a("div",tl,[l(_,{class:"hint-icon",size:14},{default:t(()=>[l(V(w))]),_:1}),e[43]||(e[43]=s(" 数值属性可填写单位，非数值属性可留空 ",-1))])]),_:1})]),_:1},8,["model"])]),_:1},8,["modelValue"]),l(q,{modelValue:F.value,"onUpdate:modelValue":e[17]||(e[17]=o=>F.value=o),title:"添加产品命令",width:"600px"},{footer:t(()=>[l(f,{onClick:e[16]||(e[16]=o=>F.value=!1)},{default:t(()=>[...e[55]||(e[55]=[s("取消",-1)])]),_:1}),l(f,{type:"primary",onClick:oe},{default:t(()=>[...e[56]||(e[56]=[s("确定添加",-1)])]),_:1})]),default:t(()=>[l(B,{model:m.value,"label-width":"120px",rules:Y,ref_key:"cmdFormRef",ref:R},{default:t(()=>[l(b,{label:"命令名称",prop:"commandName"},{default:t(()=>[l(k,{modelValue:m.value.commandName,"onUpdate:modelValue":e[13]||(e[13]=o=>m.value.commandName=o),placeholder:"如：打开窗户、关闭灯光、设置模式"},null,8,["modelValue"]),a("div",al,[l(_,{class:"hint-icon",size:14},{default:t(()=>[l(V(w))]),_:1}),e[46]||(e[46]=s(" 命令的显示名称，让用户知道这是什么操作 ",-1))])]),_:1}),l(b,{label:"控制属性",prop:"addr"},{default:t(()=>[l($,{modelValue:m.value.addr,"onUpdate:modelValue":e[14]||(e[14]=o=>m.value.addr=o),placeholder:"请选择要控制的属性",style:{width:"100%"}},{default:t(()=>[(y(!0),g(I,null,E(N.value,o=>(y(),Ve(T,{key:o.addr,label:`${o.attrName} (${o.addr})`,value:o.addr},null,8,["label","value"]))),128))]),_:1},8,["modelValue"]),a("div",ol,[l(_,{class:"hint-icon",size:14},{default:t(()=>[l(V(w))]),_:1}),e[47]||(e[47]=s(" 选择要控制的属性，命令会修改该属性的值 ",-1))])]),_:1}),l(b,{label:"下发值",prop:"commandValue"},{default:t(()=>[l(k,{modelValue:m.value.commandValue,"onUpdate:modelValue":e[15]||(e[15]=o=>m.value.commandValue=o),placeholder:"如：1、0、ON、OFF"},null,8,["modelValue"]),a("div",dl,[l(_,{class:"hint-icon",size:14},{default:t(()=>[l(V(w))]),_:1}),e[48]||(e[48]=s(" 命令执行时会将该值下发给设备，设备根据该值进行操作 ",-1))])]),_:1}),l(me,{type:"info",closable:!1},{title:t(()=>[a("div",sl,[l(_,{class:"alert-icon",size:16},{default:t(()=>[l(V(w))]),_:1}),e[49]||(e[49]=s(" 示例 ",-1))])]),default:t(()=>[e[50]||(e[50]=s(' 如果有一个属性叫 "window"，可以创建两个命令：',-1)),e[51]||(e[51]=a("br",null,null,-1)),e[52]||(e[52]=s(" • 命令名：打开窗户 | 控制属性：window | 下发值：1",-1)),e[53]||(e[53]=a("br",null,null,-1)),e[54]||(e[54]=s(" • 命令名：关闭窗户 | 控制属性：window | 下发值：0 ",-1))]),_:1})]),_:1},8,["model"])]),_:1},8,["modelValue"])])}}},ml=ce(rl,[["__scopeId","data-v-8b2d03d1"]]);export{ml as default};
