import{_ as X,u as Z,Z as j,r as u,o as m,c as Q,b as d,e as l,w as t,g as _,E as f,i as b,M as G,q as a,k as V,t as k,T as P,F as B,X as H,a1 as Y,ad as h}from"./index-98982554.js";import{p as N}from"./index-1c6a7f02.js";const ee={class:"toolbar"},le={class:"input-hint"},oe={class:"input-hint"},te={class:"input-hint"},re={class:"alert-title"},ae={__name:"ProductList",setup(se){const z=Z(),i=_([]),w=_(""),c=_(!1),n=_(!1),C=_(null),s=_({id:null,productName:"",productModel:"",protocol:"MQTT1.0",description:""}),L={productName:[{required:!0,message:"请输入产品名称",trigger:"blur"}],productModel:[{required:!0,message:"请输入产品型号",trigger:"blur"}],protocol:[{required:!0,message:"请选择协议类型",trigger:"change"}]},g=async()=>{try{console.log("开始加载产品列表...");const o=await N.getProductList();if(console.log("产品列表响应:",JSON.stringify(o,null,2)),!o){console.error("响应为空"),f.error("服务器无响应");return}o.list&&Array.isArray(o.list)?(console.log("使用 res.list，长度:",o.list.length),i.value=o.list):Array.isArray(o)?(console.log("使用 res，长度:",o.length),i.value=o):(console.warn("数据格式不正确:",typeof o),i.value=[]),console.log("最终 products.value:",i.value),console.log("产品数量:",i.value.length)}catch(o){console.error("加载产品列表失败:",o),console.error("错误堆栈:",o.stack),f.error("加载产品列表失败: "+o.message)}},$=()=>{const o=w.value.toLowerCase().trim();if(!o){g();return}i.value=i.value.filter(e=>e.productName&&e.productName.toLowerCase().includes(o)||e.productModel&&e.productModel.toLowerCase().includes(o))},D=()=>{n.value=!1,s.value={id:null,productName:"",productModel:"",protocol:"MQTT1.0",description:""},c.value=!0},U=o=>{n.value=!0;let e=o.protocol;(!e||e.trim()===""||e==="MQTT")&&(e="MQTT1.0"),s.value={id:o.id,productName:o.productName,productModel:o.productModel,protocol:e,description:o.description||""},c.value=!0},F=async()=>{if(C.value)try{if(await C.value.validate(),n.value){const o=await N.updateProduct({id:s.value.id,productName:s.value.productName,productModel:s.value.productModel,protocol:s.value.protocol,description:s.value.description});f.success("产品信息已更新"),c.value=!1,g()}else{const o=await N.createProduct({name:s.value.productName,code:s.value.productModel,protocol:s.value.protocol,description:s.value.description});f.success("产品创建成功！"),c.value=!1,o&&o.id?z.push(`/products/${o.id}`):g()}}catch(o){o!==!1&&(console.error("提交失败:",o),f.error(n.value?"更新产品失败":"创建产品失败"))}},S=o=>{z.push(`/products/${o.id}`)},q=async o=>{try{await h.confirm(`确定要删除产品"${o.productName}"吗？

删除后该产品的所有属性和命令也将被删除，此操作不可恢复！`,"删除确认",{confirmButtonText:"确定删除",cancelButtonText:"取消",type:"warning"}),await N.deleteProduct(o.id),f.success("产品已删除"),g()}catch(e){e!=="cancel"&&(console.error("删除产品失败:",e),f.error("删除产品失败"))}};return j(()=>{g()}),(o,e)=>{const y=u("el-icon"),M=u("el-input"),v=u("el-button"),E=u("el-card"),p=u("el-table-column"),x=u("el-tag"),I=u("el-table"),T=u("el-form-item"),R=u("el-option"),O=u("el-select"),J=u("el-form"),K=u("el-alert"),W=u("el-dialog");return m(),Q("div",null,[e[26]||(e[26]=d("h1",{class:"page-title"},"产品管理",-1)),l(E,{class:"toolbar-card"},{default:t(()=>[d("div",ee,[l(M,{modelValue:w.value,"onUpdate:modelValue":e[0]||(e[0]=r=>w.value=r),placeholder:"搜索产品名称或型号...",clearable:"",style:{width:"300px"},onInput:$},{prefix:t(()=>[l(y,null,{default:t(()=>[l(b(G))]),_:1})]),_:1},8,["modelValue"]),l(v,{type:"primary",onClick:D},{default:t(()=>[...e[7]||(e[7]=[a("+ 创建产品",-1)])]),_:1})])]),_:1}),l(E,null,{default:t(()=>[l(I,{data:i.value,border:"",stripe:""},{default:t(()=>[l(p,{prop:"id",label:"产品ID",width:"80"}),l(p,{prop:"productName",label:"产品名称"}),l(p,{prop:"productModel",label:"产品型号"}),l(p,{prop:"protocol",label:"协议类型",width:"120"},{default:t(({row:r})=>[r.protocol==="MQTT2.0"?(m(),V(x,{key:0,type:"success",size:"small"},{default:t(()=>[...e[8]||(e[8]=[a("MQTT2.0",-1)])]),_:1})):r.protocol==="MQTT"||!r.protocol?(m(),V(x,{key:1,type:"info",size:"small"},{default:t(()=>[...e[9]||(e[9]=[a("MQTT1.0",-1)])]),_:1})):(m(),V(x,{key:2,type:"info",size:"small"},{default:t(()=>[a(k(r.protocol),1)]),_:2},1024))]),_:1}),l(p,{label:"属性数量",width:"100",align:"center"},{default:t(({row:r})=>[a(k(r.attrCount||0)+" 个 ",1)]),_:1}),l(p,{label:"命令数量",width:"100",align:"center"},{default:t(({row:r})=>[a(k(r.cmdCount||0)+" 个 ",1)]),_:1}),l(p,{prop:"createTime",label:"创建时间",width:"180"}),l(p,{label:"操作",width:"280"},{default:t(({row:r})=>[l(v,{size:"small",type:"primary",onClick:A=>S(r)},{default:t(()=>[...e[10]||(e[10]=[a("查看详情",-1)])]),_:1},8,["onClick"]),l(v,{size:"small",onClick:A=>U(r)},{default:t(()=>[...e[11]||(e[11]=[a("编辑",-1)])]),_:1},8,["onClick"]),l(v,{size:"small",type:"danger",onClick:A=>q(r)},{default:t(()=>[...e[12]||(e[12]=[a("删除",-1)])]),_:1},8,["onClick"])]),_:1})]),_:1},8,["data"])]),_:1}),l(W,{modelValue:c.value,"onUpdate:modelValue":e[6]||(e[6]=r=>c.value=r),title:n.value?"编辑产品":"创建产品",width:"600px"},{footer:t(()=>[l(v,{onClick:e[5]||(e[5]=r=>c.value=!1)},{default:t(()=>[...e[25]||(e[25]=[a("取消",-1)])]),_:1}),l(v,{type:"primary",onClick:F},{default:t(()=>[a(k(n.value?"保存修改":"确定创建"),1)]),_:1})]),default:t(()=>[l(J,{model:s.value,"label-width":"120px",rules:L,ref_key:"productFormRef",ref:C},{default:t(()=>[l(T,{label:"产品名称",prop:"productName"},{default:t(()=>[l(M,{modelValue:s.value.productName,"onUpdate:modelValue":e[1]||(e[1]=r=>s.value.productName=r),placeholder:"如：智能水表、空气监测仪、温湿度传感器"},null,8,["modelValue"]),d("div",le,[l(y,{class:"hint-icon",size:14},{default:t(()=>[l(b(P))]),_:1}),e[13]||(e[13]=a(" 给产品起一个清晰易懂的名称，方便后续管理 ",-1))])]),_:1}),l(T,{label:"产品型号",prop:"productModel"},{default:t(()=>[l(M,{modelValue:s.value.productModel,"onUpdate:modelValue":e[2]||(e[2]=r=>s.value.productModel=r),placeholder:"如：WATER-PRO、AIR-01、TEM-SENSOR",disabled:n.value},null,8,["modelValue","disabled"]),d("div",oe,[l(y,{class:"hint-icon",size:14},{default:t(()=>[l(b(P))]),_:1}),n.value?(m(),Q(B,{key:1},[a("产品型号创建后不可修改")],64)):(m(),Q(B,{key:0},[a("产品型号是唯一标识，建议使用英文+数字组合，创建后不可修改")],64))])]),_:1}),l(T,{label:"协议类型",prop:"protocol"},{default:t(()=>[l(O,{modelValue:s.value.protocol,"onUpdate:modelValue":e[3]||(e[3]=r=>s.value.protocol=r),placeholder:"请选择协议类型",style:{width:"100%"}},{default:t(()=>[l(R,{label:"MQTT1.0",value:"MQTT1.0"}),l(R,{label:"MQTT2.0",value:"MQTT2.0"})]),_:1},8,["modelValue"])]),_:1}),l(T,{label:"产品描述",prop:"description"},{default:t(()=>[l(M,{modelValue:s.value.description,"onUpdate:modelValue":e[4]||(e[4]=r=>s.value.description=r),type:"textarea",rows:4,placeholder:"描述产品的功能、用途、适用场景等..."},null,8,["modelValue"]),d("div",te,[l(y,{class:"hint-icon",size:14},{default:t(()=>[l(b(P))]),_:1}),e[14]||(e[14]=a(" 详细描述有助于团队成员理解产品定位 ",-1))])]),_:1})]),_:1},8,["model"]),n.value?Y("",!0):(m(),V(K,{key:0,type:"info",closable:!1,style:{"margin-bottom":"20px"}},{title:t(()=>[d("div",re,[l(y,{class:"alert-icon",size:16},{default:t(()=>[l(b(H))]),_:1}),e[15]||(e[15]=a(" 下一步操作 ",-1))])]),default:t(()=>[e[16]||(e[16]=a(' 创建产品后，点击"查看详情"跳转到详情页，添加"属性"和"命令"来完整定义设备的物模型：',-1)),e[17]||(e[17]=d("br",null,null,-1)),e[18]||(e[18]=a(" • ",-1)),e[19]||(e[19]=d("strong",null,"属性",-1)),e[20]||(e[20]=a("：设备上报的数据字段（如温度、湿度、电量）",-1)),e[21]||(e[21]=d("br",null,null,-1)),e[22]||(e[22]=a(" • ",-1)),e[23]||(e[23]=d("strong",null,"命令",-1)),e[24]||(e[24]=a("：平台下发给设备的控制指令（如开关、设置参数） ",-1))]),_:1}))]),_:1},8,["modelValue","title"])])}}},ne=X(ae,[["__scopeId","data-v-e68f443a"]]);export{ne as default};
