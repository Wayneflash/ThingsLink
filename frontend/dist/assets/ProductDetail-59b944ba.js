import{_ as ve,a as fe,u as _e,r as f,z as be,c as r,o as k,d as D,g as t,w as l,e as o,t as y,E as _,q as s,i as p,T as V,D as ge,W as X,J as ye,k as h,s as Ve,F as we,f as Ne,X as Y}from"./index-62e02c83.js";import{p as C}from"./index-4b76e424.js";const ke={class:"product-detail"},Ce={class:"page-header"},xe={class:"page-title"},Te={class:"page-actions"},ze={class:"card-header"},Me={class:"info-grid"},$e={class:"info-row"},Pe={class:"info-item"},De={class:"info-value"},Ue={class:"info-item"},Fe={class:"info-value"},Ae={class:"info-item"},Se={class:"info-value"},Re={class:"info-row"},Be={class:"info-item"},qe={class:"info-value"},Ie={class:"info-item"},Ee={class:"info-value"},he={class:"info-item"},He={class:"info-value"},Oe={key:0,class:"info-desc-row"},Qe={class:"info-desc"},Je={class:"tab-header"},Le={key:0,class:"empty-state"},We={class:"tab-header"},Xe={key:0,class:"empty-state"},Ye={class:"input-hint"},je={class:"input-hint"},Ge={class:"input-hint"},Ke={class:"input-hint"},Ze={class:"input-hint"},et={class:"input-hint"},tt={class:"input-hint"},lt={class:"input-hint"},at={class:"alert-title"},ot={__name:"ProductDetail",setup(dt){const T=fe(),j=_e(),c=f({}),w=f([]),z=f([]),H=f("attributes"),M=f(!1),$=f(!1),P=f(!1),A=f(null),S=f(null),R=f(null),i=f({productName:"",productModel:"",protocol:"",description:""}),u=f({addr:"",attrName:"",dataType:"",unit:""}),v=f({commandName:"",addr:"",commandValue:""}),G=d=>{if(!d)return"-";if(typeof d=="string"&&d.match(/^\d{4}-\d{2}-\d{2} \d{2}:\d{2}:\d{2}$/))return d;if(typeof d=="string"&&d.includes("T"))return d.replace("T"," ").substring(0,19);const e=new Date(d),U=e.getFullYear(),B=String(e.getMonth()+1).padStart(2,"0"),m=String(e.getDate()).padStart(2,"0"),n=String(e.getHours()).padStart(2,"0"),F=String(e.getMinutes()).padStart(2,"0"),b=String(e.getSeconds()).padStart(2,"0");return`${U}-${B}-${m} ${n}:${F}:${b}`},K={productName:[{required:!0,message:"请输入产品名称",trigger:"blur"}],protocol:[{required:!0,message:"请选择协议类型",trigger:"change"}]},Z={addr:[{required:!0,message:"请输入属性标识符",trigger:"blur"}],attrName:[{required:!0,message:"请输入属性名称",trigger:"blur"}],dataType:[{required:!0,message:"请选择数据类型",trigger:"change"}]},ee={commandName:[{required:!0,message:"请输入命令名称",trigger:"blur"}],addr:[{required:!0,message:"请选择控制属性",trigger:"change"}],commandValue:[{required:!0,message:"请输入下发值",trigger:"blur"}]},O=async()=>{try{const d=T.params.id,e=await C.getProductDetail(d);c.value=e,e.attrs&&(w.value=e.attrs),e.commands&&(z.value=e.commands)}catch(d){console.error("加载产品详情失败:",d),_.error("加载产品详情失败")}},Q=async()=>{try{const d=T.params.id,e=await C.getProductAttributes(d);w.value=e||[]}catch(d){console.error("加载属性列表失败:",d)}},J=async()=>{try{const d=T.params.id,e=await C.getProductCommands(d);z.value=e||[]}catch(d){console.error("加载命令列表失败:",d)}},te=()=>{i.value={productName:c.value.productName,productModel:c.value.productModel,protocol:c.value.protocol,description:c.value.description||""},M.value=!0},le=async()=>{if(A.value)try{await A.value.validate(),await C.updateProduct({id:T.params.id,productName:i.value.productName,productModel:i.value.productModel,protocol:i.value.protocol,description:i.value.description}),_.success("产品信息已更新"),M.value=!1,O()}catch(d){d!==!1&&(console.error("更新产品失败:",d),_.error("更新产品失败"))}},ae=()=>{u.value={addr:"",attrName:"",dataType:"",unit:""},$.value=!0},oe=async()=>{if(S.value)try{if(await S.value.validate(),w.value.some(d=>d.addr===u.value.addr)){_.error("属性标识符已存在");return}await C.addProductAttribute({productId:T.params.id,addr:u.value.addr,attrName:u.value.attrName,dataType:u.value.dataType,unit:u.value.unit}),_.success("属性添加成功"),$.value=!1,Q()}catch(d){d!==!1&&(console.error("添加属性失败:",d),_.error("添加属性失败"))}},de=async d=>{try{await Y.confirm(`确定要删除属性"${d.attrName}"吗？`,"删除确认",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}),await C.deleteProductAttribute(d.id),_.success("属性已删除"),Q()}catch(e){e!=="cancel"&&(console.error("删除属性失败:",e),_.error("删除属性失败"))}},se=()=>{if(w.value.length===0){_.warning("请先添加属性后再创建命令");return}v.value={commandName:"",addr:"",commandValue:""},P.value=!0},re=async()=>{if(R.value)try{await R.value.validate(),await C.addProductCommand({productId:T.params.id,addr:v.value.addr,commandName:v.value.commandName,commandValue:v.value.commandValue,description:`控制属性 ${v.value.addr} 为 ${v.value.commandValue}`}),_.success("命令添加成功"),P.value=!1,J()}catch(d){d!==!1&&(console.error("添加命令失败:",d),_.error("添加命令失败"))}},ne=async d=>{try{await Y.confirm(`确定要删除命令"${d.commandName}"吗？`,"删除确认",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}),await C.deleteProductCommand(d.id),_.success("命令已删除"),J()}catch(e){e!=="cancel"&&(console.error("删除命令失败:",e),_.error("删除命令失败"))}},ue=()=>{j.push("/products")};return be(()=>{O()}),(d,e)=>{const U=r("el-breadcrumb-item"),B=r("el-breadcrumb"),m=r("el-button"),n=r("el-icon"),F=r("el-card"),b=r("el-table-column"),ie=r("el-tag"),L=r("el-table"),W=r("el-tab-pane"),me=r("el-tabs"),N=r("el-input"),g=r("el-form-item"),x=r("el-option"),q=r("el-select"),I=r("el-form"),E=r("el-dialog"),pe=r("el-alert");return k(),D("div",ke,[t(B,{separator:"›",class:"breadcrumb"},{default:l(()=>[t(U,{to:{path:"/products"}},{default:l(()=>[...e[18]||(e[18]=[s("产品管理",-1)])]),_:1}),t(U,null,{default:l(()=>[s(y(c.value.productName||"产品详情"),1)]),_:1})]),_:1}),o("div",Ce,[o("h1",xe,y(c.value.productName),1),o("div",Te,[t(m,{onClick:ue},{default:l(()=>[...e[19]||(e[19]=[s("← 返回列表",-1)])]),_:1}),t(m,{type:"primary",onClick:te},{default:l(()=>[...e[20]||(e[20]=[s("编辑产品",-1)])]),_:1})])]),t(F,{class:"info-card"},{header:l(()=>[o("div",ze,[t(n,{class:"header-icon"},{default:l(()=>[t(p(V))]),_:1}),e[21]||(e[21]=o("span",null,"基本信息",-1))])]),default:l(()=>[o("div",Me,[o("div",$e,[o("div",Pe,[e[22]||(e[22]=o("div",{class:"info-label"},"产品名称",-1)),o("div",De,y(c.value.productName||"-"),1)]),o("div",Ue,[e[23]||(e[23]=o("div",{class:"info-label"},"产品型号",-1)),o("div",Fe,y(c.value.productModel||"-"),1)]),o("div",Ae,[e[24]||(e[24]=o("div",{class:"info-label"},"协议类型",-1)),o("div",Se,y(c.value.protocol||"-"),1)])]),o("div",Re,[o("div",Be,[e[25]||(e[25]=o("div",{class:"info-label"},"创建时间",-1)),o("div",qe,y(G(c.value.createTime)),1)]),o("div",Ie,[e[26]||(e[26]=o("div",{class:"info-label"},"属性数量",-1)),o("div",Ee,y(w.value.length)+" 个",1)]),o("div",he,[e[27]||(e[27]=o("div",{class:"info-label"},"命令数量",-1)),o("div",He,y(z.value.length)+" 个",1)])]),c.value.description?(k(),D("div",Oe,[e[28]||(e[28]=o("div",{class:"info-label"},"产品描述",-1)),o("div",Qe,y(c.value.description),1)])):ge("",!0)])]),_:1}),t(F,{class:"tab-card"},{default:l(()=>[t(me,{modelValue:H.value,"onUpdate:modelValue":e[0]||(e[0]=a=>H.value=a)},{default:l(()=>[t(W,{label:"属性列表",name:"attributes"},{default:l(()=>[o("div",Je,[e[30]||(e[30]=o("div",{class:"tab-title"},"设备属性定义",-1)),t(m,{type:"primary",size:"small",onClick:ae},{default:l(()=>[t(n,null,{default:l(()=>[t(p(X))]),_:1}),e[29]||(e[29]=s("添加属性 ",-1))]),_:1})]),w.value.length===0?(k(),D("div",Le,[t(n,{class:"empty-icon",size:48},{default:l(()=>[t(p(ye))]),_:1}),e[31]||(e[31]=o("div",{class:"empty-text"},'暂无属性，点击"添加属性"开始定义数据点',-1))])):(k(),h(L,{key:1,data:w.value,stripe:"",size:"small",class:"attr-table"},{default:l(()=>[t(b,{prop:"addr",label:"标识符",width:"120"}),t(b,{prop:"attrName",label:"属性名称","min-width":"120"}),t(b,{prop:"dataType",label:"数据类型",width:"100"},{default:l(({row:a})=>[t(ie,{size:"small"},{default:l(()=>[s(y(a.dataType),1)]),_:2},1024)]),_:1}),t(b,{prop:"unit",label:"单位",width:"100"},{default:l(({row:a})=>[s(y(a.unit||"-"),1)]),_:1}),t(b,{label:"操作",width:"100",fixed:"right"},{default:l(({row:a})=>[t(m,{size:"small",type:"danger",link:"",onClick:ce=>de(a)},{default:l(()=>[...e[32]||(e[32]=[s("删除",-1)])]),_:1},8,["onClick"])]),_:1})]),_:1},8,["data"]))]),_:1}),t(W,{label:"命令列表",name:"commands"},{default:l(()=>[o("div",We,[e[34]||(e[34]=o("div",{class:"tab-title"},"设备命令定义",-1)),t(m,{type:"primary",size:"small",onClick:se},{default:l(()=>[t(n,null,{default:l(()=>[t(p(X))]),_:1}),e[33]||(e[33]=s("添加命令 ",-1))]),_:1})]),z.value.length===0?(k(),D("div",Xe,[t(n,{class:"empty-icon",size:48},{default:l(()=>[t(p(Ve))]),_:1}),e[35]||(e[35]=o("div",{class:"empty-text"},'暂无命令，点击"添加命令"开始定义控制指令',-1))])):(k(),h(L,{key:1,data:z.value,stripe:"",size:"small",class:"cmd-table"},{default:l(()=>[t(b,{prop:"commandName",label:"命令名称","min-width":"150"}),t(b,{prop:"addr",label:"控制属性",width:"120"}),t(b,{prop:"commandValue",label:"下发值",width:"120"}),t(b,{label:"操作",width:"100",fixed:"right"},{default:l(({row:a})=>[t(m,{size:"small",type:"danger",link:"",onClick:ce=>ne(a)},{default:l(()=>[...e[36]||(e[36]=[s("删除",-1)])]),_:1},8,["onClick"])]),_:1})]),_:1},8,["data"]))]),_:1})]),_:1},8,["modelValue"])]),_:1}),t(E,{modelValue:M.value,"onUpdate:modelValue":e[6]||(e[6]=a=>M.value=a),title:"编辑产品",width:"600px"},{footer:l(()=>[t(m,{onClick:e[5]||(e[5]=a=>M.value=!1)},{default:l(()=>[...e[38]||(e[38]=[s("取消",-1)])]),_:1}),t(m,{type:"primary",onClick:le},{default:l(()=>[...e[39]||(e[39]=[s("保存修改",-1)])]),_:1})]),default:l(()=>[t(I,{model:i.value,"label-width":"120px",rules:K,ref_key:"editFormRef",ref:A},{default:l(()=>[t(g,{label:"产品名称",prop:"productName"},{default:l(()=>[t(N,{modelValue:i.value.productName,"onUpdate:modelValue":e[1]||(e[1]=a=>i.value.productName=a),placeholder:"请输入产品名称"},null,8,["modelValue"])]),_:1}),t(g,{label:"产品型号",prop:"productModel"},{default:l(()=>[t(N,{modelValue:i.value.productModel,"onUpdate:modelValue":e[2]||(e[2]=a=>i.value.productModel=a),disabled:""},null,8,["modelValue"]),o("div",Ye,[t(n,{class:"hint-icon",size:14},{default:l(()=>[t(p(V))]),_:1}),e[37]||(e[37]=s(" 产品型号创建后不可修改 ",-1))])]),_:1}),t(g,{label:"协议类型",prop:"protocol"},{default:l(()=>[t(q,{modelValue:i.value.protocol,"onUpdate:modelValue":e[3]||(e[3]=a=>i.value.protocol=a),placeholder:"请选择协议类型",style:{width:"100%"}},{default:l(()=>[t(x,{label:"MQTT",value:"MQTT"}),t(x,{label:"HTTP",value:"HTTP"}),t(x,{label:"CoAP",value:"CoAP"}),t(x,{label:"Modbus",value:"Modbus"})]),_:1},8,["modelValue"])]),_:1}),t(g,{label:"产品描述"},{default:l(()=>[t(N,{modelValue:i.value.description,"onUpdate:modelValue":e[4]||(e[4]=a=>i.value.description=a),type:"textarea",rows:4,placeholder:"请输入产品描述"},null,8,["modelValue"])]),_:1})]),_:1},8,["model"])]),_:1},8,["modelValue"]),t(E,{modelValue:$.value,"onUpdate:modelValue":e[12]||(e[12]=a=>$.value=a),title:"添加产品属性",width:"600px"},{footer:l(()=>[t(m,{onClick:e[11]||(e[11]=a=>$.value=!1)},{default:l(()=>[...e[44]||(e[44]=[s("取消",-1)])]),_:1}),t(m,{type:"primary",onClick:oe},{default:l(()=>[...e[45]||(e[45]=[s("确定添加",-1)])]),_:1})]),default:l(()=>[t(I,{model:u.value,"label-width":"120px",rules:Z,ref_key:"attrFormRef",ref:S},{default:l(()=>[t(g,{label:"属性标识符",prop:"addr"},{default:l(()=>[t(N,{modelValue:u.value.addr,"onUpdate:modelValue":e[7]||(e[7]=a=>u.value.addr=a),placeholder:"如：tem、hum、battery"},null,8,["modelValue"]),o("div",je,[t(n,{class:"hint-icon",size:14},{default:l(()=>[t(p(V))]),_:1}),e[40]||(e[40]=s(" 英文标识符，用于数据上报的字段名，建议使用小写字母+下划线 ",-1))])]),_:1}),t(g,{label:"属性名称",prop:"attrName"},{default:l(()=>[t(N,{modelValue:u.value.attrName,"onUpdate:modelValue":e[8]||(e[8]=a=>u.value.attrName=a),placeholder:"如：温度、湿度、电池电量"},null,8,["modelValue"]),o("div",Ge,[t(n,{class:"hint-icon",size:14},{default:l(()=>[t(p(V))]),_:1}),e[41]||(e[41]=s(" 中文显示名称，方便理解属性含义 ",-1))])]),_:1}),t(g,{label:"数据类型",prop:"dataType"},{default:l(()=>[t(q,{modelValue:u.value.dataType,"onUpdate:modelValue":e[9]||(e[9]=a=>u.value.dataType=a),placeholder:"请选择数据类型",style:{width:"100%"}},{default:l(()=>[t(x,{label:"整数 (int) - 如状态、计数",value:"int"}),t(x,{label:"浮点数 (float) - 如温度、湿度",value:"float"})]),_:1},8,["modelValue"]),o("div",Ke,[t(n,{class:"hint-icon",size:14},{default:l(()=>[t(p(V))]),_:1}),e[42]||(e[42]=s(" 选择合适的数据类型，影响数据存储和处理方式 ",-1))])]),_:1}),t(g,{label:"单位"},{default:l(()=>[t(N,{modelValue:u.value.unit,"onUpdate:modelValue":e[10]||(e[10]=a=>u.value.unit=a),placeholder:"如：℃、%、m/s（可选）"},null,8,["modelValue"]),o("div",Ze,[t(n,{class:"hint-icon",size:14},{default:l(()=>[t(p(V))]),_:1}),e[43]||(e[43]=s(" 数值属性可填写单位，非数值属性可留空 ",-1))])]),_:1})]),_:1},8,["model"])]),_:1},8,["modelValue"]),t(E,{modelValue:P.value,"onUpdate:modelValue":e[17]||(e[17]=a=>P.value=a),title:"添加产品命令",width:"600px"},{footer:l(()=>[t(m,{onClick:e[16]||(e[16]=a=>P.value=!1)},{default:l(()=>[...e[55]||(e[55]=[s("取消",-1)])]),_:1}),t(m,{type:"primary",onClick:re},{default:l(()=>[...e[56]||(e[56]=[s("确定添加",-1)])]),_:1})]),default:l(()=>[t(I,{model:v.value,"label-width":"120px",rules:ee,ref_key:"cmdFormRef",ref:R},{default:l(()=>[t(g,{label:"命令名称",prop:"commandName"},{default:l(()=>[t(N,{modelValue:v.value.commandName,"onUpdate:modelValue":e[13]||(e[13]=a=>v.value.commandName=a),placeholder:"如：打开窗户、关闭灯光、设置模式"},null,8,["modelValue"]),o("div",et,[t(n,{class:"hint-icon",size:14},{default:l(()=>[t(p(V))]),_:1}),e[46]||(e[46]=s(" 命令的显示名称，让用户知道这是什么操作 ",-1))])]),_:1}),t(g,{label:"控制属性",prop:"addr"},{default:l(()=>[t(q,{modelValue:v.value.addr,"onUpdate:modelValue":e[14]||(e[14]=a=>v.value.addr=a),placeholder:"请选择要控制的属性",style:{width:"100%"}},{default:l(()=>[(k(!0),D(we,null,Ne(w.value,a=>(k(),h(x,{key:a.addr,label:`${a.attrName} (${a.addr})`,value:a.addr},null,8,["label","value"]))),128))]),_:1},8,["modelValue"]),o("div",tt,[t(n,{class:"hint-icon",size:14},{default:l(()=>[t(p(V))]),_:1}),e[47]||(e[47]=s(" 选择要控制的属性，命令会修改该属性的值 ",-1))])]),_:1}),t(g,{label:"下发值",prop:"commandValue"},{default:l(()=>[t(N,{modelValue:v.value.commandValue,"onUpdate:modelValue":e[15]||(e[15]=a=>v.value.commandValue=a),placeholder:"如：1、0、ON、OFF"},null,8,["modelValue"]),o("div",lt,[t(n,{class:"hint-icon",size:14},{default:l(()=>[t(p(V))]),_:1}),e[48]||(e[48]=s(" 命令执行时会将该值下发给设备，设备根据该值进行操作 ",-1))])]),_:1}),t(pe,{type:"info",closable:!1},{title:l(()=>[o("div",at,[t(n,{class:"alert-icon",size:16},{default:l(()=>[t(p(V))]),_:1}),e[49]||(e[49]=s(" 示例 ",-1))])]),default:l(()=>[e[50]||(e[50]=s(' 如果有一个属性叫 "window"，可以创建两个命令：',-1)),e[51]||(e[51]=o("br",null,null,-1)),e[52]||(e[52]=s(" • 命令名：打开窗户 | 控制属性：window | 下发值：1",-1)),e[53]||(e[53]=o("br",null,null,-1)),e[54]||(e[54]=s(" • 命令名：关闭窗户 | 控制属性：window | 下发值：0 ",-1))]),_:1})]),_:1},8,["model"])]),_:1},8,["modelValue"])])}}},nt=ve(ot,[["__scopeId","data-v-2260aac9"]]);export{nt as default};
