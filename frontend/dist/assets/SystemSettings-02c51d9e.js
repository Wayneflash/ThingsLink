import{_ as S,r as b,b as y,z as D,c,o as E,d as F,e,g as s,w as l,E as p,i as m,a9 as A,p as Z,j as N,q as x,a7 as Q,a8 as V,T as B,s as $,X as T}from"./index-84c82c57.js";import{a as j,u as X,b as G}from"./system-50599141.js";const H={class:"settings-container"},J={class:"page-header"},K={class:"header-left"},L={class:"header-icon-wrapper"},O={class:"header-badge"},W={class:"card-header"},Y={class:"card-header-left"},tt={class:"card-icon-wrapper card-icon-info"},et={class:"form-grid"},st={class:"form-item-content"},ot={class:"form-item-content"},lt={class:"form-item-content"},rt={class:"form-item-content"},at={class:"form-actions"},nt={class:"config-note"},it={class:"note-header"},mt={class:"card-header"},dt={class:"card-header-left"},ut={class:"card-icon-wrapper card-icon-success"},ct={class:"form-grid"},ft={class:"form-item-content"},pt={class:"form-item-content"},gt={class:"form-item-content"},qt={class:"form-item-content"},Tt={class:"form-item-content"},_t={class:"form-actions"},vt={class:"config-note config-note-success"},bt={class:"note-header"},Mt={__name:"SystemSettings",setup(wt){const _=b(null),v=b(null),g=b(!1),a=y({mqttBroker:"localhost",mqttPort:1883,mqttUsername:"admin",mqttPassword:"admin123."}),r=y({mqttBroker:"localhost",mqttPort:1883,mqttClientId:"iot-platform-server",mqttUsername:"admin",mqttPassword:"admin123."}),C={mqttBroker:[{required:!0,message:"MQTT地址不能为空",trigger:"blur"},{validator:(n,t,o)=>{t&&t.trim()?/^([a-zA-Z0-9-]+\.)+[a-zA-Z]{2,}|(\d{1,3}\.){3}\d{1,3}$/.test(t.trim())?o():o(new Error("请输入有效的IP地址或域名")):o()},trigger:"blur"}],mqttPort:[{required:!0,message:"MQTT端口不能为空",trigger:"blur"},{type:"number",message:"端口必须是数字",trigger:"blur"},{validator:(n,t,o)=>{t&&(t<1||t>65535)?o(new Error("端口范围必须在1-65535之间")):o()},trigger:"blur"}],mqttUsername:[{required:!0,message:"用户名不能为空",trigger:"blur"},{min:1,max:50,message:"用户名长度在1-50个字符",trigger:"blur"}],mqttPassword:[{required:!0,message:"密码不能为空",trigger:"blur"},{min:1,max:50,message:"密码长度在1-50个字符",trigger:"blur"}],mqttClientId:[{required:!0,message:"Client ID不能为空",trigger:"blur"},{min:1,max:100,message:"Client ID长度在1-100个字符",trigger:"blur"}]},h={mqttBroker:[{required:!0,message:"MQTT地址不能为空",trigger:"blur"},{validator:(n,t,o)=>{t&&t.trim()?/^([a-zA-Z0-9-]+\.)+[a-zA-Z]{2,}|(\d{1,3}\.){3}\d{1,3}$/.test(t.trim())?o():o(new Error("请输入有效的IP地址或域名")):o()},trigger:"blur"}],mqttPort:[{required:!0,message:"MQTT端口不能为空",trigger:"blur"},{type:"number",message:"端口必须是数字",trigger:"blur"},{validator:(n,t,o)=>{t&&(t<1||t>65535)?o(new Error("端口范围必须在1-65535之间")):o()},trigger:"blur"}],mqttUsername:[{required:!0,message:"用户名不能为空",trigger:"blur"},{min:1,max:50,message:"用户名长度在1-50个字符",trigger:"blur"}],mqttPassword:[{required:!0,message:"密码不能为空",trigger:"blur"},{min:1,max:50,message:"密码长度在1-50个字符",trigger:"blur"}],mqttClientId:[{required:!0,message:"Client ID不能为空",trigger:"blur"},{min:1,max:100,message:"Client ID长度在1-100个字符",trigger:"blur"}]},U=async()=>{try{const n=await j();if(n){if(n.mqttConfig){const t=n.mqttConfig;a.mqttBroker=t.broker||"localhost",a.mqttPort=t.port||1883,a.mqttUsername=t.username||"admin",a.mqttPassword=t.password||"admin123."}if(n.platformMqttConfig){const t=n.platformMqttConfig;r.mqttBroker=t.broker||"localhost",r.mqttPort=t.port||1883,r.mqttClientId=t.clientId||"iot-platform-server",r.mqttUsername=t.username||"admin",r.mqttPassword=t.password||"admin123."}}}catch(n){console.error("加载系统配置失败:",n),p.error("加载系统配置失败")}},k=async()=>{var n,t;try{await _.value.validate(),await T.confirm("确定要保存设备MQTT配置吗？此配置仅用于在设备详情页显示。","保存确认",{confirmButtonText:"确定保存",cancelButtonText:"取消",type:"warning"}),g.value=!0;const o={deviceMqttBroker:a.mqttBroker,deviceMqttPort:a.mqttPort,deviceMqttUsername:a.mqttUsername,deviceMqttPassword:a.mqttPassword};await X(o),p.success("设备MQTT配置保存成功！")}catch(o){if(o!=="cancel"){console.error("保存设备MQTT配置失败:",o);const u=((t=(n=o==null?void 0:o.response)==null?void 0:n.data)==null?void 0:t.message)||(o==null?void 0:o.message)||"保存失败";p.error(u)}}finally{g.value=!1}},I=async()=>{try{await T.confirm("确定要重置为默认配置吗？","重置确认",{confirmButtonText:"确定重置",cancelButtonText:"取消",type:"warning"}),a.mqttBroker="localhost",a.mqttPort=1883,a.mqttUsername="admin",a.mqttPassword="admin123.",_.value.clearValidate(),p.success("已重置为默认配置")}catch{}},z=async()=>{var n,t;try{await v.value.validate(),await T.confirm("确定要保存平台MQTT配置吗？保存后MQTT连接会自动使用新配置重新连接。","保存确认",{confirmButtonText:"确定保存",cancelButtonText:"取消",type:"warning"}),g.value=!0;const o={platformMqttBroker:r.mqttBroker,platformMqttPort:r.mqttPort,platformMqttClientId:r.mqttClientId,platformMqttUsername:r.mqttUsername,platformMqttPassword:r.mqttPassword};await G(o),p.success("平台MQTT配置保存成功！MQTT连接已使用新配置重新连接")}catch(o){if(o!=="cancel"){console.error("保存平台MQTT配置失败:",o);const u=((t=(n=o==null?void 0:o.response)==null?void 0:n.data)==null?void 0:t.message)||(o==null?void 0:o.message)||"保存失败";p.error(u)}}finally{g.value=!1}},R=async()=>{try{await T.confirm("确定要重置为默认配置吗？","重置确认",{confirmButtonText:"确定重置",cancelButtonText:"取消",type:"warning"}),r.mqttBroker="localhost",r.mqttPort=1883,r.mqttUsername="admin",r.mqttPassword="admin123.",v.value.clearValidate(),p.success("已重置为默认配置")}catch{}};return D(()=>{U()}),(n,t)=>{const o=c("el-icon"),u=c("el-tag"),f=c("el-input"),d=c("el-form-item"),M=c("el-input-number"),q=c("el-button"),w=c("el-form"),P=c("el-card");return E(),F("div",H,[e("div",J,[e("div",K,[e("div",L,[s(o,{size:24,class:"header-icon"},{default:l(()=>[s(m(A))]),_:1})]),t[9]||(t[9]=e("div",{class:"header-content"},[e("h1",{class:"page-title"},"系统设置"),e("p",{class:"page-subtitle"},"设备连接与平台MQTT配置管理")],-1))]),e("div",O,[s(o,{size:16,class:"badge-icon"},{default:l(()=>[s(m(Z))]),_:1}),t[10]||(t[10]=e("span",{class:"badge-text"},"仅管理员可访问",-1))])]),s(P,{class:"config-card"},{header:l(()=>[e("div",W,[e("div",Y,[e("div",tt,[s(o,{size:20,class:"card-icon"},{default:l(()=>[s(m(N))]),_:1})]),t[11]||(t[11]=e("div",null,[e("h3",{class:"card-title"},"设备连接MQTT配置"),e("p",{class:"card-subtitle"},"设备端连接参数（仅用于显示）")],-1))]),s(u,{type:"info",size:"small",class:"status-tag"},{default:l(()=>[...t[12]||(t[12]=[x(" 仅用于显示 ",-1)])]),_:1})])]),default:l(()=>[s(w,{ref_key:"deviceFormRef",ref:_,model:a,rules:C,"label-width":"100px","label-position":"left",class:"config-form"},{default:l(()=>[e("div",et,[s(d,{label:"MQTT地址",prop:"mqttBroker",class:"form-item form-item-inline"},{default:l(()=>[e("div",st,[s(f,{modelValue:a.mqttBroker,"onUpdate:modelValue":t[0]||(t[0]=i=>a.mqttBroker=i),placeholder:"例如: 192.168.1.100",maxlength:"255",class:"form-input"},{prepend:l(()=>[...t[13]||(t[13]=[e("span",{class:"input-prepend"},"tcp://",-1)])]),_:1},8,["modelValue"]),t[14]||(t[14]=e("span",{class:"form-hint-inline"},"设备连接的MQTT服务器地址（仅用于在设备详情页显示）",-1))])]),_:1}),s(d,{label:"MQTT端口",prop:"mqttPort",class:"form-item form-item-inline"},{default:l(()=>[e("div",ot,[s(M,{modelValue:a.mqttPort,"onUpdate:modelValue":t[1]||(t[1]=i=>a.mqttPort=i),min:1,max:65535,placeholder:"例如: 1883","controls-position":"right",class:"form-input-number"},null,8,["modelValue"]),t[15]||(t[15]=e("span",{class:"form-hint-inline"},"MQTT服务器端口号（仅用于在设备详情页显示）",-1))])]),_:1}),s(d,{label:"用户名",prop:"mqttUsername",class:"form-item form-item-inline"},{default:l(()=>[e("div",lt,[s(f,{modelValue:a.mqttUsername,"onUpdate:modelValue":t[2]||(t[2]=i=>a.mqttUsername=i),placeholder:"MQTT连接用户名",maxlength:"50",class:"form-input"},null,8,["modelValue"]),t[16]||(t[16]=e("span",{class:"form-hint-inline"},"设备连接时使用的用户名（仅用于在设备详情页显示）",-1))])]),_:1}),s(d,{label:"密码",prop:"mqttPassword",class:"form-item form-item-inline"},{default:l(()=>[e("div",rt,[s(f,{modelValue:a.mqttPassword,"onUpdate:modelValue":t[3]||(t[3]=i=>a.mqttPassword=i),type:"password","show-password":"",placeholder:"MQTT连接密码",maxlength:"50",class:"form-input"},null,8,["modelValue"]),t[17]||(t[17]=e("span",{class:"form-hint-inline"},"设备连接时使用的密码（仅用于在设备详情页显示）",-1))])]),_:1})]),e("div",at,[s(q,{type:"primary",onClick:k,loading:g.value,class:"action-button action-button-primary"},{default:l(()=>[s(o,{class:"button-icon"},{default:l(()=>[s(m(Q))]),_:1}),t[18]||(t[18]=e("span",null,"保存配置",-1))]),_:1},8,["loading"]),s(q,{onClick:I,class:"action-button action-button-secondary"},{default:l(()=>[s(o,{class:"button-icon"},{default:l(()=>[s(m(V))]),_:1}),t[19]||(t[19]=e("span",null,"重置为默认",-1))]),_:1})])]),_:1},8,["model"]),e("div",nt,[e("div",it,[s(o,{size:16,class:"note-icon"},{default:l(()=>[s(m(B))]),_:1}),t[20]||(t[20]=e("strong",{class:"note-title"},"配置说明",-1))]),t[21]||(t[21]=e("ul",{class:"note-list"},[e("li",null,"此配置为设备连接MQTT服务器时使用的连接信息，仅用于在设备详情页显示"),e("li",null,"配置信息保存到数据库，用户根据此配置在设备端设置MQTT连接参数"),e("li",null,"部署到公网时，请将MQTT地址修改为公网IP或域名，确保防火墙已开放MQTT端口（默认1883）")],-1))])]),_:1}),s(P,{class:"config-card"},{header:l(()=>[e("div",mt,[e("div",dt,[e("div",ut,[s(o,{size:20,class:"card-icon"},{default:l(()=>[s(m($))]),_:1})]),t[22]||(t[22]=e("div",null,[e("h3",{class:"card-title"},"平台连接MQTT配置"),e("p",{class:"card-subtitle"},"平台订阅设备数据连接参数")],-1))]),s(u,{type:"success",size:"small",class:"status-tag"},{default:l(()=>[...t[23]||(t[23]=[x(" 支持动态重新连接 ",-1)])]),_:1})])]),default:l(()=>[s(w,{ref_key:"platformFormRef",ref:v,model:r,rules:h,"label-width":"100px","label-position":"left",class:"config-form"},{default:l(()=>[e("div",ct,[s(d,{label:"MQTT地址",prop:"mqttBroker",class:"form-item form-item-inline"},{default:l(()=>[e("div",ft,[s(f,{modelValue:r.mqttBroker,"onUpdate:modelValue":t[4]||(t[4]=i=>r.mqttBroker=i),placeholder:"例如: 192.168.1.100",maxlength:"255",class:"form-input"},{prepend:l(()=>[...t[24]||(t[24]=[e("span",{class:"input-prepend"},"tcp://",-1)])]),_:1},8,["modelValue"]),t[25]||(t[25]=e("span",{class:"form-hint-inline"},"平台连接的MQTT服务器地址，用于订阅设备上报数据",-1))])]),_:1}),s(d,{label:"MQTT端口",prop:"mqttPort",class:"form-item form-item-inline"},{default:l(()=>[e("div",pt,[s(M,{modelValue:r.mqttPort,"onUpdate:modelValue":t[5]||(t[5]=i=>r.mqttPort=i),min:1,max:65535,placeholder:"例如: 1883","controls-position":"right",class:"form-input-number"},null,8,["modelValue"]),t[26]||(t[26]=e("span",{class:"form-hint-inline"},"MQTT服务器端口号，用于订阅设备上报数据",-1))])]),_:1}),s(d,{label:"Client ID",prop:"mqttClientId",class:"form-item form-item-inline"},{default:l(()=>[e("div",gt,[s(f,{modelValue:r.mqttClientId,"onUpdate:modelValue":t[6]||(t[6]=i=>r.mqttClientId=i),placeholder:"例如: iot-platform-server",maxlength:"100",class:"form-input"},null,8,["modelValue"]),t[27]||(t[27]=e("span",{class:"form-hint-inline"},"平台连接MQTT时使用的客户端ID",-1))])]),_:1}),s(d,{label:"用户名",prop:"mqttUsername",class:"form-item form-item-inline"},{default:l(()=>[e("div",qt,[s(f,{modelValue:r.mqttUsername,"onUpdate:modelValue":t[7]||(t[7]=i=>r.mqttUsername=i),placeholder:"MQTT连接用户名",maxlength:"50",class:"form-input"},null,8,["modelValue"]),t[28]||(t[28]=e("span",{class:"form-hint-inline"},"平台连接时使用的用户名，用于订阅设备上报数据",-1))])]),_:1}),s(d,{label:"密码",prop:"mqttPassword",class:"form-item form-item-inline"},{default:l(()=>[e("div",Tt,[s(f,{modelValue:r.mqttPassword,"onUpdate:modelValue":t[8]||(t[8]=i=>r.mqttPassword=i),type:"password","show-password":"",placeholder:"MQTT连接密码",maxlength:"50",class:"form-input"},null,8,["modelValue"]),t[29]||(t[29]=e("span",{class:"form-hint-inline"},"平台连接时使用的密码，用于订阅设备上报数据",-1))])]),_:1})]),e("div",_t,[s(q,{type:"primary",onClick:z,loading:g.value,class:"action-button action-button-primary"},{default:l(()=>[s(o,{class:"button-icon"},{default:l(()=>[s(m(Q))]),_:1}),t[30]||(t[30]=e("span",null,"保存配置",-1))]),_:1},8,["loading"]),s(q,{onClick:R,class:"action-button action-button-secondary"},{default:l(()=>[s(o,{class:"button-icon"},{default:l(()=>[s(m(V))]),_:1}),t[31]||(t[31]=e("span",null,"重置为默认",-1))]),_:1})])]),_:1},8,["model"]),e("div",vt,[e("div",bt,[s(o,{size:16,class:"note-icon"},{default:l(()=>[s(m(B))]),_:1}),t[32]||(t[32]=e("strong",{class:"note-title"},"配置说明",-1))]),t[33]||(t[33]=e("ul",{class:"note-list"},[e("li",null,"此配置为平台连接MQTT服务器时使用的连接信息，持久化保存到数据库"),e("li",null,"保存配置后，MQTT连接会自动使用新配置重新连接，无需重启后端"),e("li",null,"部署到公网时，请将MQTT地址修改为公网IP或域名，确保防火墙已开放MQTT端口（默认1883）")],-1))])]),_:1})])}}},xt=S(Mt,[["__scopeId","data-v-5fc18516"]]);export{xt as default};
