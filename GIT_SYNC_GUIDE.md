# Git 代码同步指南

## 🎯 目标
确保两台电脑的代码完全一致，避免代码不同步的问题。

---

## 📤 推送代码（git-push.bat）

### 功能说明
- ✅ **智能检测**：自动检测并排除编译文件
- ✅ **只提交源代码**：确保不提交 `target/`、`node_modules/.vite/` 等编译文件
- ✅ **自动备份数据库**：如果 Docker 容器运行，自动备份数据库
- ✅ **完整提交**：确保所有源代码文件都被提交

### 使用方法
1. 双击运行 `git-push.bat`
2. 输入提交信息（或直接回车使用默认信息）
3. 脚本会自动：
   - 备份数据库（如果 Docker 运行）
   - 检查并移除编译文件
   - 添加所有源代码文件
   - 提交并推送到 GitHub

### 提交的文件类型
- ✅ `frontend/src/` - Vue 前端源代码
- ✅ `backend/src/` - Java 后端源代码
- ✅ `init.sql` - 数据库初始化脚本
- ✅ `.cursorrules` - 开发规范
- ✅ `*.bat` - 批处理脚本
- ✅ `*.md` - 文档文件
- ✅ `*.py` - Python 脚本
- ✅ `prototypes/` - 原型文件
- ✅ `backups/iot_platform_latest.sql` - 最新数据库备份

### 不提交的文件（自动排除）
- ❌ `backend/target/` - Maven 编译输出
- ❌ `frontend/node_modules/.vite/` - Vite 编译缓存
- ❌ `*.class` - Java 编译文件
- ❌ `*.jar` - Java 打包文件
- ❌ `*.log` - 日志文件

---

## 📥 拉取代码（git-pull.bat）

### 功能说明
- ✅ **智能拉取**：自动拉取最新代码
- ✅ **冲突处理**：检测本地修改，自动暂存
- ✅ **清理编译文件**：确保不跟踪编译文件
- ✅ **状态检查**：显示当前代码状态

### 使用方法
1. 双击运行 `git-pull.bat`
2. 脚本会自动：
   - 检测本地修改（如有，建议暂存）
   - 拉取最新代码
   - 合并远程代码
   - 恢复本地修改（如有）
   - 清理编译文件

### 冲突处理
如果出现合并冲突：
1. 脚本会显示冲突文件
2. 手动解决冲突后：
   ```bash
   git add .
   git commit -m "Resolve merge conflicts"
   git push origin main
   ```

---

## 🔄 完整同步流程

### 电脑A（开发电脑）
```bash
1. 修改代码
2. 运行 git-push.bat
3. 输入提交信息
4. 等待推送完成
```

### 电脑B（另一台电脑）
```bash
1. 运行 git-pull.bat
2. 如有本地修改，选择暂存（y）
3. 等待拉取完成
4. 运行 start-all-services.bat 启动服务
```

---

## ⚠️ 重要注意事项

### 1. 只提交源代码
- ✅ **必须提交**：所有 `.java`、`.vue`、`.js`、`.sql` 等源代码文件
- ❌ **不要提交**：编译文件、依赖包、日志文件

### 2. 提交前检查
运行 `git-push.bat` 前，可以手动检查：
```bash
git status
```
确保没有编译文件被意外添加。

### 3. 拉取后检查
运行 `git-pull.bat` 后，检查：
```bash
git status
```
确保代码已同步，没有冲突。

### 4. 冲突解决
如果出现冲突：
1. 查看冲突文件：`git status`
2. 手动解决冲突
3. 提交解决：`git add . && git commit -m "Resolve conflicts"`
4. 推送：`git push origin main`

---

## 🛠️ 故障排除

### 问题1：推送失败
**原因**：网络问题或权限问题
**解决**：
- 检查网络连接
- 检查 GitHub 凭证
- 尝试强制推送（脚本会询问）

### 问题2：拉取失败
**原因**：本地有未提交的修改
**解决**：
- 选择暂存本地修改（y）
- 或手动提交本地修改后再拉取

### 问题3：代码不一致
**原因**：编译文件被提交
**解决**：
1. 运行 `git-pull.bat`（会自动清理）
2. 或手动执行：
   ```bash
   git rm -r --cached backend/target/
   git rm -r --cached frontend/node_modules/.vite/
   git commit -m "Remove compiled files"
   git push origin main
   ```

---

## 📋 检查清单

### 推送前检查
- [ ] 代码已测试通过
- [ ] 没有编译文件被修改
- [ ] 重要文件已保存
- [ ] 提交信息清晰

### 拉取后检查
- [ ] 代码已同步
- [ ] 没有冲突
- [ ] 编译文件已清理
- [ ] 服务可以正常启动

---

## 💡 最佳实践

1. **频繁提交**：每次完成一个小功能就提交
2. **清晰提交信息**：描述清楚做了什么修改
3. **拉取前提交**：在拉取前先提交本地修改
4. **定期同步**：每天开始工作前先拉取最新代码
5. **检查状态**：提交/拉取后检查 `git status`

---

**记住：只提交源代码，不提交编译文件！**
