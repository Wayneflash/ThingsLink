# æ•°æ®åº“å¤‡ä»½å’Œæ¢å¤ - å¿«é€ŸæŒ‡å—

## ğŸ¯ é—®é¢˜ï¼šä¸ºä»€ä¹ˆæ•°æ®ä¼šä¸¢å¤±ï¼Ÿ

**åŸå› ï¼š**
- ä½¿ç”¨ `docker-compose down -v` ä¼šåˆ é™¤æ•°æ®å·ï¼Œæ•°æ®ä¸¢å¤±
- é‡æ–°åˆ›å»ºå®¹å™¨æ—¶ï¼Œå¦‚æœæ•°æ®å·ä¸å­˜åœ¨ï¼Œä¼šæ‰§è¡Œ `init.sql` é‡ç½®æ•°æ®åº“

**è§£å†³æ–¹æ¡ˆï¼š**
1. âœ… ä½¿ç”¨æ•°æ®å·æŒä¹…åŒ–ï¼ˆå·²é…ç½®ï¼‰
2. âœ… å®šæœŸå¤‡ä»½æ•°æ®åº“
3. âœ… éœ€è¦æ—¶æ¢å¤å¤‡ä»½

---

## ğŸ’¾ å¤‡ä»½æ•°æ®åº“ï¼ˆ3ç§æ–¹æ³•ï¼‰

### æ–¹æ³•1ï¼šæ‰‹åŠ¨å¤‡ä»½ï¼ˆæœ€ç®€å•ï¼‰

```bash
# 1. åˆ›å»ºå¤‡ä»½ç›®å½•ï¼ˆå¦‚æœä¸å­˜åœ¨ï¼‰
mkdir backups

# 2. æ‰§è¡Œå¤‡ä»½
docker exec iot-mysql mysqldump -uroot -proot123456 --single-transaction --routines --triggers iot_platform > backups\iot_platform_latest.sql
```

**å¤‡ä»½æ–‡ä»¶ä½ç½®ï¼š** `backups\iot_platform_latest.sql`

---

### æ–¹æ³•2ï¼šä½¿ç”¨å¤‡ä»½è„šæœ¬

```bash
# åŒå‡»è¿è¡Œ
backup-database.bat
```

**åŠŸèƒ½ï¼š**
- è‡ªåŠ¨æ£€æµ‹MySQLå®¹å™¨
- è‡ªåŠ¨åˆ›å»ºå¤‡ä»½ç›®å½•
- ç”Ÿæˆå¤‡ä»½æ–‡ä»¶

---

### æ–¹æ³•3ï¼šä½¿ç”¨git-push.batï¼ˆè‡ªåŠ¨å¤‡ä»½ï¼‰

```bash
# git-push.bat ä¼šè‡ªåŠ¨å¤‡ä»½æ•°æ®åº“
git-push.bat
```

**å¤‡ä»½ä½ç½®ï¼š** `backups\iot_platform_latest.sql`

---

## ğŸ“¥ æ¢å¤æ•°æ®åº“ï¼ˆ2ç§æ–¹æ³•ï¼‰

### æ–¹æ³•1ï¼šæ‰‹åŠ¨æ¢å¤

```bash
# 1. åˆ é™¤å¹¶é‡æ–°åˆ›å»ºæ•°æ®åº“
docker exec iot-mysql mysql -uroot -proot123456 -e "DROP DATABASE IF EXISTS iot_platform;"
docker exec iot-mysql mysql -uroot -proot123456 -e "CREATE DATABASE iot_platform CHARACTER SET utf8mb4 COLLATE utf8mb4_unicode_ci;"

# 2. æ¢å¤å¤‡ä»½
docker exec -i iot-mysql mysql -uroot -proot123456 iot_platform < backups\iot_platform_latest.sql
```

---

### æ–¹æ³•2ï¼šä½¿ç”¨æ¢å¤è„šæœ¬

```bash
# æ¢å¤æœ€æ–°å¤‡ä»½
restore-database.bat

# æ¢å¤æŒ‡å®šæ–‡ä»¶
restore-database.bat backups\iot_platform_latest.sql
```

---

## ğŸ”„ å¸¸è§åœºæ™¯

### åœºæ™¯1ï¼šæ­£å¸¸é‡å¯ï¼ˆæ•°æ®ä¿ç•™ï¼‰âœ…

```bash
# åœæ­¢å®¹å™¨ï¼ˆä¿ç•™æ•°æ®å·ï¼‰
docker-compose down

# å¯åŠ¨å®¹å™¨ï¼ˆæ•°æ®è¿˜åœ¨ï¼‰
docker-compose up -d
```

**æ•°æ®ä¸ä¼šä¸¢å¤±**

---

### åœºæ™¯2ï¼šåˆ é™¤æ•°æ®å·ï¼ˆæ•°æ®ä¸¢å¤±ï¼‰âŒ

```bash
# âš ï¸ è¿™ä¼šåˆ é™¤æ‰€æœ‰æ•°æ®ï¼
docker-compose down -v

# é‡æ–°åˆ›å»ºï¼ˆä¼šæ‰§è¡Œinit.sqlï¼Œæ•°æ®è¢«é‡ç½®ï¼‰
docker-compose up -d
```

**æ•°æ®ä¼šä¸¢å¤±ï¼**

**è§£å†³æ–¹æ¡ˆï¼š**
1. å…ˆå¤‡ä»½ï¼š`backup-database.bat` æˆ–æ‰‹åŠ¨å¤‡ä»½
2. åˆ é™¤å®¹å™¨ï¼š`docker-compose down -v`
3. é‡æ–°åˆ›å»ºï¼š`docker-compose up -d`
4. æ¢å¤æ•°æ®ï¼š`restore-database.bat`

---

### åœºæ™¯3ï¼šè¿ç§»åˆ°å…¶ä»–ç”µè„‘

```bash
# åœ¨æ—§ç”µè„‘ä¸Š
backup-database.bat
# æˆ–æ‰‹åŠ¨å¤‡ä»½
docker exec iot-mysql mysqldump -uroot -proot123456 --single-transaction iot_platform > backups\iot_platform_latest.sql

# å¤åˆ¶å¤‡ä»½æ–‡ä»¶åˆ°æ–°ç”µè„‘
# backups\iot_platform_latest.sql

# åœ¨æ–°ç”µè„‘ä¸Š
docker-compose up -d
restore-database.bat
```

---

## ğŸ“‹ é‡è¦æç¤º

### âœ… ä¿æŠ¤æ•°æ®çš„åšæ³•

1. **ä¸è¦ä½¿ç”¨ `docker-compose down -v`**
   - è¿™ä¼šåˆ é™¤æ•°æ®å·ï¼Œæ•°æ®ä¼šä¸¢å¤±

2. **ä½¿ç”¨ `docker-compose down`**
   - åªåœæ­¢å®¹å™¨ï¼Œæ•°æ®å·ä¿ç•™

3. **å®šæœŸå¤‡ä»½**
   - é‡è¦æ“ä½œå‰å¤‡ä»½
   - æ¯å¤©å¤‡ä»½ä¸€æ¬¡

4. **å¤‡ä»½æ–‡ä»¶ä½ç½®**
   - `backups\iot_platform_latest.sql`
   - å»ºè®®ä¿ç•™å¤šä¸ªå†å²å¤‡ä»½

---

## ğŸ› ï¸ å¿«é€Ÿå‘½ä»¤

```bash
# å¤‡ä»½æ•°æ®åº“
docker exec iot-mysql mysqldump -uroot -proot123456 --single-transaction iot_platform > backups\iot_platform_latest.sql

# æ¢å¤æ•°æ®åº“
docker exec -i iot-mysql mysql -uroot -proot123456 iot_platform < backups\iot_platform_latest.sql

# æŸ¥çœ‹å¤‡ä»½æ–‡ä»¶
dir backups\

# åœæ­¢å®¹å™¨ï¼ˆä¿ç•™æ•°æ®ï¼‰
docker-compose down

# å¯åŠ¨å®¹å™¨
docker-compose up -d
```

---

## ğŸ“ æ•°æ®æŒä¹…åŒ–è¯´æ˜

**Dockeræ•°æ®å·ï¼š**
- æ•°æ®å­˜å‚¨åœ¨ï¼š`iot_mysql-data` æ•°æ®å·
- ä½ç½®ï¼šDockerå†…éƒ¨å­˜å‚¨
- åªè¦ä¸åˆ é™¤æ•°æ®å·ï¼Œæ•°æ®å°±ä¼šä¿ç•™

**å¦‚ä½•æŸ¥çœ‹æ•°æ®å·ï¼š**
```bash
docker volume ls
docker volume inspect iot_mysql-data
```

**åˆ é™¤æ•°æ®å·ï¼ˆâš ï¸ ä¼šåˆ é™¤æ•°æ®ï¼‰ï¼š**
```bash
docker volume rm iot_mysql-data
```

---

*æœ€åæ›´æ–°ï¼š2026-01-08*
